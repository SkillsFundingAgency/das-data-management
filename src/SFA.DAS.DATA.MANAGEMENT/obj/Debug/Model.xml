<?xml version="1.0" encoding="utf-8"?>
<DataSchemaModel FileFormatVersion="1.2" SchemaVersion="2.4" DspName="Microsoft.Data.Tools.Schema.Sql.SqlAzureV12DatabaseSchemaProvider" CollationLcid="1033" CollationCaseSensitive="False" xmlns="http://schemas.microsoft.com/sqlserver/dac/Serialization/2012/02">
	<Header>
		<CustomData Category="AnsiNulls">
			<Metadata Name="AnsiNulls" Value="True" />
		</CustomData>
		<CustomData Category="QuotedIdentifier">
			<Metadata Name="QuotedIdentifier" Value="True" />
		</CustomData>
		<CustomData Category="CompatibilityMode">
			<Metadata Name="CompatibilityMode" Value="130" />
		</CustomData>
		<CustomData Category="Reference" Type="Assembly">
			<Metadata Name="LogicalName" Value="SFA.DAS.Data.Management.Database.dll" />
			<Metadata Name="FileName" Value="C:\GITREPO2\DAS-DATA-MANAGEMENT\SRC\SFA.DAS.DATA.MANAGEMENT\OBJ\DEBUG\SFA.DAS.DATA.MANAGEMENT.DATABASE.DLL" />
			<Metadata Name="AssemblyName" Value="SFA.DAS.Data.Management.Database" />
			<Metadata Name="PermissionSet" Value="SAFE" />
			<Metadata Name="Owner" Value="" />
			<Metadata Name="GenerateSqlClrDdl" Value="True" />
			<Metadata Name="IsVisible" Value="True" />
			<Metadata Name="IsModelAware" Value="True" />
			<Metadata Name="SkipCreationIfEmpty" Value="True" />
			<Metadata Name="AssemblySymbolsName" Value="C:\Gitrepo2\das-data-management\src\SFA.DAS.DATA.MANAGEMENT\obj\Debug\SFA.DAS.Data.Management.Database.pdb" />
		</CustomData>
		<CustomData Category="SqlCmdVariables" Type="SqlCmdVariable" />
	</Header>
	<Model>
		<Element Type="SqlDatabaseOptions">
			<Property Name="Collation" Value="SQL_Latin1_General_CP1_CI_AS" />
			<Property Name="IsAnsiNullDefaultOn" Value="True" />
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Property Name="IsAnsiWarningsOn" Value="True" />
			<Property Name="IsArithAbortOn" Value="True" />
			<Property Name="IsConcatNullYieldsNullOn" Value="True" />
			<Property Name="IsTornPageProtectionOn" Value="False" />
			<Property Name="IsFullTextEnabled" Value="True" />
			<Property Name="PageVerifyMode" Value="3" />
			<Property Name="DefaultLanguage" Value="" />
			<Property Name="DefaultFullTextLanguage" Value="" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Apprentice].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="3" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Apprentice].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="4" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Apprentice].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="5" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="6" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="7" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="8" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="9" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="10" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="11" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Transfers]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Transfers].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="12" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Transfers]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Transfers].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="13" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Transfers]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Transfers].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="14" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Commitment].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="15" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Commitment].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="16" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Commitment].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="17" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[EmployerAccount].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="18" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[EmployerAccount].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="19" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[EmployerAccount].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="20" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Provider].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="21" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Provider].[Asdm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="22" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Provider].[Asdm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="23" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="24" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="25" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="26" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[DataLockStatus].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="27" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[DataLockStatus].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="28" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[DataLockStatus].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="29" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="30" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="31" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="32" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[TrainingCourse].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="33" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[TrainingCourse].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="34" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[TrainingCourse].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="35" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[0]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DASCalendarMonth]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarYearMonth_SortOrder]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="36" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[IsEnabled]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="37" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[AddedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="38" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[SourceDbChanges]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[dbo].[SourceDbChanges].[DetectedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="39" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataProfanities]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataProfanities].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="40" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataProfanities]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataProfanities].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="41" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataProfanities]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataProfanities].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="42" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBannedPhrases]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBannedPhrases].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="43" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBannedPhrases]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBannedPhrases].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="44" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBannedPhrases]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBannedPhrases].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="45" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="46" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="47" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="48" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBankHolidays]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBankHolidays].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="49" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBankHolidays]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBankHolidays].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="50" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBankHolidays]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataBankHolidays].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="51" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataQualificationTypes]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataQualificationTypes].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="52" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataQualificationTypes]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataQualificationTypes].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="53" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataQualificationTypes]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataQualificationTypes].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="54" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataCandidateSkills]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataCandidateSkills].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="55" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataCandidateSkills]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataCandidateSkills].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="56" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataCandidateSkills]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataCandidateSkills].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="57" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="58" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="59" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="60" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="61" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="62" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="63" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[RAA_Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="64" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[RAA_Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="65" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[RAA_Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="66" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(-1)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_Users].[RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="67" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_Users].[AsDm_CreatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="68" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdatE())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[RAA_Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[RAA_Users].[AsDm_UpdatedDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="69" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[UpdatedDateTime]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="70" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[EI_IncentiveApplication]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[EI_IncentiveApplication].[UpdatedDateTime]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="71" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[getdate()]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_Pl].[EI_Accounts]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_Pl].[EI_Accounts].[UpdatedDateTime]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="72" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[ABS(CAST(CAST(NEWID() AS VARBINARY) AS INT))]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[CopyActivity]" />
				</Entry>
			</Relationship>
			<Relationship Name="ExpressionDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varbinary]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[Stg].[CopyActivity].[NID]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="73" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[CRYPT_GEN_RANDOM(4096)]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[SaltKeyLog]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[SaltKeyLog].[SaltKey]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="74" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[getdate()]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute].[AppendDateTime]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="75" />
		</Element>
		<Element Type="SqlForeignKeyConstraint">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CountyId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[AsData_PL].[Va_County].[CountyId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[AsData_PL].[Va_County]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="76" />
		</Element>
		<Element Type="SqlForeignKeyConstraint">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[LocalAuthorityId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[AsData_PL].[Va_LocalAuthority].[LocalAuthorityId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[AsData_PL].[Va_LocalAuthority]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="77" />
		</Element>
		<Element Type="SqlForeignKeyConstraint">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[CandidateId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Application]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="78" />
		</Element>
		<Element Type="SqlForeignKeyConstraint">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[VacancyId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Application]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="79" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DASCalendarMonth]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="80" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Stg].[CandidateConfig].[CCId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[CandidateConfig]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="81" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Stg].[Avms_CandidateDetails].[SourceSK]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[Avms_CandidateDetails]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="82" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[CandidateEthLookUp].[CELId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="83" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="84" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_LegalEntity].[LegalEntityId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="85" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_Pl].[Va_Vacancy].[VacancyId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="86" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_Provider].[ProviderID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Provider]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="87" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_LocalAuthority].[LocalAuthorityId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_LocalAuthority]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="88" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_Employer].[EmployerId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Employer]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="89" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_County].[CountyId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_County]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="90" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_Candidate].[CandidateId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="91" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipFrameworkId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="92" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_Application].[ApplicationId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_Application]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="93" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="94" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[EI_IncentiveApplication].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[EI_IncentiveApplication]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="95" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[Va_CandidateDetails].[CandidateDetailsId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[Va_CandidateDetails]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="96" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Stg].[FAA_CandidateDetails].[SourceSK]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[FAA_CandidateDetails]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="97" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Stg].[CopyActivity].[CAId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Stg].[CopyActivity]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="98" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[SaltKeyLog].[SaltKeyID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[SaltKeyLog]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="99" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[AsData_PL].[ApprenticeshipStdRoute].[StdRouteID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="100" />
		</Element>
		<Element Type="SqlSchema" Name="[Acct]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[ASData_PL]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[ApprenticeshipStdRoute]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[ApprenticeshipStdRoute].[StdRouteID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="100" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[ApprenticeshipStdRoute].[Reference]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[ApprenticeshipStdRoute].[LARSCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[ApprenticeshipStdRoute].[Route]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="200" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[ApprenticeshipStdRoute].[AppendDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="75" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Filegroup">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[PRIMARY]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_Pl].[EI_Accounts]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[EI_Accounts].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[EI_Accounts].[AccountLegalEntityId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[EI_Accounts].[LegalEntityId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[EI_Accounts].[HasSignedIncentivesTerms]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[EI_Accounts].[UpdatedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="72" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[EI_IncentiveApplication]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="95" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[AccountId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[AccountLegalEntityId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[DateCreated]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[Status]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[DateSubmitted]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplication].[UpdatedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="71" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="94" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[IncentiveApplicationId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[ApprenticeshipId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[PlannedStartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[ApprenticeshipEmployerTypeOnApproval]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[TotalIncentiveAmount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[money]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[EI_IncentiveApplicationApprenticeship].[UpdatedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="70" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[RAA_Users]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[TypeCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[IdamUserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[UserType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[UserName]">
						<Property Name="MaskingFunction" Value="default()" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[UserEmail]">
						<Property Name="MaskingFunction" Value="Email()" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[UserCreatedTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[UserCreatedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[LastSignedInTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[LastSignedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[EmployerAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[Ukprn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="64" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="65" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[RAA_Users].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="66" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[SaltKeyLog]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[SaltKeyLog].[SaltKeyID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="99" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[SaltKeyLog].[SaltKey]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="74" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[SaltKeyLog].[SourceType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Filegroup">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[PRIMARY]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_Application]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[ApplicationId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="93" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[CandidateId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[VacancyId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[ApplicationStatusTypeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[ApplicationStatusDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[BeingSupportedBy]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[LockedForSupportUntil]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[IsWithdrawn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[ApplicationGuid]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[CreatedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Application].[SourceApplicationId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="78" />
			<AttachedAnnotation Disambiguator="79" />
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipFrameworkId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="92" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceApprenticeshipFrameworkId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ProgrammeId_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkCodeName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkShortName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameWorkFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="200" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkTitle_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipFrameworkStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkClosedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[PreviousApprenticeshipOccupationId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[StandardId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationCodeName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationShortName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticehipOccupationFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationClosedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_ApprenticeshipStandard]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[LarsCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardSectorId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardSectorName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[LarsStandardSectorCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[ApprenticeshipOccupationId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[EducationLevelId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_ApprenticeshipStandard].[ApprenticeshipFrameworkStatusType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_Candidate]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[CandidateId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="91" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[CandidateStatusTypeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[CandidateStatusTypeDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[CountyId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[CountyName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[PostCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[LocalAuthorityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[LocalAuthorityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[UniqueLearnerNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[Gender]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[ApplicationLimitEnforced_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[LastAccessedDate_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[LastAccessedManageApplications_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[BeingSupportedBy_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[LockedForSupportUntil_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[AllowMarketingMessages_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[CandidateGuid]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[Age]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Candidate].[SourceCandidateId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="76" />
			<AttachedAnnotation Disambiguator="77" />
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_CandidateDetails]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_CandidateDetails].[CandidateDetailsId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="96" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_CandidateDetails].[CandidateId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_CandidateDetails].[CandidateEthnicCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="25" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_CandidateDetails].[CandidateEthnicDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_CandidateDetails].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_County]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_County].[CountyId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="90" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_County].[CodeName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_County].[ShortName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_County].[FullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="150" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_EducationLevel]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_EducationLevel].[EducationLevelId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="84" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_EducationLevel].[EducationLevelCodeName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_EducationLevel].[EducationLevelShortName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_EducationLevel].[EducationLevelFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_Employer]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[EmployerId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="89" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[FullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[TradingName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[SourceEmployerId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[DasAccountId_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[LocalAuthorityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[OwnerOrgnistaion_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[EdsUrn_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[EmployerStatusTypeId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[EmployerStatusTypeDesc_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Employer].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_LegalEntity]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[LegalEntityId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="85" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[LegalEntityPublicHashedId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[EmployerId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[EmployerAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[LegalEntityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[SourceLegalEntityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LegalEntity].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_LocalAuthority]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LocalAuthority].[LocalAuthorityId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="88" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LocalAuthority].[CodeName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="4" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LocalAuthority].[ShortName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LocalAuthority].[FullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_LocalAuthority].[CountyId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_PL].[Va_Provider]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[ProviderID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="87" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[UPIN_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[SourceProviderID_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[UKPRN]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[FullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[TradingName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[IsContracted_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[ContractedFrom_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[ContractedTo_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[ProviderStatusTypeID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[ProviderStatusTypeDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[IsNASProvider_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[ProviderToUseFAA_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_PL].[Va_Provider].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[AsData_Pl].[Va_Vacancy]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="86" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyGuid]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyReferenceNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyTitle]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyLocalAuthorityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyLocalAuthorityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyPostcode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="25" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyCountyId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyCounty]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[EmployerId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[EmployerFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[LegalEntitiyId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[LegalEntityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ProviderId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ProviderUkprn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ProviderFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ProviderTradingName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyOwner_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ApprenticeshipType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="200" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyShortDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyLocationTypeId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyLocationType_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[NumberOfPositions]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[SectorName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[FrameworkOrStandardID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[FrameworkOrStandardLarsCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[FrameworkOrStandardName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[EducationLevel]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WeeklyWage_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="4" />
									<Property Name="Precision" Value="19" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WageLowerBound_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="4" />
									<Property Name="Precision" Value="19" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WageUpperBound_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="4" />
									<Property Name="Precision" Value="19" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WageType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WageText]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WageUnitId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WageUnitDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[WorkingWeek]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[HoursPerWeek]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[DurationTypeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[DurationTypeDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ApplicationClosingDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[InterviewsFromDate_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ExpectedStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ExpectedDuration]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[NumberOfViews_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[MaxNumberOfApplications_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[ApplyOutsideNAVMS_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[NoOfOfflineApplicants_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[MasterVacancyId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[NoOfOfflineSystemApplicants_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[SmallEmployerWageIncentive_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[SubmissionCount_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[StartedToQADateTime_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[TrainingTypeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[TrainingTypeFullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyTypeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancyTypeDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[UpdatedDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[EditedInRaa_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancySourceId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[VacancySource]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[OfflineVacancyTypeId_v1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[IsDeleted_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[DeletedDateTime_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[SubmittedDateTime_v2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[SourceVacancyId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[AsData_Pl].[Va_Vacancy].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[ASData_PL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Comt]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Data_Pub]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlView" Name="[Data_Pub].[DAS_CalendarMonth]">
			<Property Name="QueryScript">
				<Value><![CDATA[ 
SELECT CalendarMonthID
    , CalendarDate
    , CalendarMonthNumber
    , CalendarMonthName
    , CalendarMonthShortName
    , CalendarYear 
    , CalendarMonthNameYear 
    , CalendarMonthShortNameYear 
    , TaxMonthNumber 
    , TaxYear
    , AcademicMonthNumber 
    , AcademicYear
    , CalendarYearMonth_SortOrder
  FROM dbo.DASCalendarMonth]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarMonthID]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarDate]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarDate]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarMonthNumber]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthNumber]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarMonthName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarMonthShortName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthShortName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarYear]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarYear]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarMonthNameYear]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthNameYear]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarMonthShortNameYear]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarMonthShortNameYear]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[TaxMonthNumber]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[TaxMonthNumber]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[TaxYear]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[TaxYear]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[AcademicMonthNumber]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[AcademicMonthNumber]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[AcademicYear]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[AcademicYear]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Data_Pub].[DAS_CalendarMonth].[CalendarYearMonth_SortOrder]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DASCalendarMonth].[CalendarYearMonth_SortOrder]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[dbo].[DASCalendarMonth]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthShortName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthShortNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[TaxMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[TaxYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[AcademicMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[AcademicYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarYearMonth_SortOrder]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Data_Pub]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="410" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE VIEW [Data_Pub].[DAS_CalendarMonth]&#xD;&#xA;&#x9;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Apprentice]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[FirstName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[LastName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[ULN]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[DateOfBirth]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[NINumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[Source_ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="3" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[AsDm_CreatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="4" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprentice].[AsDm_UpdatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="5" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="101" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Apprenticeship]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[CommitmentId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[ApprenticeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[TrainingCourseId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[AssessmentOrgId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[Cost]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[StartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[EndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[AgreementStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Apprenticeship].[AgreementStatusDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(CASE WHEN AgreementStatus=0 THEN 'Not Agreed' WHEN AgreementStatus=1 THEN 'Employer Agreed' WHEN AgreementStatus=2 THEN 'Provider Agreed' WHEN AgreementStatus=3 THEN 'Both Agreed' WHEN AgreementStatus is null then null  ELSE 'Unknown' END)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Apprenticeship].[AgreementStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[ApprenticeshipStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Apprenticeship].[ApprenticeshipStatusDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(CASE WHEN ApprenticeshipStatus=0 THEN 'Pending Approval' WHEN ApprenticeshipStatus=1 THEN 'Active' WHEN ApprenticeshipStatus=2 THEN 'Payments Halted' WHEN ApprenticeshipStatus=3 THEN 'CANCELLED' WHEN ApprenticeshipStatus=4 THEN 'COMPLETED' WHEN ApprenticeshipStatus=5 THEN 'Deleted' ELSE 'Unknown' END)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Apprenticeship].[ApprenticeshipStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[EmployerRef]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[ProviderRef]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[CommitmentCreatedOn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[CommitmentAgreedOn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[PaymentOrder]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[StopDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[PauseDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[HasHadDataLockSuccess]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[PendingUpdateOriginator]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Apprenticeship].[PendingUpdateOrginatorDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(Case when PendingUpdateOriginator=0 then '' when PendingUpdateOriginator=1 then '' else 'unknown' end)]]></Value>
						</Property>
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Apprenticeship].[PendingUpdateOriginator]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[CloneOf]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[ReservationId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Apprenticeship].[IsApproved]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(case when ApprenticeshipStatus>(0) then CONVERT([bit],(1)) else CONVERT([bit],(0)) end)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Apprenticeship].[ApprenticeshipStatus]" />
							</Entry>
							<Entry>
								<References ExternalSource="BuiltIns" Name="[bit]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[Source_ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="30" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="31" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Apprenticeship].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="32" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="102" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="103" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="104" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="105" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="106" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[AssessmentOrganisation]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[EPAOId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[EPAO_Name]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[Source_EPAOId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="6" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[AsDm_CreatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="7" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[AssessmentOrganisation].[AsDm_UpdatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="8" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="107" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[Build_AS_DataMart]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ==========================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Master Stored Proc that builds AS DataMart
-- ==========================================================


/* Generate Run Id for Logging Execution */

DECLARE @RunId int

EXEC @RunId= dbo.GenerateRunId

EXEC CreateSystemExternalTables 'comtDBConnection','Commitments','Comt',@RunId

EXEC CreateExternalTables 'comtDBConnection','Ext_Tbl_InfSch_Commitments','Comt',@RunId

EXEC CreateSystemExternalTables 'rsrvDBConnection','Reservations','Resv',@RunId

EXEC CreateExternalTables 'rsrvDBConnection','Ext_Tbl_InfSch_Reservations','Resv',@RunId

EXEC CreateSystemExternalTables 'easfinDBConnection','Finance','Fin',@RunId

EXEC CreateExternalTables 'easfinDBConnection','Ext_Tbl_InfSch_Finance','Fin',@RunId

EXEC CreateSystemExternalTables 'usersDBConnection','Users','EAUser',@RunId

EXEC CreateExternalTables 'usersDBConnection','Ext_Tbl_InfSch_Users','EAUser',@RunId

EXEC CreateSystemExternalTables 'easAccDBConnection','Account','Acct',@RunId

EXEC CreateExternalTables 'easAccDBConnection','Ext_Tbl_InfSch_Account','Acct',@RunId

EXEC UpdateCalendarMonth @RunId

EXEC LoadReferenceData @RunId

EXEC PopulateSourceDbMetadataForImport @RunId

EXEC CreateCommitmentsView @RunId

EXEC CreateLevyDeclarationsView @RunId


EXEC CreatePaymentsView @RunId

EXEC CreateEmployerAccountTransactionsView @RunId

EXEC CreateEmployerAccountTransfersView @RunId 



EXEC CreateEmployerPAYESchemesView @RunId 

EXEC CreateEmployerLegalEntitiesView @RunId 

EXEC CreateEmployerLegalEntitiesView_LevyInd @RunId

EXEC CreateEmployerAccountsView @RunId 

EXEC CreateEmployerTransferRelationshipView @RunId 

EXEC CreateTransactionLineView @RunId 

EXEC CreateEmployerAgreementsView @RunId

EXEC CreateCommitmentsView_LevyInd @RunId

EXEC CreateSpendControlView @RunId

EXEC CreateSpendControlNonLevyView @RunId

EXEC LoadCandidateEthLookUp @RunId

EXEC LoadCandidateConfig @RunId

/* Refresh Payments Snapshot Table */

--EXEC ImportPaymentsSnapshot @RunId

EXEC CreatePaymentsView_LevyInd  @RunId


/* Load Commitments into Modelled Data Tables */

--EXEC ImportCommitmentsDb @RunId

EXEC [dbo].[CreateStdsAndFrameworksView] @RunID

EXEC [dbo].[CreateDashboardRegistrationView] @RunID

EXEC [dbo].[CreateDashboardReservationView] @RunID

EXEC [dbo].[CreateDashboardReservationAndTrainingView] @RunID

EXEC [dbo].[CreateDashboardReservationAndCommitmentView] @RunID

EXEC [dbo].[UpdateApprenticeshipStdRoute] @RunID]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateRunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSystemExternalTables]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateExternalTables]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[LoadReferenceData]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[PopulateSourceDbMetadataForImport]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateCommitmentsView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateLevyDeclarationsView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreatePaymentsView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAccountTransactionsView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAccountTransfersView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerPAYESchemesView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerLegalEntitiesView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerLegalEntitiesView_LevyInd]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAccountsView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerTransferRelationshipView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateTransactionLineView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAgreementsView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateCommitmentsView_LevyInd]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSpendControlView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSpendControlNonLevyView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[LoadCandidateEthLookUp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[LoadCandidateConfig]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreatePaymentsView_LevyInd]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateStdsAndFrameworksView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardRegistrationView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardReservationView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardReservationAndTrainingView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardReservationAndCommitmentView]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateApprenticeshipStdRoute]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2685" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[Build_AS_DataMart]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[BuildVacanciesPresentationLayer]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Build Vacancies Presentation Layer
-- ===============================================================================
BEGIN

/* Import Vacancies Employer Data to Presentation Layer */



EXEC dbo.ImportVacanciesEmployerToPL @RunId


/* Import Vacancies Provider Data to Presentation Layer */

IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesEmployerToPL' and Execution_Status=1 and RunId=@RunId) 
BEGIN
EXEC dbo.ImportVacanciesProviderToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Provider Failed -Check Log Table For Errors',1,1)


/* Import Vacancies LegalEntity Data to Presentation Layer */

IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesProviderToPL' and Execution_Status=1 and RunId=@RunId) 
BEGIN
EXEC dbo.ImportVacanciesLegalEntityToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Legal Entity Failed -Check Log Table For Errors',1,1)

/* Import Vacancies Apprenticeship Framework , Standard and Education Level To Presentation Layer */


IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesLegalEntityToPL' and Execution_Status=1 and RunId=@RunId) 
BEGIN
EXEC dbo.ImportVacanciesApprenticeshipFrameworkStandardELToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Apprenticeship Framework , Standard And Education Level Failed -Check Log Table For Errors',1,1)



/* Import Vacancies Data to Presentation Layer */

IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesApprenticeshipFrameworkStandardELToPL' and Execution_Status=1 and RunId=@RunId)
BEGIN
EXEC dbo.ImportVacanciesToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Failed -Check Log Table For Errors',1,1)




/* Import Vacancies Candidate Data to Presentation Layer */

IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesToPL' and Execution_Status=1 and RunId=@RunId)
BEGIN
EXEC dbo.ImportVacanciesCandidateToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Candidate Failed -Check Log Table For Errors',1,1)

/* Import Vacancies Candidate Data to Presentation Layer */

IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesCandidateToPL' and Execution_Status=1 and RunId=@RunId)
BEGIN
EXEC dbo.ImportVacanciesCandidateDetailsToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Candidate Details To PL Failed -Check Log Table For Errors',1,1)

/* Import Vacancies Application Data to Presentation Layer */

IF EXISTS (SELECT * FROM Mgmt.Log_Execution_Results where StoredProcedureName='ImportVacanciesCandidateDetailsToPL' and Execution_Status=1 and RunId=@RunId)
BEGIN
EXEC dbo.ImportVacanciesApplicationToPL @RunId
END
ELSE RAISERROR( 'Import Data From Vacancies Application To PL Failed -Check Log Table For Errors',1,1)







END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[dbo].[ImportVacanciesEmployerToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[BuildVacanciesPresentationLayer].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesProviderToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesLegalEntityToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesApprenticeshipFrameworkStandardELToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesApplicationToPL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[BuildVacanciesPresentationLayer].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3254" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[BuildVacanciesPresentationLayer]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[CandidateEthLookUp]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[CandidateEthLookUp].[CELId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="83" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[CandidateEthLookUp].[ShortName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[CandidateEthLookUp].[FullName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[CandidateEthLookUp].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Commitment]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[EmployerAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[EmployerAccountLegalEntityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[ProviderId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[Reference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[CommitmentStatus]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Commitment].[CommitmentStatusDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(CASE WHEN CommitmentStatus=1 then 'Active' when CommitmentStatus=2 then 'Deleted' when CommitmentStatus=0 then 'New' else 'Unknown' end)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Commitment].[CommitmentStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[EditStatus]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Commitment].[EditStatusDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(Case when EditStatus=0 then 'Both' when EditStatus=1 then 'Employer' when EditStatus=2 then 'Provider' when EditStatus=3 then 'Neither' else 'Unknown' end)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Commitment].[EditStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[CommitmentCreatedOn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[LastAction]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Commitment].[LastActionDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(Case when LastAction=0 then 'New Cohort' when LastAction=1 then 'Amended by a Party' when LastAction=2 then 'Approved by a Party' when lastaction=3 then 'Amended by Employer Following Transfer Sender Rejection' else ' Unknown' end)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Commitment].[LastAction]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[LastUpdatedByEmployerName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[LastUpdatedByEmployerEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[LastUpdatedByProviderName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[LastUpdatedByProviderEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[EmployerProviderPaymentPriority]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[ProviderCanApproveCommitment]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[EmployerCanApproveCommitment]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[Originator]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[Commitment].[OriginatorDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(Case when Originator=0 then 'Employer' when Originator=1 then 'Provider' else 'Unknown' end)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Commitment].[Originator]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[Commitments_SourceId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[AsDm_CreatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="15" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[AsDm_UpdatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="16" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Commitment].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="17" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="108" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="109" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="110" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="111" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateCommitmentsView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
/* =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 15/08/2019
-- Description: Create Views for Commitments that mimics RDS Commitments
-- =========================================================================

--
     Change Control
     
     Date				Author        Jira             Description

     20/01/2020		R.Rai		  ADM_989		   Change ULN to -2 when null
     25/02/2020   S.Heath   ADM-1092     Split TransferApprovalStatus from ADM-921 to allow it to go in a CR.
     22/04/2020   S.Heath   ADM-1412     Update logic for FullyAgreedCommitment
	 01/05/2020    R.Rai    ADM-1471     Remove fields from Commitments

*/

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateCommitmentsView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateCommitmentsView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Commitments'')
Drop View Data_Pub.DAS_Commitments
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Commitments]
	AS 
SELECT [C].[ID]                                                         AS ID
	   , CAST([C].ID AS BIGINT)                                         AS EventID
	   , CAST(CASE WHEN A.PaymentStatus=''0'' THEN ''PendingApproval''
	               WHEN A.PaymentStatus=''1'' THEN ''Active''
			       WHEN A.PaymentStatus=''2'' THEN ''Paused''
			       WHEN A.PaymentStatus=''3'' THEN ''Withdrawn''
			       WHEN A.PaymentStatus=''4'' THEN ''Completed''
			       WHEN A.PaymentStatus=''5'' THEN ''Deleted''
			       ELSE ''Unknown''
		       END AS Varchar(50))                                      AS PaymentStatus
	   , CAST(A.ID as bigint) AS CommitmentID
	   , CAST(RD.FieldDesc AS Varchar(50))                              as AgreementStatus
		,CAST(C.ProviderId as bigint)                                   as UKPRN
		,CAST(isnull(A.ULN,-2) as bigint)                               as ULN
		,CAST(C.ProviderId as Varchar(255))                             as ProviderID
		,CAST(A.ULN as varchar(255))                                    as LearnerID
		,CAST(C.EmployerAccountId as Varchar(255))                      as EmployerAccountID
		,CAST(Acc.HashedId as Varchar(100))                             as DasAccountId  
		,CAST(CASE WHEN A.TrainingType=0  THEN ''Standard''
		      WHEN A.TrainingType=1 THEN ''Framework''
			  ELSE ''Unknown''
			  END AS Varchar(255))                                      as TrainingTypeID
		,CAST(A.TrainingCode AS VARCHAR(255))                           As TrainingID
'
SET @VSQL3='
		, CASE
	      WHEN [A].[TrainingType] = 0  AND ISNUMERIC(A.TrainingCode) = 1
	      THEN CAST(A.TrainingCode AS INT)
	      ELSE ''-1''
	       END                                                          AS [StdCode]
	    , CASE
	      WHEN A.TrainingType = 1
	          AND CHARINDEX(''-'', [A].[TrainingCode]) <> 0 -- This to fix the issues when standard codes are being recorded as Frameworks
	      THEN CAST(SUBSTRING([A].[TrainingCode], 1, CHARINDEX(''-'', [A].[TrainingCode])-1) AS INT)
	      ELSE ''-1''
	       END                                                         AS [FworkCode]
	    , CASE
	      WHEN A.TrainingType = 1 
	          AND CHARINDEX(''-'',  [A].[TrainingCode]) <> 0 -- This to fix the issues when standard codes are being recorded as Frameworks
	      THEN CAST(SUBSTRING(SUBSTRING([A].[TrainingCode], CHARINDEX(''-'',[A].[TrainingCode])+1, LEN([A].[TrainingCode])), 1, CHARINDEX(''-'', SUBSTRING([A].[TrainingCode], CHARINDEX(''-'',[A].[TrainingCode])+1, LEN([A].[TrainingCode])))-1) AS INT)
	      ELSE ''-1''
	       END                                                         AS [ProgType]
	   , CASE
	      WHEN A.TrainingType = 1 
	      THEN CAST(SUBSTRING(SUBSTRING([A].[TrainingCode], CHARINDEX(''-'', [A].[TrainingCode])+1, LEN( [A].[TrainingCode])), CHARINDEX(''-'', SUBSTRING([A].[TrainingCode], CHARINDEX(''-'', [A].[TrainingCode])+1, LEN( [A].[TrainingCode])))+1, LEN(SUBSTRING([A].[TrainingCode], CHARINDEX(''-'',[A].[TrainingCode])+1, LEN( [A].[TrainingCode])))) AS INT)
	      ELSE ''-1''
	       END                                                         AS [PwayCode]
	   , CAST([a].[StartDate] AS DATE)                                 AS TrainingStartDate
	   , CAST([a].[EndDate] AS DATE)                                   AS TrainingEndDate
	   , CAST(C.TransferSenderId AS bigint)                            as TransferSenderAccountId
     , Convert(nvarchar(50), 
       CASE WHEN TransferApprovalStatus is null 
						  THEN null
            WHEN TransferApprovalStatus = ''0''
							THEN ''Pending''
						WHEN TransferApprovalStatus = ''1''
							THEN ''TransferApproved''
						WHEN  TransferApprovalStatus = ''2''
							THEN ''TransferRejected''
				END ) AS  TransferApprovalStatus
	   , CAST(C.TransferApprovalActionedOn AS DateTime)                as TransferApprovalDate
	   , CAST(A.Cost as decimal(18,0))                                 as TrainingTotalCost
	   , CAST(GETDATE() AS DateTime)                                   AS UpdateDateTime
	   , CAST(GETDATE() AS Date)                                       as UpdateDate
	   , ISNULL(CAST(1 AS BIT),-1)                                     AS Flag_Latest

	--   , CAST(C.LegalEntityID AS VARCHAR(50))                          AS LegalEntityCode
	--   , CAST(C.LegalEntityName as varchar(100))                       AS LegalEntityName

     	, CAST(le.code AS VARCHAR(50))                                  AS LegalEntityCode
		, CAST(AcctLE.Name  as varchar(100))                            AS LegalEntityName

	--   , CAST((CASE WHEN C.LegalEntityOrganisationType =1 THEN ''CompaniesHouse''
	--              WHEN C.LegalEntityOrganisationType=2 THEN ''Charities''
	--		      WHEN C.LegalEntityOrganisationType=3 THEN ''Public Bodies''
	--		      ELSE ''Other''
	--	      END) AS Varchar(20))                                     as LegalEntitySource


	   , CAST((CASE WHEN LE.Source = 1 THEN ''CompaniesHouse''
	              WHEN LE.Source = 2 THEN ''Charities''
			      WHEN LE.Source = 3  THEN ''Public Bodies''
			      ELSE ''Other''
		      END) AS Varchar(20))                                     as LegalEntitySource


	   , CAST(COALESCE(LE.ID,-1) AS BIGINT)                            AS DasLegalEntityId 
	   , CAST(A.DateOfBirth as DATE)                                   as DateOfBirth
	   , CASE WHEN [a].[DateOfBirth] IS NULL	THEN - 1
		      WHEN DATEPART([M], [a].[DateOfBirth]) > DATEPART([M], [a].[StartDate])
			    OR DATEPART([M], [a].[DateOfBirth]) = DATEPART([M], [a].[StartDate])
			   AND DATEPART([DD], [a].[DateOfBirth]) > DATEPART([DD], [a].[StartDate])
			  THEN DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate]) - 1
		      ELSE DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate])
		END                                                            AS [CommitmentAgeAtStart]
'
SET @VSQL4=
'	   , ISNULL(CAST((CASE 
		               WHEN [a].[DateOfBirth] IS NULL THEN ''- 1''
					   WHEN CASE
				            WHEN DATEPART([M], [a].[DateOfBirth]) > DATEPART([M], [a].[StartDate])
					          OR DATEPART([M], [a].[DateOfBirth]) = DATEPART([M], [a].[StartDate])
					         AND DATEPART([DD], [a].[DateOfBirth]) > DATEPART([DD], [a].[StartDate])
					        THEN DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate]) - 1
				            ELSE DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate])
				             END BETWEEN 0  AND 18 
							THEN ''16-18''
		                ELSE ''19+''
		                 END) as Varchar(5)),''NA'')                      AS [CommitmentAgeAtStartBand]
		--,RealisedCommitment
        , ISNULL(CAST((CASE WHEN P.TotalAmount>0 THEN ''Yes'' ELSE ''No'' END) as Varchar(3)),''NA'') AS RealisedCommitment
		, ISNULL(CAST((CASE WHEN [a].[StartDate] BETWEEN DATEADD(mm, DATEDIFF(mm, 0, GETDATE()), 0)
				             AND DATEADD(dd, - 1, DATEADD(mm, DATEDIFF(mm, 0, GETDATE()) + 1, 0))
		                    THEN ''Yes''
		                    ELSE ''No''
		                     END) AS VARCHAR(3)),''NA'')              AS StartDateInCurrentMonth
		--,DATEADD(mm, DATEDIFF(mm, 0, GETDATE()), 0)                 AS [Start day of current month]
		--,DATEADD(dd, - 1, DATEADD(mm, DATEDIFF(mm, 0, GETDATE()) + 1, 0)) AS [Last day of current month]
		, CASE WHEN C.Approvals=0 THEN 1
		       WHEN C.Approvals=1 THEN 2
			   WHEN C.Approvals=2 THEN 3
			   WHEN C.Approvals=3 THEN 4
			   WHEN C.Approvals=4 THEN 5
			   WHEN C.Approvals=7 THEN 6
			   ELSE 9
			   END                                                   AS [AgreementStatus_SortOrder]
		, CASE WHEN A.PaymentStatus=0 THEN 1
		       WHEN A.PaymentStatus=1 THEN 2
			   WHEN A.PaymentStatus=2 THEN 3
			   WHEN A.PaymentStatus=3 THEN 4
			   WHEN A.PaymentStatus=4 THEN 5
			   WHEN A.PaymentStatus=5 THEN 6
			   ELSE 9
			   END                                                   AS [PaymentStatus_SortOrder]

	--	,  CAST(C.LegalEntityName as nvarchar(100))                   as DASAccountName
	    ,  CAST(AcctLE.Name  as nvarchar(100))                        AS DASAccountName


		, ISNULL(CAST((CASE WHEN C.Approvals IN (3,7) THEN ''Yes''
		                    ELSE ''No''
			                 END) AS Varchar(3)),''NA'')             as FullyAgreedCommitment

	 --   , CAST(C.LegalEntityAddress as nvarchar(256))                as LegalEntityRegisteredAddress
	      , CAST(AcctLE.Address as nvarchar(256))                as LegalEntityRegisteredAddress

FROM [Comt].[Ext_Tbl_Commitment] C 
LEFT JOIN [Comt].[Ext_Tbl_Apprenticeship] A
  ON C.Id=A.CommitmentId

LEFT JOIN [Acct].[Ext_Tbl_AccountLegalEntity] AcctLE
ON c.AccountLegalEntityId = AcctLE.ID

LEFT JOIN [Comt].[Ext_Tbl_Accounts] Acc
  ON Acc.Id=c.EmployerAccountId

-- LEFT JOIN [Acct].[Ext_Tbl_LegalEntity] LE
--  ON LE.Code=c.LegalEntityId

LEFT JOIN [Acct].[Ext_Tbl_LegalEntity] LE  
  ON AcctLE.LegalEntityId = LE.id


LEFT JOIN (SELECT P.ApprenticeshipId 
        ,SUM(P.Amount) as TotalAmount
        FROM Fin.Ext_Tbl_Payment P
	   inner join
	        (select P.AccountId
	               ,P.ApprenticeshipId as CommitmentId
		           ,P.DeliveryPeriodMonth
		           ,P.DeliveryPeriodYear
		           ,MAX(CAST(P.CollectionPeriodYear AS VARCHAR(255)) + ''-'' + CAST(P.CollectionPeriodMonth AS VARCHAR(255))) AS Max_CollectionPeriod
		           ,1 AS Flag_Latest
	           from Fin.Ext_Tbl_Payment p
	          group by
	                P.AccountId
		           ,P.ApprenticeshipId 
		           ,P.DeliveryPeriodMonth
		           ,P.DeliveryPeriodYear
	         ) as LP ON LP.AccountId=P.AccountId
	                AND LP.CommitmentId=P.ApprenticeshipId
			        AND LP.DeliveryPeriodMonth=P.DeliveryPeriodMonth
			        AND LP.DeliveryPeriodYear=P.DeliveryPeriodYear
			        AND LP.Max_CollectionPeriod=(CAST(P.CollectionPeriodYear as VARCHAR(255))+''-''+ CAST(P.CollectionPeriodMonth AS VARCHAR(255)))
	      GROUP BY P.ApprenticeshipId) P on P.ApprenticeshipId=A.ID
LEFT JOIN dbo.ReferenceData RD
       ON RD.Category=''Commitments''
      AND RD.FieldName=''Approvals''
      AND RD.FieldValue=C.Approvals
'

EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2+@VSQL3+@VSQL4)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateCommitmentsView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateCommitmentsView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateCommitmentsView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="12866" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateCommitmentsView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateCommitmentsView_LevyInd]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Robin Rai
-- Create Date: 15/08/2019
-- Description: Create Commitment View with Levy Indicator 
--
--
--     Change Control
--     
--     Date				Author        Jira       Description
--
--     16/01/2020	R.Rai		      ADM_1001	 Change Levy Indicator logic to account tables
--     04/03/2020   R.Rai             ADM_1130   Change Levy Indicator New Logic and TransferApprovalStatus  
--     09/03/2020   R.Rai             ADM_1130   Schema Change  
--     22/04/2020   S.Heath          ADM-1412   Update logic for FullyAgreedCommitment
--     01/05/2020   R.Rai            ADM-1471   REmove fields from Commitments
-- =====================================================================================================




BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateCommitmentsView_LevyInd'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateCommitmentsView_LevyInd'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='

IF EXISTS (SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Commitments_LevyInd'' AND TABLE_SCHEMA = ''ASData_PL'')
BEGIN 
   DROP VIEW ASData_PL.DAS_Commitments_LevyInd
END

'
SET @VSQL2='
CREATE VIEW [ASData_PL].[DAS_Commitments_LevyInd]
	AS 
SELECT [C].[ID]                                                         AS ID
	   , CAST([C].ID AS BIGINT)                                         AS EventID
	   , CAST(CASE WHEN A.PaymentStatus=''0'' THEN ''PendingApproval''
	               WHEN A.PaymentStatus=''1'' THEN ''Active''
			       WHEN A.PaymentStatus=''2'' THEN ''Paused''
			       WHEN A.PaymentStatus=''3'' THEN ''Withdrawn''
			       WHEN A.PaymentStatus=''4'' THEN ''Completed''
			       WHEN A.PaymentStatus=''5'' THEN ''Deleted''
			       ELSE ''Unknown''
		       END AS Varchar(50))                                      AS PaymentStatus
	   , CAST(A.ID as bigint) AS CommitmentID
	   , CAST(RD.FieldDesc AS Varchar(50))                              as AgreementStatus
		,CAST(C.ProviderId as bigint)                                   as UKPRN
		,CAST(A.ULN as bigint)                                          as ULN
		,CAST(C.ProviderId as Varchar(255))                             as ProviderID
		,CAST(A.ULN as varchar(255))                                    as LearnerID
		,CAST(C.EmployerAccountId as Varchar(255))                      as EmployerAccountID
		,CAST(Acc.HashedId as Varchar(100))                             as DasAccountId  
		,CAST(CASE WHEN A.TrainingType=0  THEN ''Standard''
		      WHEN A.TrainingType=1 THEN ''Framework''
			  ELSE ''Unknown''
			  END AS Varchar(255))                                      as TrainingTypeID
		,CAST(A.TrainingCode AS VARCHAR(255))                           As TrainingID
'
SET @VSQL3='
		, CASE
	      WHEN [A].[TrainingType] = 0  AND ISNUMERIC(A.TrainingCode) = 1
	      THEN CAST(A.TrainingCode AS INT)
	      ELSE ''-1''
	       END                                                          AS [StdCode]
	    , CASE
	      WHEN A.TrainingType = 1
	          AND CHARINDEX(''-'', [A].[TrainingCode]) <> 0 -- This to fix the issues when standard codes are being recorded as Frameworks
	      THEN CAST(SUBSTRING([A].[TrainingCode], 1, CHARINDEX(''-'', [A].[TrainingCode])-1) AS INT)
	      ELSE ''-1''
	       END                                                         AS [FworkCode]
	    , CASE
	      WHEN A.TrainingType = 1 
	          AND CHARINDEX(''-'',  [A].[TrainingCode]) <> 0 -- This to fix the issues when standard codes are being recorded as Frameworks
	      THEN CAST(SUBSTRING(SUBSTRING([A].[TrainingCode], CHARINDEX(''-'',[A].[TrainingCode])+1, LEN([A].[TrainingCode])), 1, CHARINDEX(''-'', SUBSTRING([A].[TrainingCode], CHARINDEX(''-'',[A].[TrainingCode])+1, LEN([A].[TrainingCode])))-1) AS INT)
	      ELSE ''-1''
	       END                                                         AS [ProgType]
	   , CASE
	      WHEN A.TrainingType = 1 
	      THEN CAST(SUBSTRING(SUBSTRING([A].[TrainingCode], CHARINDEX(''-'', [A].[TrainingCode])+1, LEN( [A].[TrainingCode])), CHARINDEX(''-'', SUBSTRING([A].[TrainingCode], CHARINDEX(''-'', [A].[TrainingCode])+1, LEN( [A].[TrainingCode])))+1, LEN(SUBSTRING([A].[TrainingCode], CHARINDEX(''-'',[A].[TrainingCode])+1, LEN( [A].[TrainingCode])))) AS INT)
	      ELSE ''-1''
	       END                                                         AS [PwayCode]
	   , CAST([a].[StartDate] AS DATE)                                 AS TrainingStartDate
	   , CAST([a].[EndDate] AS DATE)                                   AS TrainingEndDate
	   , CAST(C.TransferSenderId AS bigint)                            as TransferSenderAccountId

	    , Convert(nvarchar(50), CASE WHEN TransferApprovalStatus is null 
									THEN null
                                WHEN TransferApprovalStatus = ''0''
							       THEN ''Pending''
								WHEN TransferApprovalStatus = ''1''
									THEN ''TransferApproved''
								WHEN  TransferApprovalStatus = ''2''
									 THEN ''TransferRejected''
								END
				) AS  TransferApprovalStatus


	   , CAST(C.TransferApprovalActionedOn AS DateTime)                as TransferApprovalDate
	   , CAST(A.Cost as decimal(18,0))                                 as TrainingTotalCost
	   , CAST(GETDATE() AS DateTime)                                   AS UpdateDateTime
	   , CAST(GETDATE() AS Date)                                       as UpdateDate
	   , ISNULL(CAST(1 AS BIT),-1)                                     AS Flag_Latest

	--   , CAST(C.LegalEntityID AS VARCHAR(50))                          AS LegalEntityCode
	--   , CAST(C.LegalEntityName as varchar(100))                       AS LegalEntityName

	
     	, CAST(le.code AS VARCHAR(50))                                  AS LegalEntityCode
		, CAST(AcctLE.Name  as varchar(100))                            AS LegalEntityName


--	   , CAST((CASE WHEN C.LegalEntityOrganisationType =1 THEN ''CompaniesHouse''
--	              WHEN C.LegalEntityOrganisationType=2 THEN ''Charities''
--			      WHEN C.LegalEntityOrganisationType=3 THEN ''Public Bodies''
--			      ELSE ''Other''
--		      END) AS Varchar(20))                                     as LegalEntitySource


	   , CAST((CASE WHEN LE.Source = 1 THEN ''CompaniesHouse''
	              WHEN LE.Source = 2 THEN ''Charities''
			      WHEN LE.Source = 3  THEN ''Public Bodies''
			      ELSE ''Other''
		      END) AS Varchar(20))                                     as LegalEntitySource


	   , CAST(COALESCE(LE.ID,-1) AS BIGINT)                            AS DasLegalEntityId 
	   , CAST(A.DateOfBirth as DATE)                                   as DateOfBirth
	   , CASE WHEN [a].[DateOfBirth] IS NULL	THEN - 1
		      WHEN DATEPART([M], [a].[DateOfBirth]) > DATEPART([M], [a].[StartDate])
			    OR DATEPART([M], [a].[DateOfBirth]) = DATEPART([M], [a].[StartDate])
			   AND DATEPART([DD], [a].[DateOfBirth]) > DATEPART([DD], [a].[StartDate])
			  THEN DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate]) - 1
		      ELSE DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate])
		END                                                            AS [CommitmentAgeAtStart]
'
SET @VSQL4=
'	   , ISNULL(CAST((CASE 
		               WHEN [a].[DateOfBirth] IS NULL THEN ''- 1''
					   WHEN CASE
				            WHEN DATEPART([M], [a].[DateOfBirth]) > DATEPART([M], [a].[StartDate])
					          OR DATEPART([M], [a].[DateOfBirth]) = DATEPART([M], [a].[StartDate])
					         AND DATEPART([DD], [a].[DateOfBirth]) > DATEPART([DD], [a].[StartDate])
					        THEN DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate]) - 1
				            ELSE DATEDIFF(YEAR, [a].[DateOfBirth], [a].[StartDate])
				             END BETWEEN 0  AND 18 
							THEN ''16-18''
		                ELSE ''19+''
		                 END) as Varchar(5)),''NA'')                      AS [CommitmentAgeAtStartBand]
		--,RealisedCommitment
        , ISNULL(CAST((CASE WHEN P.TotalAmount>0 THEN ''Yes'' ELSE ''No'' END) as Varchar(3)),''NA'') AS RealisedCommitment
		, ISNULL(CAST((CASE WHEN [a].[StartDate] BETWEEN DATEADD(mm, DATEDIFF(mm, 0, GETDATE()), 0)
				             AND DATEADD(dd, - 1, DATEADD(mm, DATEDIFF(mm, 0, GETDATE()) + 1, 0))
		                    THEN ''Yes''
		                    ELSE ''No''
		                     END) AS VARCHAR(3)),''NA'')              AS StartDateInCurrentMonth
		--,DATEADD(mm, DATEDIFF(mm, 0, GETDATE()), 0)                 AS [Start day of current month]
		--,DATEADD(dd, - 1, DATEADD(mm, DATEDIFF(mm, 0, GETDATE()) + 1, 0)) AS [Last day of current month]
		, CASE WHEN C.Approvals=0 THEN 1
		       WHEN C.Approvals=1 THEN 2
			   WHEN C.Approvals=2 THEN 3
			   WHEN C.Approvals=3 THEN 4
			   WHEN C.Approvals=4 THEN 5
			   WHEN C.Approvals=7 THEN 6
			   ELSE 9
			   END                                                   AS [AgreementStatus_SortOrder]
		, CASE WHEN A.PaymentStatus=0 THEN 1
		       WHEN A.PaymentStatus=1 THEN 2
			   WHEN A.PaymentStatus=2 THEN 3
			   WHEN A.PaymentStatus=3 THEN 4
			   WHEN A.PaymentStatus=4 THEN 5
			   WHEN A.PaymentStatus=5 THEN 6
			   ELSE 9
			   END                                                   AS [PaymentStatus_SortOrder]

	--	, CAST(C.LegalEntityName as nvarchar(100))                   as DASAccountName
	    ,  CAST(AcctLE.Name  as nvarchar(100))                       AS DASAccountName

		, ISNULL(CAST((CASE WHEN C.Approvals IN (3,7) THEN ''Yes''
		                    ELSE ''No''
			                 END) AS Varchar(3)),''NA'')             as FullyAgreedCommitment

	 --   , CAST(C.LegalEntityAddress as nvarchar(256))          as LegalEntityRegisteredAddress
	      , CAST(AcctLE.Address as nvarchar(256))                as LegalEntityRegisteredAddress


		,  CONVERT(bit, CASE WHEN  isnull(A.AgreementStatus,''0'') =''3''
								THEN C.ApprenticeshipEmployerTypeOnApproval
							ELSE null
							END 
				  ) as ApprenticeshipEmployerTypeOnApproval
        , CONVERT(bit, CASE WHEN isnull(A.AgreementStatus,''0'') <> ''3''
								THEN acct1.ApprenticeshipEmployerType
							ELSE null
							END 
				  ) as ApprenticeshipEmployerType



FROM [Comt].[Ext_Tbl_Commitment] C 
LEFT JOIN [Comt].[Ext_Tbl_Apprenticeship] A
  ON C.Id=A.CommitmentId
  
LEFT JOIN [Acct].[Ext_Tbl_AccountLegalEntity] AcctLE
ON c.AccountLegalEntityId = AcctLE.ID


LEFT JOIN [Comt].[Ext_Tbl_Accounts] Acc
  ON Acc.Id=c.EmployerAccountId

 -- LEFT JOIN [Acct].[Ext_Tbl_LegalEntity] LE
 --   ON LE.Code=c.LegalEntityId
   
LEFT JOIN [Acct].[Ext_Tbl_LegalEntity] LE  
  ON AcctLE.LegalEntityId = LE.id

LEFT JOIN [Acct].[Ext_Tbl_Account] acct1
  ON acct1.id = c.EmployerAccountId
LEFT JOIN (SELECT P.ApprenticeshipId 
        ,SUM(P.Amount) as TotalAmount
        FROM Fin.Ext_Tbl_Payment P
	   inner join
	        (select P.AccountId
	               ,P.ApprenticeshipId as CommitmentId
		           ,P.DeliveryPeriodMonth
		           ,P.DeliveryPeriodYear
		           ,MAX(CAST(P.CollectionPeriodYear AS VARCHAR(255)) + ''-'' + CAST(P.CollectionPeriodMonth AS VARCHAR(255))) AS Max_CollectionPeriod
		           ,1 AS Flag_Latest
	           from Fin.Ext_Tbl_Payment p
	          group by
	                P.AccountId
		           ,P.ApprenticeshipId 
		           ,P.DeliveryPeriodMonth
		           ,P.DeliveryPeriodYear
	         ) as LP ON LP.AccountId=P.AccountId
	                AND LP.CommitmentId=P.ApprenticeshipId
			        AND LP.DeliveryPeriodMonth=P.DeliveryPeriodMonth
			        AND LP.DeliveryPeriodYear=P.DeliveryPeriodYear
			        AND LP.Max_CollectionPeriod=(CAST(P.CollectionPeriodYear as VARCHAR(255))+''-''+ CAST(P.CollectionPeriodMonth AS VARCHAR(255)))
	      GROUP BY P.ApprenticeshipId) P on P.ApprenticeshipId=A.ID
LEFT JOIN dbo.ReferenceData RD
       ON RD.Category=''Commitments''
      AND RD.FieldName=''Approvals''
      AND RD.FieldValue=C.Approvals
'

EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2+@VSQL3+@VSQL4)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateCommitmentsView_LevyInd',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateCommitmentsView_LevyInd].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateCommitmentsView_LevyInd].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="13620" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateCommitmentsView_LevyInd]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateDashboardRegistrationView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma EVani
-- Create Date: 27/07/2020
-- Description: Campaign Dashboard Registrations View
-- ===========================================================================

BEGIN TRY
	DECLARE @LogID int

		/* Start Logging Execution */

	  INSERT INTO Mgmt.Log_Execution_Results
		  (
			RunId
		   ,StepNo
		   ,StoredProcedureName
		   ,StartDateTime
		   ,Execution_Status
		  )
	  SELECT 
			@RunId
		   ,'Step-4'
		   ,'CreateDashboardRegistrationView'
		   ,getdate()
		   ,0

	  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
	   WHERE StoredProcedureName='CreateDashboardRegistrationView'
		 AND RunId=@RunID


		DECLARE @VSQL1 NVARCHAR(MAX)
		DECLARE @VSQL2 VARCHAR(MAX)
		DECLARE @VSQL3 VARCHAR(MAX)
		DECLARE @VSQL4 VARCHAR(MAX)


		SET @VSQL1='
		if exists(select 1  from INFORMATION_SCHEMA.VIEWS    Where TABLE_NAME =''DAS_Dashboard_Registration'' And Table_Schema =''AsData_PL'')
			Drop View AsData_PL.DAS_Dashboard_Registration'
	    SET @VSQL2='
		Create View AsData_PL.DAS_Dashboard_Registration
		As	
		with SaltKeyData as 
		(
			Select TOP 1 SaltKeyID,SaltKey From AsData_PL.SaltKeyLog Where SourceType =''CampaignDashboard''  Order by SaltKeyID DESC 
		),
		regbasequery as 
		(
		SELECT		
					Case When Account.ApprenticeshipEmployerType = 2 Then NULL Else Account.ApprenticeshipEmployerType End AS AAET,  
					CASE 				
					WHEN Account.Id IS NOT NULL THEN convert(NVarchar(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Account.Id, SaltKeyData.SaltKey)))),2)  					
					END AS AID,		
					AccountLegalEntity.Created AS LECD, 
					Case when AccountLegalEntity.SignedAgreementVersion != -1 Then AccountLegalEntity.SignedAgreementVersion Else NULL End AS ASV,
					SaltKeyID
		FROM		Acct.Ext_Tbl_AccountLegalEntity AccountLegalEntity
					FULL OUTER JOIN Acct.Ext_Tbl_Account Account 
					ON Account.Id = AccountLegalEntity.AccountId
					CROSS JOIN SaltKeyData 
					WHERE Account.CreatedDate >= ''01-Jan-2020''	
		)
		Select AID,AAET As ''L/NL'',ASV As any_ASV,RegistrationDate,DATEPART(m, RegistrationDate) as MonthNumber,datename(month,RegistrationDate) as [Month],SaltKeyID
		FROM 
		(		
				Select AIDwithMinLECD.AID,AIDWithOthers.AAET,AIDWithOthers.ASV,AIDwithMinLECD.MIN_LECD,
						Case when AIDWithOthers.ASV IS NOT NULL Then AIDwithMinLECD.MIN_LECD Else NULL End As RegistrationDate,SaltKeyID
				from
				(
					select AID,MIN(LECD) MIN_LECD from regbasequery group by AID
				) AIDwithMinLECD  join 
				(
					select AID,AAET,ASV,SaltKeyID from regbasequery group by  AID,AAET,ASV,SaltKeyID 
				) AIDWithOthers on AIDwithMinLECD.AID =  AIDWithOthers.AID 	
		) As finalQuery 
		Where RegistrationDate  IS NOT NULL'

		EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
		EXEC (@VSQL2) -- run sql to create view. 

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=1
			  ,EndDateTime=getdate()
			  ,FullJobStatus='Pending'
		 WHERE LogId=@LogID
		   AND RunId=@RunId

 
END TRY
BEGIN CATCH
		DECLARE @ErrorId int

		INSERT INTO Mgmt.Log_Error_Details
			(UserName
			,ErrorNumber
			,ErrorState
			,ErrorSeverity
			,ErrorLine
			,ErrorProcedure
			,ErrorMessage
			,ErrorDateTime
			,RunId
			)
		SELECT 
			SUSER_SNAME(),
			ERROR_NUMBER(),
			ERROR_STATE(),
			ERROR_SEVERITY(),
			ERROR_LINE(),
			'CreateDashboardRegistrationView',
			ERROR_MESSAGE(),
			GETDATE(),
			@RunId as RunId; 

		SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

		/* Update Log Execution Results as Fail if there is an Error*/

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=0
			  ,EndDateTime=getdate()
			  ,ErrorId=@ErrorId
		 WHERE LogId=@LogID
		   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardRegistrationView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateDashboardRegistrationView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3975" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateDashboardRegistrationView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateDashboardReservationAndCommitmentView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma EVani
-- Create Date: 27/07/2020
-- Description: Compaign Dashboard Reservation and Commitments 
-- ===========================================================================

BEGIN TRY
	DECLARE @LogID int

		/* Start Logging Execution */

	  INSERT INTO Mgmt.Log_Execution_Results
		  (
			RunId
		   ,StepNo
		   ,StoredProcedureName
		   ,StartDateTime
		   ,Execution_Status
		  )
	  SELECT 
			@RunId
		   ,'Step-4'
		   ,'CreateDashboardReservationAndCommitmentView'
		   ,getdate()
		   ,0

	  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
	   WHERE StoredProcedureName='CreateDashboardReservationAndCommitmentView'
		 AND RunId=@RunID

		DECLARE @VSQL1 NVARCHAR(MAX)
		DECLARE @VSQL2 VARCHAR(MAX)
		DECLARE @VSQL3 VARCHAR(MAX)
		DECLARE @VSQL4 VARCHAR(MAX)	

			SET @VSQL1='
		if exists(select 1  from INFORMATION_SCHEMA.VIEWS    Where TABLE_NAME =''DAS_Dashboard_ReservationAndCommitment'' And Table_Schema =''AsData_PL'')
			Drop View AsData_PL.DAS_Dashboard_ReservationAndCommitment'
		  
		SET @VSQL2='CREATE VIEW [ASData_PL].[DAS_Dashboard_ReservationAndCommitment] As 
		with SaltKeyData as 
		(
			Select TOP 1 SaltKeyID,SaltKey From AsData_PL.SaltKeyLog Where SourceType =''CampaignDashboard''  Order by SaltKeyID DESC 
		),
		reservationbase as 
		(
			SELECT B1,B2,B3,B4,B5,B6,B7,B8,B9,B11,B13,B16,B17,B26,CommDateTransfer,CommDateBase,
				   case when CommDateTransfer IS NULL Then 1 Else 0 End as NoTransfer,case when CommDateTransfer IS NULL Then CommDateBase Else CommDateTransfer End as ApprovedDate,SaltKeyID
			FROM
			(
				SELECT CASE WHEN Apprenticeship.Id IS NOT NULL THEN CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Apprenticeship.Id, SaltKeyData.SaltKey)))),2) END AS B1,
					Case when Cast(Apprenticeship.CreatedOn as Date) != cast(''9999-12-31'' as Date) then Apprenticeship.CreatedOn Else NULl End AS B2,
					Reservation.CreatedDate AS B3,
					CASE WHEN Reservation.Id IS NOT NULL THEN CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Reservation.Id, SaltKeyData.SaltKey)))),2) END AS B4,
					Case when Cast(Reservation.StartDate as Date) != cast(''9999-12-31'' as Date) then Reservation.StartDate Else NULl End AS B5, 
					Case when Cast(Reservation.ExpiryDate as Date) != cast(''9999-12-31'' as Date) then Reservation.ExpiryDate Else NULl End AS B6, 
					Cast(COALESCE(Reservation.Status, -1) as Int) AS B7,
					Case when upper(trim(Reservation.CourseId)) =''NULL''  Or  trim(Reservation.CourseId) = '''' Or trim(Reservation.CourseId) = ''-99999'' Then NULL Else  trim(Reservation.CourseId) End AS B8, 
					Case when Cast(Course.Level As Int) != -1 Then Cast(Course.Level As Int) Else NULL End AS B9, 								
					Case when Cast(Apprenticeship.StartDate as Date) != cast(''9999-12-31'' as Date) then Apprenticeship.StartDate Else NULl End AS B11,
					case when upper(trim(Apprenticeship.TrainingCode)) =''NULL'' or  upper(trim(Apprenticeship.TrainingCode)) = '''' or trim(Apprenticeship.TrainingCode) = ''-99999'' Then NULL Else trim(Apprenticeship.TrainingCode) End AS B13,												
					COALESCE(Apprenticeship.IsApproved, -1)	AS B16,	Apprenticeship.Cost AS B17,												
					Case when Cast(Commitment.ApprenticeshipEmployerTypeOnApproval As Int) != -1 Then Cast(Commitment.ApprenticeshipEmployerTypeOnApproval As Int) Else NULL End AS B26,
					Case when COALESCE(Commitment.TransferApprovalStatus, 1) = 7 Then case when cast(Commitment.TransferApprovalActionedOn as date) != cast(''9999-12-31'' as Date) then cast(Commitment.TransferApprovalActionedOn as date) Else NULL End else NULL End	as CommDateTransfer,										
					Case when COALESCE(Commitment.Approvals, 1) = 3 AND COALESCE(Commitment.TransferApprovalStatus, 1) = 1 Then cast(Commitment.EmployerAndProviderApprovedOn as datetime) Else NULL End as CommDateBase,SaltKeyData.SaltKeyID
			FROM	Comt.Ext_Tbl_Apprenticeship Apprenticeship FULL OUTER JOIN Resv.Ext_Tbl_Reservation Reservation ON Reservation.Id = Apprenticeship.ReservationId 
					FULL OUTER JOIN Resv.Ext_Tbl_Course Course ON Course.CourseId = Reservation.CourseId FULL OUTER JOIN Comt.Ext_Tbl_Commitment Commitment ON Commitment.Id = Apprenticeship.CommitmentId CROSS JOIN SaltKeyData 	WHERE	Reservation.CreatedDate >= ''01-Jan-2020''
			) As reservation
		) , stdFrameworks as 
		(select Code,[Name],[Route],[Level] from AsData_PL.DAS_Dashboard_StdsAndFrameworks),'
		Set @VSQL3=' reseravations as 
		(Select B8 As Code,a.B4,b.any_B1,b.any_B2,b.any_B3,b.any_B5,b.any_B6,average_B7,average_B9,stdFrameworks.[Name],stdFrameworks.[Route],stdFrameworks.[Level],b.SaltKeyID
		from 
			(Select B4,B8,AVG(B7) AS average_B7,AVG(B9) as average_B9 From reservationbase  group by B4,B8) as a 
			JOIN (	select  B4,B1 as any_B1,B2 As any_B2,B3 As any_B3,B5 as any_B5,B6 as any_B6,SaltKeyID 
				From reservationbase where B5 IS NOT NULL group by B4,B1,B2,B3,B5,B6,SaltKeyID) as b 
				on a.B4 = b.B4 LEFT JOIN stdFrameworks on a.B8 = stdFrameworks.Code and stdFrameworks.Code IS NOT NULL Where a.B8  IS NOT NULL  
		)
		, payments as  
		(	Select C1,Case When MIN(C2) = 6 Then Convert(Date,''01/01/2020'',103)  When MIN(C2) = 7 Then Convert(Date,''01/02/2020'',103) 
							When MIN(C2) = 8 Then Convert(Date,''01/03/2020'',103)  When MIN(C2) = 9 Then Convert(Date,''01/04/2020'' ,103)
							When MIN(C2) = 10 Then Convert(Date,''01/05/2020'',103) When MIN(C2) = 11 Then Convert(Date,''01/06/2020'',103) 
							When MIN(C2) = 12 Then Convert(Date,''01/07/2020'',103) End As Min_C2 
			from (	SELECT		DISTINCT CASE WHEN App.Id IS NOT NULL THEN  CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(App.Id, SaltKeyData.SaltKey)))),2) END AS C1,Pay.CollectionPeriod AS C2
				FROM		Comt.Ext_Tbl_Apprenticeship App JOIN StgPmts.Payment Pay ON Pay.LearnerUln = App.Uln CROSS JOIN SaltKeyData	 
				WHERE		Pay.AcademicYear = ''1920''	AND		Pay.CollectionPeriod IN (6, 7, 8, 9, 10, 11, 12, 13, 14)
			)  as outerquery group by C1
		),'
		Set @VSQL4=' reservationtraining as 
		(	
				Select  r.B1,r.B13,r.B2,r.B4,r.B5,case when r.B5 IS NULL Then 0 Else 1 End as ReservedFlag,
						r.B11,r.B16,r.B17,r.B26,r.ApprovedDate,case when r.ApprovedDate IS NULL Then 0 Else 1 End ApprovedFlag,
						DateDiff(day,r.B2,r.ApprovedDate) as CommittedApprovedLag,p.Min_C2,case when p.Min_C2 IS NULL then 0 Else 1 End as StartedFlag,
						datediff(day,r.ApprovedDate,p.min_c2) as ApprovedtoStartedLag,r.SaltKeyID									
				from	reservationbase r left join payments p on r.B1 = p.C1 Where r.B1 IS NOT NULL 
		)
		select reseravations.B4,reservationtraining.B1,case when reseravations.any_B1 IS NOT NULL Then  1 Else 0 End as CommitmentFlag,
			reseravations.code,reseravations.any_B1,reseravations.any_B2,reseravations.any_B3,
			Datediff(day,reseravations.Any_B3,reseravations.Any_B2) as [Reserve-Commit Lag],reseravations.any_B5,
			reseravations.any_B6,reseravations.average_B7,reseravations.average_B9,reseravations.Name,
			reseravations.Route,reseravations.Level,reservationtraining.ApprovedDate,
			reservationtraining.CommittedApprovedLag as [Committed-ApprovedLag],reservationtraining.min_C2,
			Case when reservationtraining.ApprovedFlag IS NULL then 0 Else reservationtraining.ApprovedFlag End as ApprovedFlag,
			Case when reservationtraining.StartedFlag IS NULL then 0 Else reservationtraining.StartedFlag End as StartedFlag,
			reservationtraining.ApprovedtoStartedLag,reservationtraining.SaltKeyID							  
		from reseravations LEFT JOIN reservationtraining on reseravations.B4 = reservationtraining.B4'						

		   EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 							   
		   EXEC (@VSQL2 + @VSQL3 + @VSQL4) -- run sql to create view. 

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=1
			  ,EndDateTime=getdate()
			  ,FullJobStatus='Pending'
		 WHERE LogId=@LogID
		   AND RunId=@RunId

END TRY
BEGIN CATCH
		DECLARE @ErrorId int

		INSERT INTO Mgmt.Log_Error_Details
			(UserName
			,ErrorNumber
			,ErrorState
			,ErrorSeverity
			,ErrorLine
			,ErrorProcedure
			,ErrorMessage
			,ErrorDateTime
			,RunId
			)
		SELECT 
			SUSER_SNAME(),
			ERROR_NUMBER(),
			ERROR_STATE(),
			ERROR_SEVERITY(),
			ERROR_LINE(),
			'CreateDashboardReservationAndCommitmentView',
			ERROR_MESSAGE(),
			GETDATE(),
			@RunId as RunId; 

		SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

		/* Update Log Execution Results as Fail if there is an Error*/

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=0
			  ,EndDateTime=getdate()
			  ,ErrorId=@ErrorId
		 WHERE LogId=@LogID
		   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardReservationAndCommitmentView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateDashboardReservationAndCommitmentView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="8935" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateDashboardReservationAndCommitmentView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateDashboardReservationAndTrainingView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma EVani
-- Create Date: 27/07/2020
-- Description: Campaign Dashboard Reservation and Training
-- ===========================================================================

BEGIN TRY
	DECLARE @LogID int

		/* Start Logging Execution */

	  INSERT INTO Mgmt.Log_Execution_Results
		  (
			RunId
		   ,StepNo
		   ,StoredProcedureName
		   ,StartDateTime
		   ,Execution_Status
		  )
	  SELECT 
			@RunId
		   ,'Step-4'
		   ,'CreateDashboardReservationAndTrainingView'
		   ,getdate()
		   ,0

	  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
	   WHERE StoredProcedureName='CreateDashboardReservationAndTrainingView'
		 AND RunId=@RunID


		DECLARE @VSQL1 NVARCHAR(MAX)
		DECLARE @VSQL2 VARCHAR(MAX)
		DECLARE @VSQL3 VARCHAR(MAX)
		DECLARE @VSQL4 VARCHAR(MAX)	


		SET @VSQL1='
		if exists(select 1  from INFORMATION_SCHEMA.VIEWS    Where TABLE_NAME =''DAS_Dashboard_ReservationAndTraining'' And Table_Schema =''AsData_PL'')
			Drop View AsData_PL.DAS_Dashboard_ReservationAndTraining'


		SET @VSQL2='Create View [ASData_PL].[DAS_Dashboard_ReservationAndTraining]
		As	
		with SaltKeyData as 
		(
		Select TOP 1 SaltKeyID,SaltKey From AsData_PL.SaltKeyLog Where SourceType =''CampaignDashboard''  Order by SaltKeyID DESC 
		), reservationbase as 
		(
			SELECT	B1,B2,B4,B5,B11,B13,B16,B17,B26,B32,Approved,TransferApproved,CommDateTransfer,CommDateBase,
				case when CommDateTransfer IS NULL Then 1 Else 0 End as NoTransfer,
				case when CommDateTransfer IS NULL Then CommDateBase Else CommDateTransfer End as ApprovedDate,
				SaltKeyID
					FROM 
					(	
						SELECT 
						CASE 
						WHEN Apprenticeship.Id IS NOT NULL THEN CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Apprenticeship.Id, SaltKeyData.SaltKey)))),2) 
						END AS B1,												
						Case when Cast(Apprenticeship.CreatedOn as Date) != cast(''9999-12-31'' as Date) then Apprenticeship.CreatedOn Else NULl End AS B2,							
						CASE 
						WHEN Reservation.Id IS NOT NULL THEN CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Reservation.Id, SaltKeyData.SaltKey)))),2) 
						END AS B4,
						Case when Cast(Reservation.StartDate as Date) != cast(''9999-12-31'' as Date) then Reservation.StartDate Else NULl End AS B5, 										
						Case when Cast(Apprenticeship.StartDate as Date) != cast(''9999-12-31'' as Date) then Apprenticeship.StartDate Else NULl End AS B11, 								
						case when upper(trim(Apprenticeship.TrainingCode)) =''NULL'' or  upper(trim(Apprenticeship.TrainingCode)) = '''' or trim(Apprenticeship.TrainingCode) = ''-99999'' Then NULL 
								Else trim(Apprenticeship.TrainingCode) End 
						AS B13,												
						COALESCE(Apprenticeship.IsApproved, -1)	AS B16,				
						Apprenticeship.Cost AS B17,												
						Case when Cast(Commitment.ApprenticeshipEmployerTypeOnApproval As Int) != -1 Then Cast(Commitment.ApprenticeshipEmployerTypeOnApproval As Int) Else NULL End AS B26,									
						Case when Cast(Apprenticeship.CompletionDate as Date) != cast(''9999-12-31'' as Date) then Apprenticeship.CompletionDate Else NULl End AS B32,						
						Case when COALESCE(Commitment.Approvals, 1) = 3 AND COALESCE(Commitment.TransferApprovalStatus, 1) = 1 Then 1 Else 0 End as Approved,						
						Case when COALESCE(Commitment.TransferApprovalStatus, 1) = 7 Then 1 Else 0 End as TransferApproved,						
						Case when COALESCE(Commitment.TransferApprovalStatus, 1) = 7 Then 
								case when cast(Commitment.TransferApprovalActionedOn as date) != cast(''9999-12-31'' as Date) then cast(Commitment.TransferApprovalActionedOn as date) Else NULL End 
							else NULL 		
						End		as CommDateTransfer,						
						Case when COALESCE(Commitment.Approvals, 1) = 3 AND COALESCE(Commitment.TransferApprovalStatus, 1) = 1 Then cast(Commitment.EmployerAndProviderApprovedOn as datetime) Else NULL End as CommDateBase,
						SaltKeyData.SaltKeyID
			FROM		Comt.Ext_Tbl_Apprenticeship Apprenticeship
						FULL OUTER JOIN Resv.Ext_Tbl_Reservation Reservation
						ON Reservation.Id = Apprenticeship.ReservationId
						FULL OUTER JOIN Comt.Ext_Tbl_Commitment Commitment
						ON Commitment.Id = Apprenticeship.CommitmentId
						CROSS JOIN SaltKeyData 
			WHERE		Reservation.CreatedDate >= ''01-Jan-2020''
		) As reservations
		),   
		stdFrameworks as 
		(
			select Code,[Name],[Route],[Level] from AsData_PL.DAS_Dashboard_StdsAndFrameworks
		) '
		SET @VSQL3 =  ', payments as    
		(	
			Select C1,
					Case When MIN(C2) = 6 Then Convert(Date,''01/01/2020'',103)
						When MIN(C2) = 7 Then Convert(Date,''01/02/2020'',103)
						When MIN(C2) = 8 Then Convert(Date,''01/03/2020'',103)
						When MIN(C2) = 9 Then Convert(Date,''01/04/2020'',103)
						When MIN(C2) = 10 Then Convert(Date,''01/05/2020'',103)
						When MIN(C2) = 11 Then Convert(Date,''01/06/2020'',103)
						When MIN(C2) = 12 Then Convert(Date,''01/07/2020'',103)	
					End As Min_C2
			from 
			(
						SELECT	DISTINCT CASE 									
								WHEN App.Id IS NOT NULL THEN  CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(App.Id, SaltKeyData.SaltKey)))),2)
								END AS C1,
								Pay.CollectionPeriod AS C2
					FROM		Comt.Ext_Tbl_Apprenticeship App
								JOIN StgPmts.Payment Pay
								ON Pay.LearnerUln = App.Uln
								CROSS JOIN SaltKeyData 
					WHERE		Pay.AcademicYear = ''1920''
					AND		Pay.CollectionPeriod IN (6, 7, 8, 9, 10, 11, 12, 13, 14)
			)  as outerquery
			group by C1
		)
		Select  
				r.B1,
				r.B13,
				r.B2,
				r.B4,
				r.B5,
				case when r.B5 IS NULL Then 0 Else 1 End as ReservedFlag,
				r.B11,
				r.B16,
				r.B17,
				r.B26,
				r.ApprovedDate,
				case when r.ApprovedDate IS NULL Then 0 Else 1 End ApprovedFlag,
				DateDiff(day,r.B2,r.ApprovedDate) as [Committed-ApprovedLag],
				s.Name,
				s.Route,
				s.[Level],
				p.Min_C2,
				case when p.Min_C2 IS NULL then 0 Else 1 End as StartedFlag,
				datediff(day,r.ApprovedDate,p.min_c2) as ApprovedtoStartedLag,
				r.SaltKeyID									
		from	reservationbase r 			
		left join stdFrameworks s on r.B13 = s.Code 
		left join payments p on r.B1 = p.C1
		Where r.B1 IS NOT NULL  '		   

	EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
	EXEC (@VSQL2 + @VSQL3) -- run sql to create view. 

UPDATE Mgmt.Log_Execution_Results
	SET Execution_Status=1
		,EndDateTime=getdate()
		,FullJobStatus='Pending'
	WHERE LogId=@LogID
	AND RunId=@RunId

END TRY
BEGIN CATCH
		DECLARE @ErrorId int

		INSERT INTO Mgmt.Log_Error_Details
			(UserName
			,ErrorNumber
			,ErrorState
			,ErrorSeverity
			,ErrorLine
			,ErrorProcedure
			,ErrorMessage
			,ErrorDateTime
			,RunId
			)
		SELECT 
			SUSER_SNAME(),
			ERROR_NUMBER(),
			ERROR_STATE(),
			ERROR_SEVERITY(),
			ERROR_LINE(),
			'CreateDashboardReservationAndTrainingView',
			ERROR_MESSAGE(),
			GETDATE(),
			@RunId as RunId; 

		SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

		/* Update Log Execution Results as Fail if there is an Error*/

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=0
			  ,EndDateTime=getdate()
			  ,ErrorId=@ErrorId
		 WHERE LogId=@LogID
		   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardReservationAndTrainingView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateDashboardReservationAndTrainingView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="7500" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateDashboardReservationAndTrainingView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateDashboardReservationView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma EVani
-- Create Date: 27/07/2020
-- Description: Campaign Dashboard Reservations View
-- ===========================================================================

BEGIN TRY
	DECLARE @LogID int

		/* Start Logging Execution */

	  INSERT INTO Mgmt.Log_Execution_Results
		  (
			RunId
		   ,StepNo
		   ,StoredProcedureName
		   ,StartDateTime
		   ,Execution_Status
		  )
	  SELECT 
			@RunId
		   ,'Step-4'
		   ,'CreateDashboardReservationView'
		   ,getdate()
		   ,0

	  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
	   WHERE StoredProcedureName='CreateDashboardReservationView'
		 AND RunId=@RunID


		DECLARE @VSQL1 NVARCHAR(MAX)
		DECLARE @VSQL2 VARCHAR(MAX)
		DECLARE @VSQL3 VARCHAR(MAX)
		DECLARE @VSQL4 VARCHAR(MAX)	
	
		

		SET @VSQL1='
		if exists(select 1  from INFORMATION_SCHEMA.VIEWS Where TABLE_NAME =''DAS_Dashboard_Reservation'' And Table_Schema =''AsData_PL'')
			Drop View AsData_PL.DAS_Dashboard_Reservation'

	
	    SET @VSQL2='Create view AsData_PL.DAS_Dashboard_Reservation
		  as 
		  with saltkeydata as 
		  (
			 Select TOP 1 SaltKeyID,SaltKey From AsData_PL.SaltKeyLog Where SourceType =''CampaignDashboard''  Order by SaltKeyID DESC 
		  ),
		  reservationbase as 
		  (
		   SELECT		CASE 
						WHEN Apprenticeship.Id IS NOT NULL THEN convert(NVarchar(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Apprenticeship.Id, saltkeydata.SaltKey)))),2) 
						END AS B1,												
						Case when Cast(Apprenticeship.CreatedOn as Date) != cast(''9999-12-31'' as Date) then Apprenticeship.CreatedOn Else NULl End AS B2,				
						Reservation.CreatedDate AS B3,				
						CASE 
						WHEN Reservation.Id IS NOT NULL THEN CONVERT(NVARCHAR(500),HASHBYTES(''SHA2_512'',LTRIM(RTRIM(CONCAT(Reservation.Id, saltkeydata.SaltKey)))),2) 
						END AS B4,
						Case when Cast(Reservation.StartDate as Date) != cast(''9999-12-31'' as Date) then Reservation.StartDate Else NULl End AS B5, 				
						Case when Cast(Reservation.ExpiryDate as Date) != cast(''9999-12-31'' as Date) then Reservation.ExpiryDate Else NULl End AS B6, 				
						Cast(COALESCE(Reservation.Status, -1) as Int) AS B7, 				
						Case when upper(trim(Reservation.CourseId)) =''NULL''  Or  trim(Reservation.CourseId) = '''' Or trim(Reservation.CourseId) = ''-99999'' Then NULL 
							Else  trim(Reservation.CourseId) 
						End AS B8, 
						Case when Cast(Course.Level As Int) != -1 Then Cast(Course.Level As Int) Else NULL End AS B9,
						SaltKeyID
			FROM		Comt.Ext_Tbl_Apprenticeship Apprenticeship
						FULL OUTER JOIN Resv.Ext_Tbl_Reservation Reservation
						ON Reservation.Id = Apprenticeship.ReservationId				
						FULL OUTER JOIN Resv.Ext_Tbl_Course Course
						ON Course.CourseId = Reservation.CourseId
						CROSS JOIN saltkeydata 
			WHERE		Reservation.CreatedDate >= ''01-Jan-2020''
		   )         
		   , stdFrameworks as 
		   (
				select Code,[Name],[Route],[Level]
				from AsData_PL.DAS_Dashboard_StdsAndFrameworks
		   )
		   Select B8 As Code,a.B4,b.any_B1,b.any_B2,b.any_B3,b.any_B5,b.any_B6,average_B7,average_B9,stdFrameworks.[Name],stdFrameworks.[Route],stdFrameworks.[Level],b.SaltKeyID
		   from 
		   (
				Select B4,B8,AVG(B7) AS average_B7,AVG(B9) as average_B9 From reservationbase  group by B4,B8
			) as a 
			JOIN 
			(
				select  B4,B1 as any_B1,B2 As any_B2,B3 As any_B3,B5 as any_B5,B6 as any_B6,SaltKeyID 
				from reservationbase 
				where B5 IS NOT NULL 
				group by B4,B1,B2,B3,B5,B6,SaltKeyID
		   ) as b 
		   on a.B4 = b.B4
		   LEFT JOIN stdFrameworks on a.B8 = stdFrameworks.Code and stdFrameworks.Code IS NOT NULL
		   Where a.B8  IS NOT NULL  '

			   EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
			   EXEC (@VSQL2) -- run sql to create view. 

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=1
			  ,EndDateTime=getdate()
			  ,FullJobStatus='Pending'
		 WHERE LogId=@LogID
		   AND RunId=@RunId

 
END TRY
BEGIN CATCH
		DECLARE @ErrorId int

		INSERT INTO Mgmt.Log_Error_Details
			(UserName
			,ErrorNumber
			,ErrorState
			,ErrorSeverity
			,ErrorLine
			,ErrorProcedure
			,ErrorMessage
			,ErrorDateTime
			,RunId
			)
		SELECT 
			SUSER_SNAME(),
			ERROR_NUMBER(),
			ERROR_STATE(),
			ERROR_SEVERITY(),
			ERROR_LINE(),
			'CreateDashboardReservationView',
			ERROR_MESSAGE(),
			GETDATE(),
			@RunId as RunId; 

		SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

		/* Update Log Execution Results as Fail if there is an Error*/

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=0
			  ,EndDateTime=getdate()
			  ,ErrorId=@ErrorId
		 WHERE LogId=@LogID
		   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateDashboardReservationView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateDashboardReservationView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="4941" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateDashboardReservationView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerAccountsView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Simon Heath
-- Create Date: 02/10/2019
-- Description: Create Views for EmployerAccounts that mimics RDS view
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerAccountsView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerAccountsView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_Accounts'')
Drop View Data_Pub.DAS_Employer_Accounts
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_Accounts]	AS
SELECT	isnull(CAST(a.Id * 100 as bigint),-1)                                       as Id
	,	isnull(CAST(a.HashedId AS nvarchar(100)),' + @Quote +'XXXXXX' + @Quote + ') AS DasAccountId
	,   isnull(CAST(a.Id as bigint),-1)                                             AS EmployerAccountId
	,	ISNULL(CAST(a.Name as nvarchar(100)),''NA'')                                as DASAccountName
	,	Convert(DATE,a.CreatedDate)                                                 AS DateRegistered
	,	ISNULL(CAST(a.CreatedDate as DateTime),''9999-12-31'')                      AS DateTimeRegistered
	--Owner Email Address suppressed for Data Protection reasons
	,	ISNULL(CAST(' + @Quote + 'Suppressed'  + @Quote + ' AS Varchar(10)),''NA'') AS OwnerEmail
	,  ISNULL(ISNULL(ModifiedDate,CreatedDate),' + @Quote +'9999-12-31' +@Quote+')  AS UpdateDateTime
	-- Additional Columns for UpdateDateTime represented as a Date
	,	ISNULL(ISNULL( Convert(DATE,ModifiedDate), Convert(DATE,CreatedDate)),' + @Quote +'9999-12-31' +@Quote+') AS UpdateDate
	-- Flag to say if latest record from subquery, Using Coalesce to set null value to 0
	,  ISNULL(Cast( 1 AS BIT ),-1)                                                  as Flag_Latest
	--Count of currrent PAYE Schemes
     , isnull(eps.CountOfCurrentPAYESchemes, 0)                                     AS CountOfCurrentPAYESchemes
	--Count of currrent Legal Entities
     , isnull(ele.CountOfCurrentLegalEntities, 0)                                   AS CountOfCurrentLegalEntities
FROM  Acct.Ext_Tbl_Account a
-- Adding Current number of PAYE Schemes
LEFT JOIN 
( SELECT
	  eps.DASAccountID
	, COUNT(*) AS CountOfCurrentPAYESchemes
  FROM Data_Pub.DAS_Employer_PayeSchemes eps
	--Checking if the PAYE Schemes are valid when the view runs using 31 DEC 2999 as default removed date if null
	WHERE GETDATE() BETWEEN eps.AddedDate AND isnull(eps.RemovedDate,' + @Quote + '31 DEC 2999' + @Quote + ')
	GROUP BY eps.DASAccountId
) eps
ON a.HashedId = eps.DASAccountId
-- Adding Current number of LegalEntities
LEFT JOIN
( SELECT ele.DASAccountId
  , Count(*) AS CountOfCurrentLegalEntities
FROM      
    Data_Pub.DAS_Employer_LegalEntities ele
GROUP BY ele.DASAccountID
) ele
ON a.HashedId  = ele.DASAccountId
'
-- SET @VSQL3=' ' 
-- SET @VSQL4=' ' 

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 
-- +@VSQL3+@VSQL4) -- no 3 or 4 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerAccountsView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAccountsView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerAccountsView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="4645" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerAccountsView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerAccountTransactionsView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 24/09/2019
-- Description: Create Views for EmployerAccountTransactions that mimics RDS 
-- =========================================================================

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerAccountTransactionsView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerAccountTransactionsView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_AccountTransactions'')
Drop View Data_Pub.DAS_Employer_AccountTransactions
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_AccountTransactions]
	AS 
With LevyDeclarationAndTopUp
AS
(SELECT AccountId
       ,CreatedDate
	   ,SubmissionDate
	   ,PayrollMonth
	   ,PayrollYear
	   ,EnglishFraction
	   ,LevyDeclaredInMonth
	   ,TopUp
   FROM Fin.Ext_Tbl_GetLevyDeclarationAndTopUp
  WHERE LastSubmission=1
)

'
SET @VSQL3='
     SELECT   CAST(DasAccountID as nvarchar(100))                  as DasAccountId
	         ,ISNULL(CAST(CreatedDate as DateTime),''9999-12-31'') as CreatedDate
			 ,CAST(SubmissionDate as DateTime)                     as SubmissionDate
			 ,CAST(PayrollMonth as tinyint)                        as PayrollMonth
			 ,CAST(PayrollYear as nvarchar(10))                    as PayrollYear
			 ,CAST(CollectionMonth as int)                         as CollectionMonth
			 ,CAST(CollectionYear as int)                          as CollectionYear
			 ,CAST(TransactionType as nvarchar(54))                as TransactionType
			 ,Cast(Amount AS decimal(37,10))                       as Amount
	   FROM (
     SELECT    EA.HashedId AS DasAccountID
          ,    LD.CreatedDate
		  ,	   LD.SubmissionDate
		  ,    LD.PayrollMonth
		  ,    LD.PayrollYear
		  ,    NULL AS CollectionMonth
		  ,    NULL AS CollectionYear
          ,    ''IN Levy Money from HMRC'' AS TransactionType
          ,    ROUND((LD.LevyDeclaredInMonth * LD.EnglishFraction),2) AS Amount
      FROM LevyDeclarationAndTopUp AS LD
	  LEFT
	  JOIN Acct.Ext_Tbl_Account EA ON EA.Id = LD.AccountId 
     UNION ALL
       -- Top Up Amount  
    SELECT     EA.HashedId 
         ,     LD.CreatedDate
  	     ,     LD.SubmissionDate
	     ,     LD.PayrollMonth
	     ,    LD.PayrollYear
		 ,    NULL AS CollectionMonth
		 ,    NULL AS CollectionYear
         ,    ''IN Levy Top Up Amount'' AS TransactionType
         ,    ROUND(LD.TopUp,2) AS Amount
      FROM LevyDeclarationAndTopUp AS LD
	  LEFT
	  JOIN Acct.Ext_Tbl_Account EA ON EA.Id = LD.AccountId 
     UNION ALL
     -- Payments 
    SELECT    EA.HashedId AS DasAccountId
         ,    PS.EvidenceSubmittedOn AS CreatedDate
	     ,     NULL as SubmissionDate
		 ,     NULL as PayrollMonth
		 ,	   NULL as PayrollYear
	     ,     PS.CollectionPeriodMonth
		 ,     ps.CollectionPeriodYear
         ,    ''OUT''+  TT.FieldDesc   AS TransactionType
         ,    ROUND((PS.Amount*-1),2) AS Amount -- Made negative as Payment
      FROM fin.Ext_Tbl_Payment AS PS
 	  LEFT
	  JOIN dbo.ReferenceData TT
		ON TT.FieldValue=PS.TransactionType
	   AND TT.Category=''Payments''
	   AND TT.FieldName=''TransactionType''
      LEFT 
	  JOIN Acct.Ext_Tbl_Account EA ON EA.Id = [PS].AccountId 
     WHERE PS.FundingSource = 1  -- Only Month coming from balances
	 ) T
'

EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2+@VSQL3)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerAccountTransactionsView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAccountTransactionsView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerAccountTransactionsView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="5008" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerAccountTransactionsView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerAccountTransfersView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
/*===========================================================================
Author:      Simon Heath
Create Date: 12/09/2019
Description: Create Views for EmployerAccountTransfers that mimics RDS view

Simon Heath 05/11/2019 ADM-863 Changed where RequiredPaymentId is sourced 
from to workaround production bug in MA where the source has it set as all 
zeroes. 

Future improvements from Hima's review: 
1) TransferId is not unique in DataManagement but it's unique on RDS - worth 
informing Data Science on this.
2) RequiredPaymentID in data management is actually PaymentId on DEDS which 
we don't currently have in source AS databases. We can change this once
DEDS has been staged.
=============================================================================*/

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerAccountTransfersView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerAccountTransfersView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_Account_Transfers'')
Drop View Data_Pub.DAS_Employer_Account_Transfers
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_Account_Transfers]	AS 
	SELECT
	  ISNULL(CAST(AT.Id AS bigint),-1)                               AS TransferId
	, ISNULL(CAST(AT.SenderAccountId AS bigint),-1)                  as SenderAccountId
	, ISNULL(CAST(AT.ReceiverAccountId AS bigint),-1)                as ReceiverAccountId
	, ISNULL(p.PaymentID,''00000000-0000-0000-0000-000000000000'')   AS RequiredPaymentId
	, ISNULL(CAST(A.ID AS bigint),-1)                                AS CommitmentId
	, CAST(p.Amount as decimal(18,5))                                as Amount
	, ISNULL(CAST(AT.Type as nvarchar(50)),''NA'')                   AS Type
	, ISNULL(CAST (p.PeriodEnd AS NVARCHAR(10)),''XXXX'')            AS CollectionPeriodName
	, ISNULL(AT.CreatedDate,''9999-12-31'')                          AS UpdateDateTime
	FROM Fin.Ext_Tbl_AccountTransfers AT
	INNER JOIN Comt.Ext_Tbl_Apprenticeship A 
	  ON AT.ApprenticeshipId = A.ID
	LEFT OUTER JOIN 
	( SELECT xp.PaymentID
	  , xp.ApprenticeshipId
		, xp.PeriodEnd
		, xp.Amount
	  FROM Fin.Ext_Tbl_Payment xp 
	  WHERE xp.Fundingsource = 5 
	) AS p ON at.ApprenticeshipId=p.ApprenticeshipId and at.periodend=p.periodend
'
-- SET @VSQL3='  ' 
-- SET @VSQL4='  ' 

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 
-- +@VSQL3+@VSQL4) -- no 3 or 4 as small view. 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerAccountTransfersView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAccountTransfersView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerAccountTransfersView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="4040" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerAccountTransfersView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerAgreementsView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Simon Heath
-- Create Date: 02/12/2019
-- Description: Create Views for EmployerAgreements that mimics RDS view
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DECLARE @Quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerAgreementsView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerAgreementsView'
     AND RunId=@RunID

DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)


SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_Agreements'')
Drop View Data_Pub.DAS_Employer_Agreements
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_Agreements]	AS 
SELECT 
    ea.Id
  , IsNull ( a.HashedId, ' + @Quote + 'XXXXX' + @Quote + ' )	AS DasAccountId
  , IsNull ( eas.name, ' + @Quote + 'XXXXX' + @Quote + ' )		AS EmployerAgreementStatus
  , IsNull( Cast ( ' + @Quote + 'Suppressed' + @Quote +  ' AS VARCHAR(10) ) , ' 
       + @Quote + 'XXXXX' + @Quote + '	 )							AS SignedBy
  , ea.SignedDate															AS SignedDateTime
	, CAST( ea.SignedDate AS Date )									AS SignedDate
  , ea.ExpiredDate															AS ExpiredDateTime
	, CAST( ea.ExpiredDate AS Date )									AS ExpiredDate
	, IsNull( ale.LegalEntityId, -1)										AS DasLegalEntityId
    , IsNull ( Cast( ale.SignedAgreementId AS NVARCHAR(100) ) 
		, ' + @Quote + 'XXXXX' + @Quote + '	)						AS DasEmployerAgreementID
	, IsNull( CAST 
	( CASE WHEN ea.ExpiredDate IS NOT NULL AND ea.ExpiredDate > ea.SignedDate 
			THEN ea.ExpiredDate
		ELSE ea.SignedDate	
	  END AS DATETIME )
	  , CAST ( ' + @Quote + '9999-12-31' + @Quote + ' AS DATETIME )
	)																			AS UpdateDateTime
	, IsNull( CAST  
	( CASE WHEN ea.ExpiredDate IS NOT NULL AND ea.ExpiredDate > ea.SignedDate 
			THEN ea.ExpiredDate
		ELSE ea.SignedDate	
	  END AS DATE )
	  , CAST ( ' + @Quote + '9999-12-31' + @Quote + ' AS DATE )
	)																			AS UpdateDate
  ,	IsNull ( CAST( 1 AS bit ), -1) 										AS Flag_Latest
FROM Acct.Ext_Tbl_EmployerAgreement ea
	LEFT OUTER JOIN Acct.Ext_Tbl_EmployerAgreementStatus eas
		ON ea.StatusId = eas.Id
	LEFT OUTER JOIN Acct.Ext_Tbl_AccountLegalEntity ale
	  ON ea.AccountLegalEntityId = ale.Id
	LEFT OUTER JOIN Acct.Ext_Tbl_Account a 
	  ON ale.AccountId = a.Id
WHERE ea.SignedDate is not null
'
;

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 


UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerAgreementsView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerAgreementsView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerAgreementsView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3932" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerAgreementsView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerLegalEntitiesView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Simon Heath
-- Create Date: 01/10/2019
-- Description: Create Views for EmployerLegalEntities that mimics RDS view
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @Quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerLegalEntitiesView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerLegalEntitiesView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_LegalEntities'')
Drop View Data_Pub.DAS_Employer_LegalEntities
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_LegalEntities]	AS 
WITH cte_EmpLEs AS
(
  SELECT 
         ISNULL(CAST(ale.LegalEntityId * 10 as bigint), -1)                                                 AS Id
	, ISNULL(CAST(a.HashedId as nvarchar(100)),''XXXXXX'')																AS DasAccountId
	, ISNULL(CAST(ale.LegalEntityId AS bigint), -1)                                                      AS DasLegalEntityId
	, ISNULL(CAST(ale.Name as nvarchar(100)),''NA'')                                                    AS LegalEntityName
	, CAST(ale.Address as nvarchar(256))                                                                as LegalEntityRegisteredAddress
    , CAST(Mgmt.fn_ExtractPostCodeUKFromAddress(UPPER( ale.Address)) as Varchar(8))                     AS LegalEntityRegisteredAddressPostcode
  -- DO we need a valid postcode field
	, ISNULL(CAST((CASE 
                   WHEN le.Source = 3 THEN ''Public Body''
			       WHEN le.Source = 1 THEN ''Companies House''
	               WHEN le.Source = 2 THEN ''Charities''
			       WHEN le.Source = 5 THEN ''Pensions Regulator''
	               ELSE ''Other''
	                END) AS NVARCHAR(50)),''NA'')                                                       AS LegalEntitySource 
  -- Additional Columns for InceptionDate represented as a Date
   , CAST(le.DateOfIncorporation AS DATE)                                                               AS LegalEntityCreatedDate
	-- Column Renamed as has DateTime
	, le.DateOfIncorporation                                                                            AS LegalEntityCreatedDateTime
	, CAST(le.Code as nvarchar(50))                                                                     AS LegalEntityNumber 
	, CAST((CASE
	    WHEN le.Source = 3 THEN le.Code 
		  ELSE ''''
    END) AS NVARCHAR(50))                                                                               AS LegalEntityCompanyReferenceNumber
	, CAST((CASE
		  WHEN  le.Source = 2  THEN le.Code     
      ELSE ''''
	  END) AS nvarchar(50))                                                                             AS LegalEntityCharityCommissionNumber
  , CAST((CASE
          WHEN (isnumeric(le.Code) = 1) THEN CAST( ''active'' AS NVARCHAR )
          ELSE null 
          END) AS nvarchar(50))                                                                         AS  LegalEntityStatus 
	, ISNULL(CAST((CASE
		  -- Other also flag to Red
		  WHEN le.Source not in (3,1,2,5) THEN ''Red'' 
		  -- Charity commission always flag to Green
		  WHEN le.Source = 2 THEN 
        ( CASE 
            WHEN  le.Code  IS NULL OR  le.Code  = ''0'' THEN ''Red'' 
            ELSE ''Green'' 
          END
        ) 
		  -- When company if first to charactors are text then flag as Amber else green
		  WHEN le.Source = 1  THEN -- Companies House
			( CASE 
				  WHEN  le.Code  IS NULL OR  le.Code  = ''0'' THEN ''Red''
				  WHEN ISNUMERIC(LEFT( le.Code ,2)) <> 1 THEN ''Amber''
				  ELSE ''Green''
			  END
      )
		  -- Public Sector always set to Amber
		  WHEN le.Source = 3  THEN ''Amber'' -- Public Bodies
		  ELSE ''ERROR''
	 END) AS Varchar(5)),''NA'')                                                                         AS LegalEntityRAGRating
	, ISNULL(CASE 
             WHEN isnull( ale.Deleted,convert(datetime, ''01 Jan 1900'' )) > ale.Created THEN ale.Deleted
	         ELSE ale.Created
	          END, ''9999-12-31'' )                                                        AS  UpdateDateTime
	-- Additional Columns for UpdateDateTime represented as a Date
	, CASE 
      WHEN isnull( ale.Deleted,convert(datetime, ''01 Jan 1900'' )) > ale.Created THEN Convert(DATE, ale.Deleted)
	    ELSE Convert(DATE, ale.Created)
	  END                                                                                                AS  UpdateDate
	-- Flag to say if latest record from subquery, Using Coalesce to set null value to 0
	, ISNULL((Cast( 1 AS BIT )),-1)                                                                      As Flag_Latest
	, ROW_NUMBER() OVER ( PARTITION BY LegalEntityId, HashedId ORDER BY LegalEntityId, HashedId, 
	  CASE  WHEN isnull( ale.Deleted,convert(datetime, ''01 Jan 1900'' )) > ale.Created 
		THEN Convert(DATE, ale.Deleted) ELSE Convert(DATE, ale.Created) END desc) AS RowNumber
FROM Acct.Ext_Tbl_Account a
JOIN Acct.Ext_Tbl_AccountLegalEntity ale ON a.ID = ale.AccountID
LEFT JOIN Acct.Ext_Tbl_LegalEntity le ON ale.LegalEntityID = le.ID
) 
SELECT Id ,
     DasAccountId,
	   DasLegalEntityId,
	   LegalEntityName,
	   LegalEntityRegisteredAddress,
		 LegalEntityRegisteredAddressPostcode,
	   LegalEntitySource,
	   LegalEntityCreatedDate,
	   LegalEntityCreatedDateTime,
	   LegalEntityNumber,
	   LegalEntityCompanyReferenceNumber,
	   LegalEntityCharityCommissionNumber,
	   LegalEntityStatus,
	   LegalEntityRAGRating,
	   UpdateDateTime,
	   UpdateDate,
	   Flag_Latest
FROM cte_EmpLEs 
WHERE Rownumber = 1
'

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerLegalEntitiesView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerLegalEntitiesView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerLegalEntitiesView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="7280" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerLegalEntitiesView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerLegalEntitiesView_LevyInd]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Simon Heath
-- Create Date: 01/10/2019
-- Description: Create Views for EmployerLegalEntities that mimics RDS view
--
--
--	Change Control
--
--	Date		Author		Ticket			Change						Version
--
--  16/03/2020	R.Rai		ADM 1162		Add IsLevy logic
--                                          with ASData_PL schema      1.1
--
-- ===============================================================================


BEGIN TRY

DECLARE @LogID int
DEClARE @Quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerLegalEntitiesView_LevyInd'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerLegalEntitiesView_LevyInd'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)

SET @VSQL1='
IF EXISTS (SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_LegalEntities_LevyInd'' AND TABLE_SCHEMA = ''ASData_PL'')
BEGIN 
     DROP VIEW      ASData_PL.DAS_Employer_LegalEntities_LevyInd
END

'
SET @VSQL2='

CREATE VIEW [ASData_PL].[DAS_Employer_LegalEntities_LevyInd]	AS 
WITH cte_EmpLEs AS
(
  SELECT 
      ISNULL(CAST(ale.LegalEntityId * 10 as bigint), -1)                                                 AS Id
	, ISNULL(CAST(a.HashedId as nvarchar(100)),''XXXXXX'')												AS DasAccountId
	, ISNULL(CAST(ale.LegalEntityId AS bigint), -1)                                                      AS DasLegalEntityId
	, ISNULL(CAST(ale.Name as nvarchar(100)),''NA'')                                                    AS LegalEntityName
	, CAST(ale.Address as nvarchar(256))                                                                as LegalEntityRegisteredAddress
    , CAST(Mgmt.fn_ExtractPostCodeUKFromAddress(UPPER( ale.Address)) as Varchar(8))                     AS LegalEntityRegisteredAddressPostcode
  -- DO we need a valid postcode field
	, ISNULL(CAST((CASE 
                   WHEN le.Source = 3 THEN ''Public Body''
			       WHEN le.Source = 1 THEN ''Companies House''
	               WHEN le.Source = 2 THEN ''Charities''
			       WHEN le.Source = 5 THEN ''Pensions Regulator''
	               ELSE ''Other''
	                END) AS NVARCHAR(50)),''NA'')                                                       AS LegalEntitySource 
  -- Additional Columns for InceptionDate represented as a Date
   , CAST(le.DateOfIncorporation AS DATE)                                                               AS LegalEntityCreatedDate
	-- Column Renamed as has DateTime
	, le.DateOfIncorporation                                                                            AS LegalEntityCreatedDateTime
	, CAST(le.Code as nvarchar(50))                                                                     AS LegalEntityNumber 
	, CAST((CASE
	    WHEN le.Source = 3 THEN le.Code 
		  ELSE ''''
    END) AS NVARCHAR(50))                                                                               AS LegalEntityCompanyReferenceNumber
	, CAST((CASE
		  WHEN  le.Source = 2  THEN le.Code     
      ELSE ''''
	  END) AS nvarchar(50))                                                                             AS LegalEntityCharityCommissionNumber
  , CAST((CASE
          WHEN (isnumeric(le.Code) = 1) THEN CAST( ''active'' AS NVARCHAR )
          ELSE null 
          END) AS nvarchar(50))                                                                         AS  LegalEntityStatus 
	, ISNULL(CAST((CASE
		  -- Other also flag to Red
		  WHEN le.Source not in (3,1,2,5) THEN ''Red'' 
		  -- Charity commission always flag to Green
		  WHEN le.Source = 2 THEN 
        ( CASE 
            WHEN  le.Code  IS NULL OR  le.Code  = ''0'' THEN ''Red'' 
            ELSE ''Green'' 
          END
        ) 
		  -- When company if first to charactors are text then flag as Amber else green
		  WHEN le.Source = 1  THEN -- Companies House
			( CASE 
				  WHEN  le.Code  IS NULL OR  le.Code  = ''0'' THEN ''Red''
				  WHEN ISNUMERIC(LEFT( le.Code ,2)) <> 1 THEN ''Amber''
				  ELSE ''Green''
			  END
      )
		  -- Public Sector always set to Amber
		  WHEN le.Source = 3  THEN ''Amber'' -- Public Bodies
		  ELSE ''ERROR''
	 END) AS Varchar(5)),''NA'')                                                                         AS LegalEntityRAGRating
	, ISNULL(CASE 
             WHEN isnull( ale.Deleted,convert(datetime, ''01 Jan 1900'' )) > ale.Created THEN ale.Deleted
	         ELSE ale.Created
	          END, ''9999-12-31'' )                                                        AS  UpdateDateTime
	-- Additional Columns for UpdateDateTime represented as a Date
	, CASE 
      WHEN isnull( ale.Deleted,convert(datetime, ''01 Jan 1900'' )) > ale.Created THEN Convert(DATE, ale.Deleted)
	    ELSE Convert(DATE, ale.Created)
	  END                                                                                                AS  UpdateDate
	-- Flag to say if latest record from subquery, Using Coalesce to set null value to 0
	, ISNULL((Cast( 1 AS BIT )),-1)                                                                      As Flag_Latest
	, ROW_NUMBER() OVER ( PARTITION BY LegalEntityId, HashedId ORDER BY LegalEntityId, HashedId, 
	  CASE  WHEN isnull( ale.Deleted,convert(datetime, ''01 Jan 1900'' )) > ale.Created 
		THEN Convert(DATE, ale.Deleted) ELSE Convert(DATE, ale.Created) 
	  END desc) AS RowNumber
	, convert(bit, a.ApprenticeshipEmployerType)                                                        as ApprenticeshipEmployerType
FROM Acct.Ext_Tbl_Account a
JOIN Acct.Ext_Tbl_AccountLegalEntity ale ON a.ID = ale.AccountID
LEFT JOIN Acct.Ext_Tbl_LegalEntity le ON ale.LegalEntityID = le.ID
) 
SELECT Id ,
     DasAccountId,
	   DasLegalEntityId,
	   LegalEntityName,
	   LegalEntityRegisteredAddress,
		 LegalEntityRegisteredAddressPostcode,
	   LegalEntitySource,
	   LegalEntityCreatedDate,
	   LegalEntityCreatedDateTime,
	   LegalEntityNumber,
	   LegalEntityCompanyReferenceNumber,
	   LegalEntityCharityCommissionNumber,
	   LegalEntityStatus,
	   LegalEntityRAGRating,
	   UpdateDateTime,
	   UpdateDate,
	   Flag_Latest,
	   ApprenticeshipEmployerType
FROM cte_EmpLEs 
WHERE Rownumber = 1
'

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerLegalEntitiesView_LevyInd',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerLegalEntitiesView_LevyInd].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerLegalEntitiesView_LevyInd].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="7776" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerLegalEntitiesView_LevyInd]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerPAYESchemesView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Simon Heath
-- Create Date: 16/09/2019
-- Description: Create Views for EmployerPAYESchemes that mimics RDS view
-- ===========================================================================

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerPAYESchemesView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerPAYESchemesView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_PAYESchemes'')
Drop View Data_Pub.DAS_Employer_PAYESchemes
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_PayeSchemes]	AS 
SELECT ISNULL(CAST(ah.Id as bigint),-1)                                                                         as Id
, ISNULL(CAST(a.HashedId as nvarchar(100)),''XXXXXX'')                                                          as DasAccountId 
, HASHBYTES(''SHA2_512'',ah.PayeRef)                                                                            AS PAYEReference
, Cast( p.Name AS nvarchar(100))                                                                                as PAYESchemeName
, ISNULL(Cast(ah.AddedDate AS DateTime),''9999-12-31'')                                                         as AddedDate
, ah.RemovedDate                                                                                                as RemovedDate
, ISNULL(CASE -- make up a last changed date from added/removed.
    WHEN ah.RemovedDate > ah.AddedDate THEN ah.RemovedDate
    ELSE ah.AddedDate 
  END,''9999-12-31'')                                                                                           AS UpdateDateTime
, CASE -- make up a last changed date from added/removed.
    WHEN ah.RemovedDate > ah.AddedDate THEN Cast ( ah.RemovedDate as DATE ) 
    ELSE Cast ( ah.AddedDate AS DATE ) 
  END                                                                                                           AS UpdateDate
, ISNULL(CASE  -- work out IsLatest as the views that reference this view select out the islatest = 1 
    WHEN RANK () OVER (PARTITION BY a.ID, AH.PayeRef ORDER BY ah.RemovedDate DESC, ah.AddedDate DESC ) = 1 THEN Cast(1 AS BIT ) 
    ELSE Cast ( 0 AS BIT ) 
    END,-1)                                                                                                     AS Flag_Latest
FROM Acct.Ext_Tbl_Account a
INNER JOIN Acct.Ext_Tbl_AccountHistory ah ON a.Id = ah.AccountID
INNER JOIN Acct.Ext_Tbl_Paye p ON ah.PayeRef = p.Ref
'
-- SET @VSQL3='  '
-- SET @VSQL4='  '

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 
-- +@VSQL3+@VSQL4) -- no 3 or 4 as small view. 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerPAYESchemesView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerPAYESchemesView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerPAYESchemesView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="4272" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerPAYESchemesView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateEmployerTransferRelationshipView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Simon Heath
-- Create Date: 03/10/2019
-- Description: Create Views for EmployerTransfersRElationship that mimics RDS view
-- ===========================================================================

BEGIN TRY


DECLARE @LogID int
DECLARE @Quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateEmployerTransferRelationshipView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateEmployerTransferRelationshipView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Employer_Transfer_Relationship'')
Drop View Data_Pub.DAS_Employer_Transfer_Relationship
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Employer_Transfer_Relationship]
    AS 
	 SELECT     
	   ISNULL(CAST(a.[Id] as bigint),-1)                         as Id
      ,ISNULL(Cast(SenderAccountId as bigint),-1)                as SenderAccountId
      ,ISNULL(CAST(ReceiverAccountId as bigint),-1)              as ReceiverAccountId
	  ,ISNULL(CAST((CASE WHEN [status] = 2 THEN ' + @Quote + 'Approved' + @Quote + '
			        WHEN [status] = 1 THEN ' + @Quote + 'Pending'  + @Quote + '
		            ELSE ' + @Quote + 'Rejected' + @Quote + '
		       END) AS nvarchar(50)),''NA'')                     as RelationshipStatus
        ,isnull(CAST(d.UserID as bigint),0)                      AS SenderUserId
        ,isnull(CAST(e.UserID as bigint),0)                      as ApproverUserId
		,isnull(CAST(f.UserID as bigint),0)                      as RejectorUserId
        ,isnull(CAST(g.CreatedDate as datetime),''9999-12-31'')  as UpdateDateTime
	    ,ISNULL(Cast (1 AS BIT),-1)                              as IsLatest
        ,CAST(b.Hashedid as nvarchar(100))                       as SenderDasAccountID
        ,CAST(c.Hashedid as nvarchar(100))                       as RecieverDasAccountID
   from acct.Ext_Tbl_TransferConnectionInvitation a
     LEFT JOIN  acct.Ext_Tbl_Account b
   ON a.[SenderAccountId] = b.Id
     LEFT JOIN acct.Ext_Tbl_Account c
   ON a.ReceiverAccountID = c.Id
   LEFT join 
	      (
		    SELECT TransferConnectionInvitationID
			       , max(CreatedDate) as CreatedDate 
				   , max(UserId) as UserID
			FROM acct.Ext_Tbl_TransferConnectionInvitationChange
			WHERE [Status] = 1
			GROUP BY TransferConnectionInvitationID
		  ) d
	ON a.id = d.TransferConnectionInvitationID
	LEFT join 
	      (
		    SELECT TransferConnectionInvitationID
			       , max(CreatedDate) as CreatedDate 
				   , max(UserId) as UserID
			FROM acct.Ext_Tbl_TransferConnectionInvitationChange
			WHERE [Status] = 2
			GROUP BY TransferConnectionInvitationID
		  ) e
	ON a.id = e.TransferConnectionInvitationID
	LEFT join 
	      (
		    SELECT TransferConnectionInvitationID
			       , max(CreatedDate) as CreatedDate 
				   , max(UserId) as UserID
			FROM acct.Ext_Tbl_TransferConnectionInvitationChange
			WHERE [Status] = 3
			GROUP BY TransferConnectionInvitationID
		  ) f
	ON a.id = f.TransferConnectionInvitationID
	LEFT join 
	      (
		    SELECT TransferConnectionInvitationID,
			        max(CreatedDate) as CreatedDate 
			FROM acct.Ext_Tbl_TransferConnectionInvitationChange
			GROUP BY TransferConnectionInvitationID
		  ) g
	ON a.id = g.TransferConnectionInvitationID
'
-- SET @VSQL3='  ' 
-- SET @VSQL4='  ' 

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 
-- +@VSQL3+@VSQL4) -- no 3 or 4 as small view. 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateEmployerTransferRelationshipView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateEmployerTransferRelationshipView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateEmployerTransferRelationshipView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="5073" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateEmployerTransferRelationshipView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateExternalTables]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Dynamically Creates External Tables
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-1'
	   ,'CreateExternalTables'+'-'+@ExternalDataSource
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results 
   WHERE StoredProcedureName='CreateExternalTables'+'-'+@ExternalDataSource
     AND RunId=@RunID

 DECLARE @PrepareSQL nvarchar(max)
 DECLARE @ExecuteSQL nvarchar(max)
 SET @EXECUTESQL=''

 SET @PrepareSQL ='
 SELECT @Result= (
 SELECT DISTINCT '' ''+  ''IF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('''''+@SchemaName+'.[Ext_Tbl_''+so.table_name+'']'''') ) DROP EXTERNAL TABLE '+@SchemaName+'.[Ext_Tbl_''+so.table_name+''] CREATE EXTERNAL TABLE '+@SchemaName+'.[Ext_Tbl_'' + so.TABLE_NAME + ''] ('' + o.list + '')'' 
				 +'' WITH (Data_Source=['+@ExternalDataSource+'],Schema_Name=''''''+so.Table_Schema+'''''',Object_Name=''''''+so.table_name+'''''')''
  FROM '+@SchemaName+'.'+@SysTableName+' so
 CROSS APPLY
   (SELECT STUFF ((SELECT '',''+
           ''  [''+column_name+''] '' + 
           data_type + case data_type
           when ''sql_variant'' then ''''
           when ''text'' then ''''
           when ''ntext'' then ''''
           when ''xml'' then ''''
           when ''decimal'' then ''('' + cast(numeric_precision as varchar) + '', '' + cast(numeric_scale as varchar) + '')''
           else coalesce(''(''+case when character_maximum_length = -1 then ''MAX'' else cast(character_maximum_length as varchar) end +'')'','''') end + '' '' +
           + '' '' +
           (case when IS_NULLABLE = ''No'' then ''NOT '' else '''' end ) + ''NULL '' 
     FROM  '+@SchemaName+'.'+@SysTableName+' Inc
    WHERE  table_name = so.table_name
    ORDER  BY ordinal_position
      FOR  XML PATH('''')),1,1,'''')) o (list)
 WHERE so.table_schema<>''sys''
  AND NOT EXISTS (SELECT 1
                    FROM '+@SchemaName+'.'+@SysTableName+' Exc
				   WHERE Exc.Data_Type=''Xml''
				     AND Exc.Table_Name=so.Table_Name
				 )
  FOR XML PATH(''''))
  '
 
 
 EXEC SP_EXECUTESQL @PrepareSQL,N'@Result varchar(max) out',@ExecuteSQL OUT

 EXEC SP_EXECUTESQL @ExecuteSQL

 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateExternalTables'+'-'+@ExternalDataSource AS ErrorProcedure,
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunId=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateExternalTables].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateExternalTables].[@ExternalDataSource]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateExternalTables].[@SchemaName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateExternalTables].[@SysTableName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateExternalTables].[@ExternalDataSource]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateExternalTables].[@SysTableName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateExternalTables].[@SchemaName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateExternalTables].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="3811" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE CreateExternalTables&#xD;&#xA;(&#xD;&#xA;   @ExternalDataSource Varchar(255),&#xD;&#xA;   @SysTableName varchar(255),&#xD;&#xA;   @SchemaName VarChar(10),&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateLevyDeclarationsView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ================================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 24/09/2019
-- Description: Create Views for LevyDeclarations that mimics RDS LevyDeclarations
-- ================================================================================

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateLevyDeclarationsView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateLevyDeclarationsView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_LevyDeclarations'')
Drop View Data_Pub.DAS_LevyDeclarations
'
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_LevyDeclarations]
	AS 
SELECT  ISNULL(CAST(LD.[Id] AS bigint),-1)                                   AS Id
      , ISNULL(CAST(EA.HashedId as nvarchar(100)),''XXXXXX'')                AS DASAccountID
      , ISNULL(CAST(LD.ID as bigint),-1)                                     AS LevyDeclarationID              
      , HASHBYTES(''SHA2_512'',RTRIM(LTRIM(CAST(LD.empRef AS VARCHAR(20))))) AS PAYEReference
      , CAST(LD.LevyDueYTD AS decimal(18,5))                                 AS LevyDueYearToDate
      , CAST(LD.[LevyAllowanceForYear] as decimal(18,5))                     AS LevyAllowanceForYear
      , LD.[SubmissionDate]                                                  AS SubmissionDateTime
      , CAST(LD.[SubmissionDate] AS DATE)                                    AS SubmissionDate
      , ISNULL(CAST(LD.[SubmissionId] as bigint),-1)                         AS SubmissionID
      , ISNULL(CAST(LD.[PayrollYear] as nvarchar(10)),-1)                    AS PayrollYear
      , ISNULL(CAST(LD.[PayrollMonth] as tinyint),0)                         AS PayrollMonth
      , ISNULL(LD.[CreatedDate],''9999-12-31'')                              AS CreatedDateTime
      , CAST(LD.CreatedDate AS DATE)                                         AS CreatedDate
      , ISNULL(LD.[EndOfYearAdjustment],-1)                                  AS EndOfYearAdjustment
      , CAST(LD.[EndOfYearAdjustmentAmount] as Decimal(18,5))                AS EndOfYearAdjustmentAmount
      , LD.[DateCeased]                                                      AS DateCeased
      , LD.[InactiveFrom]                                                    AS InactiveFrom
      , LD.[InactiveTo]                                                      AS InactiveTo
      , LD.[HmrcSubmissionId]                                                AS HMRCSubmissionID
      , ISNULL(CAST(LD.[EnglishFraction] as decimal(18,5)),-1)               AS EnglishFraction
      , ISNULL(CAST(LD.[TopupPercentage] as decimal(18,5)),-1)               AS TopupPercentage
      , ISNULL(CAST(TopUp as decimal(18,5)),-1)                              AS TopupAmount
      , ISNULL(LD.CreatedDate,''9999-12-31'')                                AS UpdateDateTime
	 -- Additional Columns for UpdateDateTime represented as a Date
      ,	CAST(LD.CreatedDate AS DATE)                                         AS UpdateDate
	-- Flag to say if latest record from subquery, Using Coalesce to set null value to 0
      , ISNULL(CAST(1 as Bit),-1)                                            AS Flag_Latest
	  , cast(CM.CalendarMonthShortNameYear AS Varchar(20))                   AS PayrollMonthShortNameYear 
      , Cast(LD.LevyDeclaredInMonth AS decimal(18,5))                        AS LevyDeclaredInMonth
      , Cast(LD.TotalAmount as Decimal(18,5))                                AS LevyAvailableInMonth                            
      , cast(LD.LevyDeclaredInMonth * LD.EnglishFraction as decimal(37,10))  AS LevyDeclaredInMonthWithEnglishFractionApplied
  FROM fin.ext_tbl_getlevydeclarationandtopup AS LD
    LEFT JOIN acct.Ext_Tbl_Account EA 
           ON EA.ID=LD.AccountId
	LEFT JOIN dbo.DASCalendarMonth AS CM 
	       ON LD.PayrollYear = CM.TaxYear AND LD.PayrollMonth = CM.TaxMonthNumber
 WHERE LD.LastSubmission=1
'


EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateLevyDeclarationsView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateLevyDeclarationsView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateLevyDeclarationsView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="5527" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateLevyDeclarationsView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreatePaymentsView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 15/08/2019
-- Description: Create Views for Payments that mimics RDS Payments
-- Simon Heath: 04/11/2019 Amend transfers CTE to remove names to prevent 
-- duplicates and correct names of DeliveryYear and CreateDatetime to match 
-- RDS.
--
--     Change Control
--     
--     Date				Author        Jira        Description
--
--      14/01/2020 R.Rai        ADM_982	    Change Agreement Type to logic to account tables
--      28/01/2020 S Heath      ADM_990     Cast data types to match RDS
--      29/01/2020 H Uddaraju   ADM_1022    Fix Join Condition for Funding Source 
--      06/05/2020 S Heath      ADM_1312    Change source data to use StgPmnts.Payment
-- =====================================================================================================

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreatePaymentsView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreatePaymentsView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Payments'')
Drop View Data_Pub.DAS_Payments
'
-- CTEs
SET @VSQL2='
CREATE VIEW [Data_Pub].[DAS_Payments]
	AS 
WITH cte_Payment AS
( -- rework data from new payments staging table to match data sourced from external table
SELECT
      P.Id
    , P.EventId AS PaymentID
    , P.Ukprn
    , P.LearnerUln
    , P.AccountId
    , P.ApprenticeshipId
    , P.Amount
    , P.FundingSource
    , P.TransactionType
    , P.ContractType
    -- Mapped 0 as -1 in these codes to match original query
    , CASE WHEN P.LearningAimStandardCode = 0 THEN -1 
        ELSE P.LearningAimStandardCode 
      END                                           AS StdCode
    , CASE WHEN P.LearningAimFrameworkCode = 0 THEN -1
        ELSE P.LearningAimFrameworkCode 
     END                                            AS FworkCode
    , CASE WHEN P.LearningAimProgrammeType = 0 THEN -1
        ELSE P.LearningAimProgrammeType
      END                                           AS ProgType
    , CASE WHEN P.LearningAimPathwayCode = 0 THEN -1 
        ELSE P.LearningAimPathwayCode
      END                                           AS PwayCode
    -- derive dates from academic year / month to match original view calendar year values
    -- There are no calendar loookup for collection period R13/14 so deal with them in a case.
    , CASE WHEN P.CollectionPeriod <= 12 THEN CalCP.CalendarMonthNumber                     
        WHEN P.CollectionPeriod = 13 THEN 9
        WHEN P.CollectionPeriod = 14 THEN 10
      END                                           AS CollectionMonth
    , CASE WHEN P.CollectionPeriod <= 12 THEN CalCP.CalendarYear                            
      WHEN P.CollectionPeriod IN (13,14) THEN  
        Cast( ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) AS INT )
      END                                           AS CollectionYear
    , Cast( P.AcademicYear AS varchar) + ''-R'' 
      + RIGHT( ''0'' 
      + Cast (CollectionPeriod AS varchar), 2 )     AS CollectionPeriodName
    , ''R'' + Right( ''0'' 
          + Cast (CollectionPeriod AS varchar), 2 ) AS CollectionPeriodMonth
    , P.AcademicYear                                AS CollectionPeriodYear
    -- Need to lookup actual date for collection date as its used in age calcs (not academic calendar)
    , CASE WHEN P.CollectionPeriod <=12 THEN 
          Cast(CalCP.CalendarYear AS varchar)+ ''-''
          + RIGHT(''0'' + RTRIM(cast(CalCP.CalendarMonthNumber AS varchar)), 2)
          + ''-01''  
        WHEN P.CollectionPeriod = 13 THEN
          ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) 
          + ''-09-01''
        WHEN P.CollectionPeriod = 14 THEN
          ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4)
          + ''-10-01''
      END                                           AS CollectionDate
    , CalDP.CalendarMonthNumber                     AS DeliveryMonth
    , CalDP.CalendarYear                            AS DeliveryYear
    , CalDP.CalendarMonthShortNameYear              AS DeliveryMonthShortNameYear 
    , P.DeliveryPeriod                              AS DeliveryPeriod
    , Cast(CalDP.CalendarYear AS varchar) + ''-''
      + RIGHT(''0'' + RTRIM(cast(CalDP.CalendarMonthNumber AS varchar)), 2)
      + ''-01''                                     AS DeliveryDate
    , P.IlrSubmissionDateTime                       AS EvidenceSubmittedOn
  FROM StgPmts.Payment P
  LEFT OUTER JOIN dbo.DASCalendarMonth CalCP -- Calendar Conversion for CollectionPeriod Dates
    ON ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 1, 2) 
      + ''/'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) = CalCP.AcademicYear 
    AND P.CollectionPeriod = CalCP.AcademicMonthNumber
  LEFT OUTER JOIN dbo.DASCalendarMonth CalDP -- Calendar Conversion for DeliveryPeriod Dates
    ON ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 1, 2) 
      + ''/'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) = CalDP.AcademicYear 
      AND P.DeliveryPeriod = CalDP.AcademicMonthNumber 
) 
'
-- Main Select
SET @VSQL3 = '
SELECT 
    P.ID
  , CAST( P.PaymentId AS nvarchar(100) )                              AS PaymentID  
  , P.UKprn                                                           AS UKPRN 
  , P.LearnerUln                                                      AS ULN 
  , CAST(P.AccountId AS nvarchar(100) )                               AS EmployerAccountID 
  , Acct.HashedId                                                     AS DasAccountId 
  , IsNull( P.ApprenticeshipId, -1)                                   AS CommitmentID 
  , P.DeliveryMonth                                                   AS DeliveryMonth 
  , P.DeliveryYear                                                    AS DeliveryYear 
  , ISNULL( CAST(P.CollectionMonth AS INT), -1)                       AS CollectionMonth 
  , ISNULL( CAST(P.CollectionYear  AS INT), -1)                       AS CollectionYear 
  , ISNULL(CAST( P.EvidenceSubmittedOn AS datetime ), ''9999-12-31'') AS EvidenceSubmittedOn 
  , CAST( NULL AS nvarchar(50) )                                      AS EmployerAccountVersion 
  , CAST( NULL AS nvarchar(50) )                                      AS ApprenticeshipVersion 
	, CAST( COALESCE(FS.FieldDesc,''Unknown'') AS nvarchar(25) )        AS FundingSource
  , CASE
      WHEN P.FundingSource = 5 THEN EAT.SenderAccountId
      ELSE NULL
    END                                                               AS FundingAccountId
	, CAST( COALESCE(TT.FieldDesc,''Unknown'') AS nvarchar(50) )        AS TransactionType
  , ISNULL( CAST( P.Amount AS DECIMAL (18, 5) ), -1 )                 AS Amount
  , P.StdCode
  , P.FworkCode
  , P.ProgType
  , P.PwayCode
  , CAST(CT.FieldDesc AS NVARCHAR(50))                                AS ContractType 
  , ISNULL( CAST( EvidenceSubmittedOn AS DATETIME ), ''9999-12-31'')  AS UpdateDateTime 
  , CAST( EvidenceSubmittedOn AS DATE )                               AS UpdateDate
  , 1                                                                 AS Flag_Latest
  , COALESCE(FP.Flag_FirstPayment, 0)                                 AS Flag_FirstPayment 
  , CASE
      WHEN C.DateOfBirth IS NULL THEN -1
      WHEN DATEPART(M,C.DateOfBirth) > DATEPART(M,P.CollectionDate) 
        OR (DATEPART(M,C.DateOfBirth) = DATEPART(M,P.CollectionDate) 
            AND DATEPART(DD,C.DateOfBirth) > DATEPART(DD,P.CollectionDate)
            ) THEN DATEDIFF(YEAR,C.DateOfBirth,P.CollectionDate) -1
      ELSE DATEDIFF(YEAR, C.DateOfBirth, p.CollectionDate)
    END                                                               AS PaymentAge 
  , CASE
      WHEN C.DateOfBirth IS NULL THEN ''Unknown DOB (no commitment)''
      WHEN 
        CASE
          WHEN C.DateOfBirth IS NULL THEN -1
          WHEN DATEPART(M,C.DateOfBirth) > DATEPART(M,P.CollectionDate) 
            OR ( DATEPART(M,C.DateOfBirth) = DATEPART(M,P.CollectionDate) 
                 AND DATEPART(DD,C.DateOfBirth) > DATEPART(DD,P.CollectionDate)
               ) THEN DATEDIFF(YEAR,C.DateOfBirth,P.CollectionDate) -1
          ELSE DATEDIFF(YEAR,C.DateOfBirth, P.CollectionDate)
        END BETWEEN 0 AND 18 THEN ''16-18''
      ELSE ''19+''
    END                                                               AS PaymentAgeBand 
  , P.DeliveryMonthShortNameYear 
  , Acct.Name                                                         AS DASAccountName 
  , CAST ( P.CollectionPeriodName AS nvarchar(20) )                   AS CollectionPeriodName
  , CAST ( P.CollectionPeriodMonth AS nvarchar(10) )                  AS CollectionPeriodMonth
  , CAST ( P.CollectionPeriodYear AS nvarchar(10) )                   AS CollectionPeriodYear
'
-- Joins
SET @VSQL4 = '
FROM cte_Payment P 
LEFT JOIN Acct.Ext_Tbl_Account Acct ON Acct.Id = P.AccountId
LEFT JOIN Comt.Ext_Tbl_Apprenticeship C
  ON P.ApprenticeshipId = C.ID
LEFT JOIN -- transfers
( SELECT DISTINCT 
    SenderAccountId
    , ReceiverAccountId
    , ApprenticeshipId
  FROM Fin.Ext_Tbl_AccountTransfers
) EAT ON P.ApprenticeshipId = EAT.ApprenticeshipId 
-- need to use cte_payment as weve messed with the delivery dates and they wont join
-- create a string to decide which is min doing individual columns doesnt 
-- work as dates and IDs are in alignment
LEFT JOIN
( SELECT P.AccountId
  , P.ApprenticeshipId
   , MIN( CAST( P.CollectionDate AS VARCHAR (12) ) 
    + ''-'' + CAST( P.DeliveryDate AS varchar(12) )
    + ''-'' + CAST( P.EvidenceSubmittedOn AS varchar(25) )
    + ''-'' + CAST( P.Id AS VARCHAR(12) ) ) AS MinPaymentString
  , 1 AS Flag_FirstPayment
  FROM cte_Payment P
  GROUP BY P.AccountId, P.ApprenticeshipId  
) FP ON P.AccountId = FP.AccountId
  AND ( CAST( P.CollectionDate AS VARCHAR (12) ) 
    + ''-'' + CAST( P.DeliveryDate AS varchar(12) )
    + ''-'' + CAST( P.EvidenceSubmittedOn AS varchar(25) )
    + ''-'' + CAST( P.Id AS VARCHAR(12) ) ) = FP.MinPaymentString
LEFT JOIN dbo.ReferenceData TT
  ON TT.FieldValue = P.TransactionType
    AND TT.FieldName = ''TransactionType''
    AND TT.Category = ''Payments''
LEFT JOIN dbo.ReferenceData FS
  ON FS.FieldValue=P.FundingSource
    AND FS.FieldName=''FundingSource''
    AND FS.Category=''Payments''
LEFT JOIN dbo.ReferenceData CT
  ON CT.FieldValue=P.ContractType
    AND CT.FieldName=''ContractType''
    AND CT.Category=''Payments''
'


EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2+@VSQL3+@VSQL4)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreatePaymentsView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreatePaymentsView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreatePaymentsView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="12199" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreatePaymentsView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreatePaymentsView_LevyInd]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- =========================================================================
-- Author:      Robin Rai
-- Create Date: 15/08/2019
-- Description: Create Payment View with Levy Indicator 
--
--
--     Change Control
--     
--     Date				Author        Jira             Description
--
--      05/03/2020		R.Rai		  ADM_677		  Payment View with Levy Indicator
--      09/03/2020      R.Rai         ADM_677         Change Schema name to ASData_PL
--
-- =====================================================================================================





BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreatePaymentsView_LevyInd'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreatePaymentsView_LevyInd'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='

IF  EXISTS (SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_Payments_LevyInd'' AND TABLE_SCHEMA = ''ASData_PL'' )
BEGIN
     DROP VIEW ASData_PL.DAS_Payments_LevyInd
END

'
SET @VSQL2='
CREATE VIEW [ASData_PL].[DAS_Payments_LevyInd]
	AS 
	SELECT PS.[ID]
      ,PS.[PaymentID]
      ,PS.[UKPRN]
      ,PS.[ULN]
      ,PS.[EmployerAccountID]
      ,PS.[DasAccountId]
      ,PS.[CommitmentID]
      ,PS.[DeliveryMonth]
      ,PS.[DeliveryYear]
      ,PS.[CollectionMonth]
      ,PS.[CollectionYear]
      ,PS.[EvidenceSubmittedOn]
      ,PS.[EmployerAccountVersion]
      ,PS.[ApprenticeshipVersion]
      ,PS.[FundingSource]
      ,PS.[FundingAccountId]
      ,PS.[TransactionType]
      ,PS.[Amount]
      ,PS.[StdCode]
      ,PS.[FworkCode]
      ,PS.[ProgType]
      ,PS.[PwayCode]
      ,PS.[ContractType]
      ,PS.[UpdateDateTime]
      ,PS.[UpdateDate]
      ,PS.[Flag_Latest]
      ,PS.[Flag_FirstPayment]
      ,PS.[PaymentAge]
      ,PS.[PaymentAgeBand]
      ,PS.[DeliveryMonthShortNameYear]
      ,PS.[DASAccountName]
      ,PS.[CollectionPeriodName]
      ,PS.[CollectionPeriodMonth]
      ,PS.[CollectionPeriodYear]
      ,Convert(bit,C.ApprenticeshipEmployerTypeOnApproval)  as ApprenticeshipEmployerTypeOnApproval
   FROM [dbo].[Payments_SS] PS
  LEFT JOIN  [Comt].[Ext_tbl_Apprenticeship] A
  ON A.Id= PS.CommitmentId
  LEFT JOIN  [Comt].[Ext_tbl_Commitment] C 
  ON A.CommitmentID = C.Id
  
'

  


EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreatePaymentsView_LevyInd',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreatePaymentsView_LevyInd].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreatePaymentsView_LevyInd].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="6" />
				<Property Name="Length" Value="3768" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;CREATE PROCEDURE [dbo].[CreatePaymentsView_LevyInd]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateSpendControlNonLevyView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 25/02/2020
-- Description: Spend Control for Non-Levy
-- =========================================================================


/*
Change Control
     
     Date				Author        Jira             Description

  	 01/05/2020			R.Rai        ADM-1471          Remove fields from Commitments

*/


BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateSpendControlNonLevyView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateSpendControlNonLevyView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_SpendControlNonLevy'')
Drop View ASData_PL.DAS_SpendControlNonLevy
'
SET @VSQL2='
CREATE VIEW [ASData_PL].[DAS_SpendControlNonLevy]
	AS
SELECT 
 COALESCE(Account.EmployerAccountId, -1)                                     AS EmployerAccountId
,COALESCE(Account.DasAccountId, ''XXXXXX'')                                  AS DasAccountId
,COALESCE(Account.DasAccountName, ''NA'')                                    AS DasAccountName
--,COALESCE(Account.DasLegalEntityId,''-1'')                                 AS DasLegalEntityId
,COALESCE(Account.LegalEntityName,''NA'')                                    AS LegalEntityName
,COALESCE(Account.LegalEntityCreatedDate, ''9999-12-31'')                    AS AccountLegalEntityCreatedDate   
,COALESCE(CONVERT(VARCHAR(255), Reservation.Id), ''NA'')                     AS ReservationId                              
,CASE 
WHEN Reservation.IslevyAccount = ''1'' THEN ''Yes'' 
WHEN Reservation.IslevyAccount = ''0'' THEN ''No''
ELSE ''NA''
END                                                                          AS ReservationIsLevyAccount 
,COALESCE(Reservation.CreatedDate, ''9999-12-31'')                           AS ReservationCreatedDate 
,COALESCE(Reservation.StartDate, ''9999-12-31'')                             AS ReservationStartDate 
,COALESCE(Reservation.ExpiryDate, ''9999-12-31'')                            AS ReservationExpiryDate 
,CASE 
WHEN Reservation.Status = ''0'' THEN ''Pending''
WHEN Reservation.Status = ''1'' THEN ''Confirmed''
WHEN Reservation.Status = ''2'' THEN ''Completed''
WHEN Reservation.Status = ''3'' THEN ''Deleted''
ELSE ''NA''
END                                                                          AS ReservationStatus 
,COALESCE(Reservation.Courseid, ''NA'')                                      AS ReservationCourseId 
,COALESCE(Course.Title, ''NA'')                                              AS CourseTitle 
,COALESCE(Course.Level, -1)                                                  AS CourseLevel 
,COALESCE(Apprenticeship.Commitmentid, -1)                                   AS ApprenticeshipCommitmentId
,COALESCE(Apprenticeship.Id, -1)                                             AS ApprenticeshipId 
,COALESCE(Apprenticeship.CreatedOn, ''9999-12-31'')                          AS ApprenticeshipCreatedOn 
,COALESCE(Apprenticeship.StartDate, ''9999-12-31'')                          AS ApprenticeshipStartDate 
,COALESCE(Apprenticeship.TrainingType, -1)                                   AS ApprenticeshipTrainingType 
,COALESCE(Apprenticeship.TrainingName, ''NA'')                               AS ApprenticeshipTrainingName 
,COALESCE(Apprenticeship.TrainingCode, ''NA'')                               AS ApprenticeshipTrainingCode 
,COALESCE(Apprenticeship.IsApproved, -1)                                     AS ApprenticeshipIsApproved 
,COALESCE(Apprenticeship.AgreedOn, ''9999-12-31'')                           AS ApprenticeshipAgreedOn 
,Apprenticeship.Cost                                                         AS ApprenticeshipAgreedCost
,COALESCE(Reservation.ProviderId, -1)                                        AS ReservationByEmployerOrProvider
,COALESCE(Commitment.ProviderId, -1)                                         AS CommitmentProviderId

 -- ,COALESCE(Commitment.ProviderName, ''NA'')                               AS CommitmentProviderName
  ,COALESCE(TP.Name, ''NA'')                                                 AS CommitmentProviderName
                           
,COALESCE(RD.FieldDesc,''NA'')                                               AS ApprenticeshipAgreementStatus
,CAST(CASE WHEN Apprenticeship.PaymentStatus=''0'' THEN ''PendingApproval''
	               WHEN Apprenticeship.PaymentStatus=''1'' THEN ''Active''
			       WHEN Apprenticeship.PaymentStatus=''2'' THEN ''Paused''
			       WHEN Apprenticeship.PaymentStatus=''3'' THEN ''Withdrawn''
			       WHEN Apprenticeship.PaymentStatus=''4'' THEN ''Completed''
			       WHEN Apprenticeship.PaymentStatus=''5'' THEN ''Deleted''
			       ELSE ''Unknown''
		       END AS Varchar(50))                                           AS ApprenticeshipPaymentStatus
,COALESCE(CONVERT(VARCHAR(255), Payment.PaymentId), ''NA'')                  AS PaymentId
,COALESCE(Payment.PeriodEnd, ''NA'')                                         AS PaymentPeriodEnd
,COALESCE(RDFS.FieldDesc, ''NA'')                                            AS PaymentFundingSource
,COALESCE(RDTT.FieldDesc, ''NA'')                                            AS PaymentTransactionType
,COALESCE(Payment.ApprenticeshipId, -1)                                      AS PaymentApprenticeshipId
,Payment.Amount                                                              AS PaymentAmount
FROM (SELECT *
        FROM Resv.Ext_Tbl_Reservation
	   WHERE YEAR(CreatedDate) > = 2020
         AND IsLevyAccount = 0) Reservation
LEFT 
JOIN (select Acct.Id as EmployerAccountId
            ,Acct.HashedId as DasAccountId
	        ,ALE.Id as DasLegalEntityId
	        ,ALE.Created as LegalEntityCreatedDate
	        ,Acct.Name as DasAccountName
	        ,Ale.Name as LegalEntityName
        FROM Acct.Ext_Tbl_Account Acct
        JOIN Acct.Ext_Tbl_AccountLegalEntity ALE
          ON Acct.Id=ale.AccountId) Account
  ON Account.EmployerAccountId=Reservation.AccountId
 AND Account.DasLegalEntityId=Reservation.AccountLegalEntityId
LEFT 
JOIN Resv.Ext_Tbl_Course Course 
  ON Course.CourseId = Reservation.CourseId 
LEFT 
JOIN Comt.Ext_Tbl_Apprenticeship Apprenticeship
  ON Apprenticeship.ReservationId = Reservation.Id
LEFT 
JOIN Fin.Ext_Tbl_Payment Payment
  ON Payment.ApprenticeshipId = Apprenticeship.Id 
LEFT 
JOIN Comt.Ext_Tbl_Commitment Commitment
  ON Commitment.Id = Apprenticeship.CommitmentId
LEFT 
JOIN dbo.ReferenceData RDFS
  ON RDFS.Category=''Payments''
 AND RDFS.FieldName=''FundingSource''
 AND RDFS.FieldValue=Payment.FundingSource
LEFT 
JOIN dbo.ReferenceData RDTT
  ON RDTT.Category=''Payments''
 AND RDTT.FieldName=''TransactionType''
 AND RDTT.FieldValue=Payment.TransactionType
LEFT 
JOIN dbo.ReferenceData RD
  ON RD.Category=''Commitments''
 AND RD.FieldName=''Approvals''
 AND RD.FieldValue=Commitment.Approvals
 
 LEFT
   JOIN [comt].[ext_tbl_providers] TP
 ON  Commitment.ProviderId = TP.UKPRN



'

EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateSpendControlNonLevyView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSpendControlNonLevyView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateSpendControlNonLevyView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="8627" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateSpendControlNonLevyView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateSpendControlView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 05/04/2020
-- Description: Spend Control for Levy and Non-Levy Created after 2019
-- =========================================================================

/*
Change Control
     
     Date				Author        Jira             Description

  	 01/05/2020			R.Rai        ADM-1471          Remove fields from Commitments

*/


BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateSpendControlView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateSpendControlView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_SpendControl'')
Drop View ASData_PL.DAS_SpendControl
'
SET @VSQL2='
CREATE VIEW [ASData_PL].[DAS_SpendControl]
	AS
SELECT 
 COALESCE(Account.EmployerAccountId, -1)                                     AS EmployerAccountId
,COALESCE(Account.DasAccountId, ''XXXXXX'')                                  AS DasAccountId
,COALESCE(Account.DasAccountName, ''NA'')                                    AS DasAccountName
,COALESCE(Account.AccountCreatedDate,''999-12-31'')                          AS AccountCreatedDate
,COALESCE(Account.AccountModifiedDate,''9999-12-31'')                        AS AccountModifiedDate
,COALESCE(Account.ApprenticeshipEmployerType,-1)                             AS AccountApprenticeshipEmployerType
,COALESCE(Account.DasLegalEntityId,''-1'')                                   AS DasLegalEntityId
,COALESCE(Account.LegalEntityName,''NA'')                                    AS LegalEntityName
,COALESCE(Account.LegalEntityCreatedDate, ''9999-12-31'')                    AS AccountLegalEntityCreatedDate   
,COALESCE(Account.AccountSignedAgreementVersion,-1)                          AS AccountSignedAgreementVersion
,CASE WHEN Account.AccountLegalEntityDeleted IS NULL
      THEN ''No''
	  ELSE ''Yes''
  END                                                                        AS AccountLegalEntityIsDeleted
,COALESCE(Account.AccountLegalEntityDeleted,''9999-12-31'')                  AS AccountLegalEntityDeletedDate
,COALESCE(Account.EmployerSignedAgreementId,-1)                              AS EmployerSignedAgreementId
,COALESCE(Account.AgreementSignedDate,''9999-12-31'')                        AS AgreementSignedDate
,COALESCE(Account.AgreementSignedByUserId,-1)                                AS AgreementSignedByUserId
,COALESCE(CONVERT(VARCHAR(255), Reservation.Id), ''NA'')                     AS ReservationId                              
,CASE 
WHEN Reservation.IslevyAccount = ''1'' THEN ''Yes'' 
WHEN Reservation.IslevyAccount = ''0'' THEN ''No''
ELSE ''NA''
END                                                                          AS ReservationIsLevyAccount 
,COALESCE(Reservation.CreatedDate, ''9999-12-31'')                           AS ReservationCreatedDate 
,COALESCE(Reservation.StartDate, ''9999-12-31'')                             AS ReservationStartDate 
,COALESCE(Reservation.ExpiryDate, ''9999-12-31'')                            AS ReservationExpiryDate 
,CASE 
WHEN Reservation.Status = ''0'' THEN ''Pending''
WHEN Reservation.Status = ''1'' THEN ''Confirmed''
WHEN Reservation.Status = ''2'' THEN ''Completed''
WHEN Reservation.Status = ''3'' THEN ''Deleted''
WHEN Reservation.Status = ''4'' THEN ''Unrestricted''
ELSE ''NA''
END                                                                          AS ReservationStatus 
,COALESCE(Reservation.Courseid, ''NA'')                                      AS ReservationCourseId 
,COALESCE(Course.Title, ''NA'')                                              AS CourseTitle 
,COALESCE(Course.Level, -1)                                                  AS CourseLevel 
,COALESCE(Apprenticeship.Commitmentid, -1)                                   AS ApprenticeshipCommitmentId
,COALESCE(Apprenticeship.Id, -1)                                             AS ApprenticeshipId 
,COALESCE(Apprenticeship.CreatedOn, ''9999-12-31'')                          AS ApprenticeshipCreatedOn 
,COALESCE(Apprenticeship.StartDate, ''9999-12-31'')                          AS ApprenticeshipStartDate 
,COALESCE(Apprenticeship.TrainingType, -1)                                   AS ApprenticeshipTrainingType 
,COALESCE(Apprenticeship.TrainingName, ''NA'')                               AS ApprenticeshipTrainingName 
,COALESCE(Apprenticeship.TrainingCode, ''NA'')                               AS ApprenticeshipTrainingCode 
,COALESCE(Apprenticeship.IsApproved, -1)                                     AS ApprenticeshipIsApproved 
,COALESCE(Apprenticeship.AgreedOn, ''9999-12-31'')                           AS ApprenticeshipAgreedOn 
,Apprenticeship.Cost                                                         AS ApprenticeshipAgreedCost
,COALESCE(Reservation.ProviderId, -1)                                        AS ReservationByEmployerOrProvider
,COALESCE(Commitment.ProviderId, -1)                                         AS CommitmentProviderId

-- ,COALESCE(Commitment.ProviderName, ''NA'')                                AS CommitmentProviderName
 ,COALESCE(TP.Name, ''NA'')                                                  AS CommitmentProviderName


,CASE WHEN [Apprenticeship].[DateOfBirth] IS NULL	THEN - 1
		      WHEN DATEPART([M], [Apprenticeship].[DateOfBirth]) > DATEPART([M], [Apprenticeship].[StartDate])
			    OR DATEPART([M], [Apprenticeship].[DateOfBirth]) = DATEPART([M], [Apprenticeship].[StartDate])
			   AND DATEPART([DD], [Apprenticeship].[DateOfBirth]) > DATEPART([DD], [Apprenticeship].[StartDate])
			  THEN DATEDIFF(YEAR, [Apprenticeship].[DateOfBirth], [Apprenticeship].[StartDate]) - 1
		      ELSE DATEDIFF(YEAR, [Apprenticeship].[DateOfBirth], [Apprenticeship].[StartDate])
		END                                                            AS [CommitmentAgeAtStart]
, ISNULL(CAST((CASE 
		              WHEN [Apprenticeship].[DateOfBirth] IS NULL THEN ''NA''
					  WHEN CASE 
				           WHEN DATEPART([M], [Apprenticeship].[DateOfBirth]) > DATEPART([M], [Apprenticeship].[StartDate])
					         OR (DATEPART([M], [Apprenticeship].[DateOfBirth]) = DATEPART([M], [Apprenticeship].[StartDate])
					        AND DATEPART([DD], [Apprenticeship].[DateOfBirth]) > DATEPART([DD], [Apprenticeship].[StartDate]))
					       THEN DATEDIFF(YEAR, [Apprenticeship].[DateOfBirth], [Apprenticeship].[StartDate]) - 1
				           ELSE DATEDIFF(YEAR, [Apprenticeship].[DateOfBirth], [Apprenticeship].[StartDate])
				            END BETWEEN 0  AND 18 
					  THEN ''16-18''
		              ELSE ''19+''
		              END) as Varchar(5)),''NA'')                      AS [CommitmentAgeAtStartBand]
                           
,COALESCE(RD.FieldDesc,''NA'')                                               AS ApprenticeshipAgreementStatus
,CAST(CASE WHEN Apprenticeship.PaymentStatus=''0'' THEN ''PendingApproval''
	               WHEN Apprenticeship.PaymentStatus=''1'' THEN ''Active''
			       WHEN Apprenticeship.PaymentStatus=''2'' THEN ''Paused''
			       WHEN Apprenticeship.PaymentStatus=''3'' THEN ''Withdrawn''
			       WHEN Apprenticeship.PaymentStatus=''4'' THEN ''Completed''
			       WHEN Apprenticeship.PaymentStatus=''5'' THEN ''Deleted''
			       ELSE ''Unknown''
		       END AS Varchar(50))                                           AS ApprenticeshipPaymentStatus
,COALESCE(Commitment.ApprenticeshipEmployerTypeOnApproval,-1)                AS ApprenticeshipEmployerTypeOnApproval
,COALESCE(Commitment.TransferSenderId,-1)                                    AS CommitmentTransferSenderId
,COALESCE(CONVERT(VARCHAR(255), Payment.PaymentId), ''NA'')                  AS PaymentId
,COALESCE(Payment.PeriodEnd, ''NA'')                                         AS PaymentPeriodEnd
,COALESCE(RDFS.FieldDesc, ''NA'')                                            AS PaymentFundingSource
,COALESCE(RDTT.FieldDesc, ''NA'')                                            AS PaymentTransactionType
,COALESCE(Payment.ApprenticeshipId, -1)                                      AS PaymentApprenticeshipId
,Payment.Amount                                                              AS PaymentAmount

FROM (SELECT *
        FROM Resv.Ext_Tbl_Reservation
	   WHERE YEAR(CreatedDate) > = 2020
       --AND IsLevyAccount = 0
		 ) Reservation
LEFT 
JOIN (select Acct.Id as EmployerAccountId
            ,Acct.HashedId as DasAccountId
	        ,ALE.Id as DasLegalEntityId
	        ,ALE.Created as LegalEntityCreatedDate
	        ,Acct.Name as DasAccountName
	        ,Ale.Name as LegalEntityName
			,Acct.CreatedDate as AccountCreatedDate
			,Acct.ModifiedDate as AccountModifiedDate
			,Acct.ApprenticeshipEmployerType as ApprenticeshipEmployerType
			,ALE.SignedAgreementVersion as AccountSignedAgreementVersion
			,ALE.Deleted as AccountLegalEntityDeleted
			,EA.SignedById as AgreementSignedByUserId
			,EA.Id as EmployerSignedAgreementId
			,EA.SignedDate as AgreementSignedDate
        FROM Acct.Ext_Tbl_Account Acct
        JOIN Acct.Ext_Tbl_AccountLegalEntity ALE
          ON Acct.Id=ale.AccountId
		LEFT
		JOIN Acct.Ext_Tbl_EmployerAgreement EA
		  ON EA.Id=ALE.SignedAgreementId) Account
  ON Account.EmployerAccountId=Reservation.AccountId
 AND Account.DasLegalEntityId=Reservation.AccountLegalEntityId
LEFT 
JOIN Resv.Ext_Tbl_Course Course 
  ON Course.CourseId = Reservation.CourseId 
LEFT 
JOIN Comt.Ext_Tbl_Apprenticeship Apprenticeship
  ON Apprenticeship.ReservationId = Reservation.Id
LEFT 
JOIN Fin.Ext_Tbl_Payment Payment
  ON Payment.ApprenticeshipId = Apprenticeship.Id 
LEFT 
JOIN Comt.Ext_Tbl_Commitment Commitment
  ON Commitment.Id = Apprenticeship.CommitmentId
LEFT 
JOIN dbo.ReferenceData RDFS
  ON RDFS.Category=''Payments''
 AND RDFS.FieldName=''FundingSource''
 AND RDFS.FieldValue=Payment.FundingSource
LEFT 
JOIN dbo.ReferenceData RDTT
  ON RDTT.Category=''Payments''
 AND RDTT.FieldName=''TransactionType''
 AND RDTT.FieldValue=Payment.TransactionType
 LEFT 
 JOIN dbo.ReferenceData RD
   ON RD.Category=''Commitments''
  AND RD.FieldName=''Approvals''
  AND RD.FieldValue=Commitment.Approvals

  LEFT
   JOIN [comt].[ext_tbl_providers] TP
 ON  Commitment.ProviderId = TP.UKPRN


'

EXEC SP_EXECUTESQL @VSQL1
EXEC (@VSQL2)

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateSpendControlView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSpendControlView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateSpendControlView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="11917" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateSpendControlView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateStdsAndFrameworksView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma EVani
-- Create Date: 27/07/2020
-- Description: Standards and Frameworks data view
-- ===========================================================================

BEGIN TRY
	DECLARE @LogID int

		/* Start Logging Execution */

	  INSERT INTO Mgmt.Log_Execution_Results
		  (
			RunId
		   ,StepNo
		   ,StoredProcedureName
		   ,StartDateTime
		   ,Execution_Status
		  )
	  SELECT 
			@RunId
		   ,'Step-4'
		   ,'CreateStdsAndFrameworksView'
		   ,getdate()
		   ,0

	  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
	   WHERE StoredProcedureName='CreateStdsAndFrameworksView'
		 AND RunId=@RunID


		DECLARE @VSQL1 NVARCHAR(MAX)
		DECLARE @VSQL2 VARCHAR(MAX)
		DECLARE @VSQL3 VARCHAR(MAX)
		DECLARE @VSQL4 VARCHAR(MAX)

		SET @VSQL1='
		if exists(select 1  from INFORMATION_SCHEMA.VIEWS    Where TABLE_NAME =''DAS_Dashboard_StdsAndFrameworks'' And Table_Schema =''AsData_PL'')
			Drop View AsData_PL.DAS_Dashboard_StdsAndFrameworks'
		SET @VSQL2='
		Create View AsData_PL.DAS_Dashboard_StdsAndFrameworks
		As 	
			select cast(AppStd.[LarsCode] As varchar(100)) as Code,[StandardFullName] Name,AppStdRoute.Route,Avms_Standard.EducationLevelNumber   As Level,''Standard'' As lookupDataType
			from ASData_PL.Va_ApprenticeshipStandard AppStd JOIN [Stg].[Avms_Standard] Avms_Standard  
			on AppStd.LarsCode = Avms_Standard.LarsCode JOIN AsData_PL.ApprenticeshipStdRoute AppStdRoute 
			on AppStd.LarsCode = AppStdRoute.LarsCode 
			where AppStdRoute.LarsCode != ''TBC'' 
			UNION 	
			Select ProgrammeId_v2 As Code,FrameworkTitle_v2 As Name,ApprenticehipOccupationFullName As Route,EducationLevelNumber As Level,''Framework'' As lookupDataType
			from [ASData_PL].[Va_ApprenticeshipFrameWorkAndOccupation] FrameworkData JOIN stg.RAA_ReferenceDataApprenticeshipProgrammes RefData 
			on FrameworkData.ProgrammeId_v2 =  RefData.ProgrammeId
			where [ProgrammeId_v2]  != ''N/A'''
			
		EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
		EXEC (@VSQL2) -- run sql to create view. 

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=1
			  ,EndDateTime=getdate()
			  ,FullJobStatus='Pending'
		 WHERE LogId=@LogID
		   AND RunId=@RunId

 
END TRY
BEGIN CATCH
		DECLARE @ErrorId int

		INSERT INTO Mgmt.Log_Error_Details
			(UserName
			,ErrorNumber
			,ErrorState
			,ErrorSeverity
			,ErrorLine
			,ErrorProcedure
			,ErrorMessage
			,ErrorDateTime
			,RunId
			)
		SELECT 
			SUSER_SNAME(),
			ERROR_NUMBER(),
			ERROR_STATE(),
			ERROR_SEVERITY(),
			ERROR_LINE(),
			'CreateStdsAndFrameworksView',
			ERROR_MESSAGE(),
			GETDATE(),
			@RunId as RunId; 

		SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

		/* Update Log Execution Results as Fail if there is an Error*/

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=0
			  ,EndDateTime=getdate()
			  ,ErrorId=@ErrorId
		 WHERE LogId=@LogID
		   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateStdsAndFrameworksView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateStdsAndFrameworksView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3172" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateStdsAndFrameworksView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateSystemExternalTables]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ============================================================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Dynamically Creates System External Tables which will then be used for Dynamically Creating
--              Actual External Tables.
-- ============================================================================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

 SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results

 /* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-1'
	   ,'CreateSystemExternalTables'+'-'+@DatabaseName
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateSystemExternalTables'+'-'+@DatabaseName
     AND RunId=@RunID

 DECLARE @ExecuteSQL nvarchar(max)
 SET @EXECUTESQL=''

 SET @ExecuteSQL ='
 IF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('''+@SchemaName+'.Ext_Tbl_InfSch_'+@DatabaseName+''') )
DROP EXTERNAL TABLE '+@SchemaName+'.Ext_Tbl_InfSch_'+@DatabaseName+'

CREATE EXTERNAL TABLE '+@SchemaName+'.Ext_Tbl_InfSch_'+@DatabaseName+' (  
   Table_Catalog nvarchar(128),
   Table_Schema nvarchar(128),
   Table_Name nvarchar(128) not null,
   Column_Name nvarchar(128) null,
   Ordinal_Position int null,
   Column_Default nvarchar(4000) null,
   Is_Nullable varchar(3) NULL,
   Data_Type nvarchar(128) NULL,
   Character_Maximum_Length int null,
   Character_Octet_Length int null,
   Numeric_Precision tinyint null,
   Numeric_Precision_Radix smallint null,
   Numeric_Scale int null,
   Datetime_Precision smallint null,
   Character_Set_Catalog nvarchar(128) null,
   Character_Set_Schema nvarchar(128) null,
   Character_Set_Name nvarchar(128) null,
   Collation_Catalog nvarchar(128) null,
   Collation_Schema nvarchar(128) null,
   Collation_Name nvarchar(128) null,
   Domain_Catalog nvarchar(128) null,
   Domain_Schema nvarchar(128) null,
   Domain_Name nvarchar(128) null
)  
WITH (Data_Source=['+@ExternalDataSource+'],Schema_Name=''Information_Schema'',Object_Name=''Columns'')
  '
 
 EXEC SP_EXECUTESQL @ExecuteSQL
 --PRINT @PrepareSQL

 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateSystemExternalTables'+'-'+@DatabaseName AS ErrorProcedure,
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSystemExternalTables].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSystemExternalTables].[@DatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSystemExternalTables].[@SchemaName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateSystemExternalTables].[@ExternalDataSource]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateSystemExternalTables].[@ExternalDataSource]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateSystemExternalTables].[@DatabaseName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateSystemExternalTables].[@SchemaName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateSystemExternalTables].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3648" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE CreateSystemExternalTables&#xD;&#xA;(&#xD;&#xA;   @ExternalDataSource Varchar(255),&#xD;&#xA;   @DatabaseName varchar(255),&#xD;&#xA;   @SchemaName varchar(255),&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[CreateTransactionLineView]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Robin Rai
-- Create Date: 09/10/2019
-- Description: Create View for TransactionLine
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-4'
	   ,'CreateTransactionLineView'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='CreateTransactionLineView'
     AND RunId=@RunID


DECLARE @VSQL1 NVARCHAR(MAX)
DECLARE @VSQL2 VARCHAR(MAX)
DECLARE @VSQL3 VARCHAR(MAX)
DECLARE @VSQL4 VARCHAR(MAX)

SET @VSQL1='
if exists(SELECT 1 from INFORMATION_SCHEMA.VIEWS where TABLE_NAME=''DAS_TransactionLine'')
Drop View ASData_PL.DAS_TransactionLine
'
SET @VSQL2='
 CREATE VIEW [ASData_PL].[DAS_TransactionLine]  AS 
 SELECT [Id], 
 [AccountId],  
 [DateCreated],  
 [SubmissionId],  
 [TransactionDate],  
 [TransactionType],  
 [LevyDeclared],  
 [Amount], 
 HASHBYTES(''SHA2_512'',RTRIM(LTRIM(CAST([EmpRef] AS VARCHAR(20))))) AS [EmpRef],  
 [PeriodEnd],  
 [Ukprn],  
 [SfaCoInvestmentAmount],  
 [EmployerCoInvestmentAmount],  
 [EnglishFraction],  
 [TransferSenderAccountId],  
 [TransferSenderAccountName],  
 [TransferReceiverAccountId],  
 [TransferReceiverAccountName]  
 FROM [Fin].[Ext_Tbl_TransactionLine] 
'
-- SET @VSQL3=' ' 
-- SET @VSQL4=' ' 

EXEC SP_EXECUTESQL @VSQL1 -- run check to drop view if it exists. 
EXEC (@VSQL2) -- run sql to create view. 
-- +@VSQL3+@VSQL4) -- no 3 or 4 

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'CreateTransactionLineView',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CreateTransactionLineView].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[CreateTransactionLineView].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2875" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[CreateTransactionLineView]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[DASCalendarMonth]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarMonthID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="80" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarMonthNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarMonthName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarMonthShortName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarMonthNameYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarMonthShortNameYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[TaxMonthNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[TaxYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[AcademicMonthNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DASCalendarMonth].[CalendarYearMonth_SortOrder]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="36" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[DataLockStatus]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[TrainingCourseId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[DataLockEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[DataLockEventDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[PriceEpisodeIdentifier]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="25" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IlrTrainingCourseCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IlrTrainingType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IlrActualStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IlrEffectiveFromDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IlrPriceEffectiveToDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IlrTotalCost]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[ErrorCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[DataLockStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[DataLockStatus].[DataLockStatusDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(CASE WHEN DataLockStatus=0 THEN 'Unknown' WHEN DataLockStatus=1 THEN 'Pass' WHEN DataLockStatus=2 THEN 'Fail' ELSE 'Unknown' END)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DataLockStatus].[DataLockStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[TriageStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[DataLockStatus].[TriageStatusDesc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(CASE WHEN TriageStatus=0 THEN 'Unknown' WHEN TriageStatus=1 THEN 'Change Requested' WHEN TriageStatus=2 THEN 'Stop/Restart Requested' WHEN TriageStatus=3 THEN 'FixIlr' ELSE 'Unknown' END)]]></Value>
						</Property>
						<Property Name="IsPersisted" Value="True" />
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[DataLockStatus].[TriageStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IsResolved]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[EventStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[IsExpired]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[Expireddatetime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[Source_DataLockStatusId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="27" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="28" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[DataLockStatus].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="29" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="112" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="113" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[DetectAndLogSourceDbChanges]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/06/2020
-- Description: Detect And Log Source Db Changes
-- ==================================================

BEGIN 

    SET NOCOUNT ON



/* Check and Log if there are Any new Columns that don't exist in DataMart and are not part of Include
or Exclude List Config*/

INSERT INTO dbo.SourceDbChanges
 (SourceDatabaseName,SouceTableName,SourceSchemaName,ChangesDetected)
SELECT  
 ''+@SourceDatabaseName+''
 ,''+@SourceTableName+''
 ,''+@SourceSchemaName+''
 ,'Field '+LTRIM(RTRIM(ConfigList))+' Removed'
FROM
(SELECT VALUE as ConfigList
   FROM Mtd.SourceConfigForImport SCFI
  CROSS APPLY string_split(ColumnNamesToInclude,',')
  WHERE SourceDatabaseName=''+@SourceDatabaseName+''
    AND SourceTableName=''+@SourceTableName+''
	AND SourceSchemaName=''+@SourceSchemaName+''
	) AS SourceConfigInDM
  WHERE not exists (select LTRIM(RTRIM(value)) as ExistingList
                      from STRING_SPLIT(@cols, ',') Cols 
				     where LTRIM(RTRIM(SourceConfigInDM.ConfigList))=LTRIM(RTRIM(Cols.value)))

					 
/* Check and Log if there are Deleted Columns that exist in DataMart as part of Include List Config*/


 INSERT INTO dbo.SourceDbChanges
 (SourceDatabaseName,SouceTableName,SourceSchemaName,ChangesDetected)
 SELECT  ''+@SourceDatabaseName+''
        ,''+@SourceTableName+''
		,''+@SourceSchemaName+''
        ,'Field '+LTRIM(RTRIM(value))+' Added' as ExistingList
   FROM STRING_SPLIT(@cols, ',') Cols 
  WHERE NOT EXISTS
        (SELECT 1
		   FROM 
		     (SELECT VALUE as ConfigList
                FROM Mtd.SourceConfigForImport SCFI
               CROSS APPLY string_split(ColumnNamesToInclude,',')
			   WHERE SourceDatabaseName=''+@SourceDatabaseName+''
                 AND SourceTableName=''+@SourceTableName+''
	             AND SourceSchemaName=''+@SourceSchemaName+''
               UNION
              SELECT VALUE 
                FROM Mtd.SourceConfigForImport SCFI
               CROSS APPLY string_split(ColumnNamesToExclude,',')
			   WHERE SourceDatabaseName=''+@SourceDatabaseName+''
                 AND SourceTableName=''+@SourceTableName+''
	             AND SourceSchemaName=''+@SourceSchemaName+'') AS SourceConfigInDM
               WHERE LTRIM(RTRIM(SourceConfigInDM.ConfigList))=LTRIM(RTRIM(Value))
			)
 

 
     
 




 END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[dbo].[SourceDbChanges]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[SourceDbChanges].[SourceDatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[SourceDbChanges].[SouceTableName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[SourceDbChanges].[SourceSchemaName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[SourceDbChanges].[ChangesDetected]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[ColumnNamesToInclude]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceDatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DetectAndLogSourceDbChanges].[@SourceDatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceTableName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DetectAndLogSourceDbChanges].[@SourceTableName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceSchemaName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DetectAndLogSourceDbChanges].[@SourceSchemaName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[DetectAndLogSourceDbChanges].[@Cols]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[ColumnNamesToInclude]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceDatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceTableName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceSchemaName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[ColumnNamesToExclude]" />
				</Entry>
				<Entry />
				<Entry />
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[DetectAndLogSourceDbChanges].[@SourceDatabaseName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[DetectAndLogSourceDbChanges].[@SourceTableName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[DetectAndLogSourceDbChanges].[@SourceSchemaName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[DetectAndLogSourceDbChanges].[@Cols]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2622" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[DetectAndLogSourceDbChanges]&#xD;&#xA;(@SourceDatabaseName varchar(256),@SourceTableName varchar(256),@SourceSchemaName varchar(256),@Cols varchar(max))&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[EmployerAccount]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[EmpHashedId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[EmpPublicHashedId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[EmpName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[AccountCreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[AccountUpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[Source_AccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="18" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="19" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccount].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="20" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="114" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[EmployerAccountLegalEntity]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[EmployerAccountId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityPublicHashedId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[OrganisationType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[OrganisationTypeDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityAddress]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityCreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityUpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityDeletedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[Source_AccountLegalEntityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[Source_AccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="9" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="10" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[EmployerAccountLegalEntity].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="11" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="115" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="116" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Apprenticeship_ApprenticeId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ApprenticeId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[Apprentice].[ID]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="104" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Apprenticeship_AssessmentOrgId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[AssessmentOrgId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[Id]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="106" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Apprenticeship_CommitmentId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[CommitmentId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[Commitment].[Id]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="103" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Apprenticeship_TrainingCourseId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[TrainingCourseId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[TrainingCourse].[ID]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="105" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Commitment_EmpAccId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Commitment].[EmployerAccountId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Id]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="109" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Commitment_EmpAccLEId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Commitment].[EmployerAccountLegalEntityId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[Id]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="110" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Commitment_ProviderId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[Commitment].[ProviderId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[Provider].[Id]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="111" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_DataLockStatus_ApprenticeshipId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[DataLockStatus].[ApprenticeshipId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ID]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="113" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_EmployerAccLE_EAID]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[EmployerAccountId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Id]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="116" />
		</Element>
		<Element Type="SqlScalarFunction" Name="[dbo].[Fn_ConvertTimeStampToDateTime]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime2]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime].[@UnixTimeStamp]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime2]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[smallint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
BEGIN
DECLARE @DateTime DateTime2
     IF (TRY_CONVERT(BIGINT,@UnixTimeStamp) IS NULL)
	 SET @DateTime= NULL
	 ELSE 
	 IF (LEN(@UnixTimeStamp)>13)
	 SET @DateTime=NULL
	 ELSE
	 SET @DateTime= CAST(DATEADD(ms, CAST(TRY_CONVERT(smallint,RIGHT(@UnixTimeStamp,3)) AS smallint), DATEADD(s, TRY_CONVERT(INT,(CAST(@UnixTimeStamp as bigint) / 1000)), '1970-01-01')) AS datetime2(3))
	 RETURN @DateTime
END;]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="516" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [dbo].[Fn_ConvertTimeStampToDateTime] (@UnixTimeStamp varchar(256))&#xD;&#xA;RETURNS DATETIME2&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[Fn_ConvertTimeStampToDateTime].[@UnixTimeStamp]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Scale" Value="7" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[datetime2]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GenerateConfig]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- =======================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 27/07/2020
-- Description: Generate Candidate Config for Import
-- =======================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-3'
	   ,'GenerateConfig'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='GenerateConfig'
     AND RunId=@RunID


IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

SELECT *
  INTO #tConfig
  FROM Stg.CandidateConfig 
 WHERE SourceDb=@SourceDb
   AND Category=@Category

DELETE FROM Stg.CandidateConfig
 WHERE SourceDb=@SourceDb
   AND Category=@Category

INSERT INTO Stg.CandidateConfig
(SourceDb,Category,ShortCode,RunId)
select SourceDb,Category,ShortCode,@RunId
from #tConfig
ORDER BY NEWID()





COMMIT TRANSACTION
END

/* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'GenerateConfig',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[@SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[Category]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[@Category]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[#tConfig]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[#tConfig].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[#tConfig].[Category]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateConfig].[#tConfig].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[GenerateConfig].[#tConfig]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GenerateConfig].[#tConfig].[CCId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[CCId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GenerateConfig].[#tConfig].[SourceDb]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[SourceDb]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GenerateConfig].[#tConfig].[Category]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[Category]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GenerateConfig].[#tConfig].[ShortCode]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[ShortCode]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GenerateConfig].[#tConfig].[RunId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[RunId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GenerateConfig].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GenerateConfig].[@SourceDb]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GenerateConfig].[@Category]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2292" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[GenerateConfig]&#xD;&#xA;(&#xD;&#xA;   @RunId int,@SourceDb Varchar(255),@Category Varchar(255)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GenerateCopyActivityId]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 27/07/2020
-- Description: Generates CopyActivity Id 
-- =========================================================================
BEGIN TRY


DECLARE @LogID BIGINT
DECLARE @CAID BIGINT

INSERT INTO Stg.CopyActivity
(RunId,SourceDb,Category)
Values(@RunId,@SourceDb,@Category)

SELECT @CAID=NID FROM Stg.CopyActivity Where CAId = (SELECT MAX(CAId) FROM Stg.CopyActivity)

/* Commenting out to avoid logging several times */
/* Start Logging Execution */

  --INSERT INTO Mgmt.Log_Execution_Results
	 -- (
	 --   RunId
	 --  ,StepNo
	 --  ,StoredProcedureName
	 --  ,StartDateTime
	 --  ,EndDateTime
	 --  ,Execution_Status
	 --  ,FullJobStatus
	 -- )
  --SELECT 
  --      @RunId
	 --  ,'Step-3'
	 --  ,'GenerateCopyActivityId'
	 --  ,getdate()
	 --  ,getdate()
	 --  ,1
	 --  ,'Pending'


RETURN (@CAID)

END TRY

BEGIN CATCH

  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'GenerateCopyActivityId' AS ErrorProcedure,
	    ERROR_MESSAGE(),
	    GETDATE()
		;


/* Update Log Execution Results as Fail if there is an Error*/

END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[Category]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateCopyActivityId].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateCopyActivityId].[@SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GenerateCopyActivityId].[@Category]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[NID]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[CAId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[CAId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GenerateCopyActivityId].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GenerateCopyActivityId].[@SourceDb]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GenerateCopyActivityId].[@Category]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1414" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[GenerateCopyActivityId] &#xD;&#xA;(@RunId bigint,@SourceDb Varchar(255),@Category varchar(256))&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GenerateRunId]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Generates RunId which will be used for logging Execution
-- =========================================================================
BEGIN TRY

/* Generate Run Id by inserting startdatetime into Log_RunId */

DECLARE @RunId bigint
DECLARE @DateStamp VARCHAR(10)
DECLARE @LogID int

INSERT INTO [Mgmt].[Log_RunId]
(StartDateTime)
Values(GETDATE())

SELECT @RunId=MAX(RunId) FROM [Mgmt].[Log_RunId]

select @DateStamp =  CAST(CAST(YEAR(GETDATE()) AS VARCHAR)+RIGHT('0' + RTRIM(cast(MONTH(getdate()) as varchar)), 2) +RIGHT('0' +RTRIM(CAST(DAY(GETDATE()) AS VARCHAR)),2) as int)

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,EndDateTime
	   ,Execution_Status
	   ,FullJobStatus
	  )
  SELECT 
        @RunId
	   ,'Step-1'
	   ,'GenerateRunId'
	   ,getdate()
	   ,getdate()
	   ,1
	   ,'Pending'


RETURN (@RunId)

END TRY

BEGIN CATCH

  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'GenerateRunId' AS ErrorProcedure,
	    ERROR_MESSAGE(),
	    GETDATE()
		;


/* Update Log Execution Results as Fail if there is an Error*/

END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[RunId]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1472" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[GenerateRunId]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportApprentice]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Apprentice Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportApprentice'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportApprentice'
     AND RunId=@RunID

  /* Get AssessmentOrganisation Data into Temp Table */

IF OBJECT_ID ('tempdb..#tApprentice') IS NOT NULL
DROP TABLE #tApprentice

  SELECT DISTINCT 
         FirstName
		,LastName
		,ULN
		,DateOfBirth
		,NINumber
  INTO #tApprentice
  FROM Comt.Ext_Tbl_Apprenticeship

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.Apprentice(FirstName,LastName,DateOfBirth,NINumber,ULN,Data_Source,RunId) 
SELECT Source.FirstName,Source.LastName,Source.DateOfBirth,Source.NINumber,ULN,'Commitments-Apprenticeship',@RunId
  FROM #tApprentice Source

COMMIT TRANSACTION
END






  /* Delta Code */
  /*
 MERGE dbo.Apprentice as Target
 USING #tApprentice as Source
    ON Target.ULN=Source.ULN
  WHEN MATCHED AND ( Target.FirstName<>Source.FirstName
                  OR Target.LastName<>Source.LastName
				  OR Target.DateOfBirth<>Source.DateOfBirth
				  OR Target.NINumber<>Source.NINumber
				  )
  THEN UPDATE SET Target.FirstName=Source.FirstName
                 ,Target.LastName=Source.LastName
				 ,Target.DateOfBirth=Source.DateOfBirth
				 ,Target.NINumber=Source.NINumber
                 ,Target.AsDm_UpdatedDate=getdate()
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (FirstName,LastName,DateOfBirth,NINumber,ULN,Data_Source) 
       VALUES (Source.FirstName,Source.LastName,Source.DateOfBirth,Source.NINumber,ULN,'Commitments-Apprenticeship');
 */
 


 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportApprentice',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[#tApprentice]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[DateOfBirth]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[NINumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[ULN]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[#tApprentice].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[#tApprentice].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[#tApprentice].[DateOfBirth]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[#tApprentice].[NINumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice].[#tApprentice].[ULN]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportApprentice].[#tApprentice]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprentice].[#tApprentice].[FirstName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprentice].[#tApprentice].[LastName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprentice].[#tApprentice].[ULN]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprentice].[#tApprentice].[DateOfBirth]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprentice].[#tApprentice].[NINumber]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportApprentice].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3252" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportApprentice]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportApprenticeship]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Apprenticeship Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportApprenticeship'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportApprenticeship'
     AND RunId=@RunID

  /* Get Commitment Data into Temp Table */
  
IF OBJECT_ID ('tempdb..#tApprenticeship') IS NOT NULL
DROP TABLE #tApprenticeship

SELECT *
INTO #tApprenticeship
from Comt.Ext_Tbl_Apprenticeship

IF OBJECT_ID ('tempdb..#tSourceApprenticeship') IS NOT NULL
DROP TABLE #tSourceApprenticeship

select ta.id as Source_ApprenticeshipId
      ,c.id as CommitmentId
	  ,ao.id as AssessmentOrgId
	  ,tc.id as TrainingCourseId
	  ,a.id as ApprenticeId
      ,ta.Cost
	  ,ta.StartDate
	  ,ta.EndDate
	  ,ta.AgreementStatus
	  ,ta.PaymentStatus as ApprenticeshipStatus
	  ,ta.EmployerRef
	  ,ta.ProviderRef
	  ,ta.CreatedOn as CommitmentCreatedOn
	  ,ta.AgreedOn as CommitmentAgreedOn
	  ,ta.PaymentOrder 
	  ,ta.StopDate
	  ,ta.PauseDate
	  ,ta.HasHadDataLockSuccess
	  ,ta.PendingUpdateOriginator
	  ,ta.CloneOf
	  ,ta.ReservationId
	  ,ta.IsApproved    
into #tSourceApprenticeship
from #tApprenticeship ta
left
join dbo.Commitment c
  on c.Commitments_SourceId=ta.CommitmentId
left
join dbo.AssessmentOrganisation ao
  on ao.EPAOId=ta.EPAOrgId
left
join dbo.TrainingCourse tc
  on tc.TrainingType=ta.TrainingType
 and tc.TrainingCode=ta.TrainingCode
 and tc.TrainingName=ta.TrainingName
left
join dbo.Apprentice a
  on a.uln=ta.ULN
 and a.firstname=ta.FirstName
 and a.lastname=ta.LastName
 and a.dateofbirth=ta.DateOfBirth

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.Apprenticeship(CommitmentId 
              ,ApprenticeId
              ,TrainingCourseId
              ,AssessmentOrgId
              ,Cost
              ,StartDate 
              ,EndDate 
              ,AgreementStatus
              ,ApprenticeshipStatus 
              ,EmployerRef
              ,ProviderRef
              ,CommitmentCreatedOn
              ,CommitmentAgreedOn
              ,PaymentOrder
              ,StopDate
              ,PauseDate
              ,HasHadDataLockSuccess
              ,PendingUpdateOriginator
              ,CloneOf
              ,ReservationId
              ,Data_Source
              ,Source_ApprenticeshipId
			  ,RunId
			  )
 SELECT Source.CommitmentId 
              ,Source.ApprenticeId
              ,Source.TrainingCourseId
              ,Source.AssessmentOrgId
              ,Source.Cost
              ,Source.StartDate 
              ,Source.EndDate 
              ,Source.AgreementStatus
              ,Source.ApprenticeshipStatus 
              ,Source.EmployerRef
              ,Source.ProviderRef
              ,Source.CommitmentCreatedOn
              ,Source.CommitmentAgreedOn
              ,Source.PaymentOrder
              ,Source.StopDate
              ,Source.PauseDate
              ,Source.HasHadDataLockSuccess
              ,Source.PendingUpdateOriginator
              ,Source.CloneOf
              ,Source.ReservationId
              ,'Commitments-Apprenticeship'
              ,Source.Source_ApprenticeshipId
			  ,@RunId
   FROM #tSourceApprenticeship Source

COMMIT TRANSACTION
END


 /* Delta Code */
 /*

 MERGE dbo.Apprenticeship as Target
 USING #tSourceApprenticeship as Source
    ON Target.Source_ApprenticeshipId=Source.Source_ApprenticeshipId
  WHEN MATCHED AND ( Target.Cost<>Source.Cost
	              OR Target.StartDate<>Source.StartDate
	              OR Target.EndDate<>Source.EndDate
	              OR Target.AgreementStatus<>Source.AgreementStatus
	              OR Target.ApprenticeshipStatus<>Source.ApprenticeshipStatus
	              OR Target.EmployerRef<>Source.EmployerRef
	              OR Target.ProviderRef<>Source.ProviderRef
				  OR Target.CommitmentCreatedOn<>Source.CommitmentCreatedOn
				  OR Target.CommitmentAgreedOn<>Source.CommitmentAgreedOn
				  OR Target.PaymentOrder<>Source.PaymentOrder
	              OR Target.StopDate<>Source.StopDate
	              OR Target.PauseDate<>Source.PauseDate
	              OR Target.HasHadDataLockSuccess<>Source.HasHadDataLockSuccess
	              OR Target.PendingUpdateOriginator<>Source.PendingUpdateOriginator
	              OR Target.CloneOf<>Source.CloneOf
	              OR Target.ReservationId<>Source.ReservationId
				  OR Target.CommitmentId<>Source.CommitmentId
				  OR Target.ApprenticeId<>Source.ApprenticeId
				  OR Target.AssessmentOrgId<>Source.AssessmentOrgId
				  OR Target.TrainingCourseId<>Source.TrainingCourseId
				  )
  THEN UPDATE SET Target.Cost=Source.Cost
	             ,Target.StartDate=Source.StartDate
	             ,Target.EndDate=Source.EndDate
	             ,Target.AgreementStatus=Source.AgreementStatus
	             ,Target.ApprenticeshipStatus=Source.ApprenticeshipStatus
	             ,Target.EmployerRef=Source.EmployerRef
	             ,Target.ProviderRef=Source.ProviderRef
				 ,Target.CommitmentCreatedOn=Source.CommitmentCreatedOn
				 ,Target.CommitmentAgreedOn=Source.CommitmentAgreedOn
				 ,Target.PaymentOrder=Source.PaymentOrder
	             ,Target.StopDate=Source.StopDate
	             ,Target.PauseDate=Source.PauseDate
	             ,Target.HasHadDataLockSuccess=Source.HasHadDataLockSuccess
	             ,Target.PendingUpdateOriginator=Source.PendingUpdateOriginator
	             ,Target.CloneOf=Source.CloneOf
	             ,Target.ReservationId=Source.ReservationId
				 ,Target.CommitmentId=Source.CommitmentId
				 ,Target.ApprenticeId=Source.ApprenticeId
				 ,Target.AssessmentOrgId=Source.AssessmentOrgId
				 ,Target.TrainingCourseId=Source.TrainingCourseId
				 ,Target.AsDm_UpdatedDate=getdate()
   WHEN NOT MATCHED BY TARGET 
   THEN INSERT(CommitmentId 
              ,ApprenticeId
              ,TrainingCourseId
              ,AssessmentOrgId
              ,Cost
              ,StartDate 
              ,EndDate 
              ,AgreementStatus
              ,ApprenticeshipStatus 
              ,EmployerRef
              ,ProviderRef
              ,CommitmentCreatedOn
              ,CommitmentAgreedOn
              ,PaymentOrder
              ,StopDate
              ,PauseDate
              ,HasHadDataLockSuccess
              ,PendingUpdateOriginator
              ,CloneOf
              ,ReservationId
              ,Data_Source
              ,Source_ApprenticeshipId
			  )
	   VALUES (Source.CommitmentId 
              ,Source.ApprenticeId
              ,Source.TrainingCourseId
              ,Source.AssessmentOrgId
              ,Source.Cost
              ,Source.StartDate 
              ,Source.EndDate 
              ,Source.AgreementStatus
              ,Source.ApprenticeshipStatus 
              ,Source.EmployerRef
              ,Source.ProviderRef
              ,Source.CommitmentCreatedOn
              ,Source.CommitmentAgreedOn
              ,Source.PaymentOrder
              ,Source.StopDate
              ,Source.PauseDate
              ,Source.HasHadDataLockSuccess
              ,Source.PendingUpdateOriginator
              ,Source.CloneOf
              ,Source.ReservationId
              ,'Commitments-Apprenticeship'
              ,Source.Source_ApprenticeshipId
			  );

*/
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportApprenticeship',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tApprenticeship]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Commitments_SourceId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[EPAOId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[TrainingType]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[TrainingCourse].[TrainingCode]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[TrainingCourse].[TrainingName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[ULN]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprentice].[FirstName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprentice].[LastName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprentice].[DateOfBirth]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[Commitment].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[ID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice].[ID]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[CommitmentId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ApprenticeId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[TrainingCourseId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[AssessmentOrgId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[Cost]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[StartDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[EndDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[AgreementStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ApprenticeshipStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[EmployerRef]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ProviderRef]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[CommitmentCreatedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[CommitmentAgreedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[PaymentOrder]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[StopDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[PauseDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[HasHadDataLockSuccess]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[PendingUpdateOriginator]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[CloneOf]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ReservationId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[Source_ApprenticeshipId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CommitmentId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ApprenticeId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[TrainingCourseId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[AssessmentOrgId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[Cost]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[StartDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[EndDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[AgreementStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ApprenticeshipStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[EmployerRef]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ProviderRef]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CommitmentCreatedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CommitmentAgreedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[PaymentOrder]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[StopDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[PauseDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[HasHadDataLockSuccess]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[PendingUpdateOriginator]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CloneOf]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ReservationId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[Source_ApprenticeshipId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportApprenticeship].[#tApprenticeship]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tApprenticeship].[*]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[Source_ApprenticeshipId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CommitmentId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[Commitment].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[AssessmentOrgId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[AssessmentOrganisation].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[TrainingCourseId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[TrainingCourse].[ID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ApprenticeId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[Apprentice].[ID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[Cost]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[StartDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[EndDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[AgreementStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ApprenticeshipStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[EmployerRef]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ProviderRef]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CommitmentCreatedOn]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CommitmentAgreedOn]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[PaymentOrder]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[StopDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[PauseDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[HasHadDataLockSuccess]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[PendingUpdateOriginator]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[CloneOf]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[ReservationId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportApprenticeship].[#tSourceApprenticeship].[IsApproved]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportApprenticeship].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="8976" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportApprenticeship]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportAssessmentOrganisation]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import AssessmentOrganisation Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportAssessmentOrganisation'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportAssessmentOrganisation'
     AND RunId=@RunID


  /* Get AssessmentOrganisation Data into Temp Table */

  IF OBJECT_ID ('tempdb..#tAssessmentOrganisation') IS NOT NULL
DROP TABLE #tAssessmentOrganisation

  SELECT EPAOrgId AS EPAOId
        ,Name AS EPAO_Name
		,ID as Source_EPAOID
    INTO #tAssessmentOrganisation
    FROM Comt.Ext_Tbl_AssessmentOrganisation

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.AssessmentOrganisation(EPAOId,EPAO_Name,Source_EPAOID,Data_Source,RunId)
SELECT Source.EPAOId,Source.EPAO_Name,Source_EPAOID,'Commitments-AssessmentOrganisation',@RunId
  FROM #tAssessmentOrganisation Source

COMMIT TRANSACTION
END





/* Delta Code */
/*
 MERGE dbo.AssessmentOrganisation as Target
 USING #tAssessmentOrganisation as Source
    ON Target.EPAOId=Source.EPAOId
  WHEN MATCHED AND ( Target.EPAO_Name<>Source.EPAO_Name
                  OR Target.Source_EPAOID<>Source.Source_EPAOID
				    )
  THEN UPDATE SET Target.EPAO_Name=Source.EPAO_Name
                 ,Target.Source_EPAOID=Source.Source_EPAOID
                 ,Target.Asdm_UpdatedDate=getdate()
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (EPAOId,EPAO_Name,Source_EPAOID,Data_Source)
       VALUES (Source.EPAOId,Source.EPAO_Name,Source_EPAOID,'Commitments-AssessmentOrganisation')
        ;
 */
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportAssessmentOrganisation',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportAssessmentOrganisation].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[EPAOId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[EPAO_Name]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[Source_EPAOId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation].[EPAOId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation].[EPAO_Name]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation].[Source_EPAOID]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation].[EPAOId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation].[EPAO_Name]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportAssessmentOrganisation].[#tAssessmentOrganisation].[Source_EPAOID]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportAssessmentOrganisation].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3188" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportAssessmentOrganisation]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportCommitments]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Provider Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportCommitments'
	   ,getdate()
	   ,0

    SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportCommitments'
     AND RunId=@RunID

  /* Get Commitment Data into Temp Table */
  
IF OBJECT_ID ('tempdb..#tCommitments') IS NOT NULL
DROP TABLE #tCommitments

SELECT *
INTO #tCommitments
from Comt.Ext_Tbl_Commitment

IF OBJECT_ID ('tempdb..#tSourceCommitments') IS NOT NULL
DROP TABLE #tSourceCommitments

select etc.id as Commitments_SourceId
      ,etc.[Reference]
      ,etc.[EmployerAccountId] as CmtEmployerAccountId
      ,etc.[LegalEntityId]
      ,etc.[LegalEntityName]
      ,etc.[LegalEntityAddress]
      ,etc.[LegalEntityOrganisationType]
      ,etc.[ProviderName]
      ,etc.[CommitmentStatus]
      ,etc.[EditStatus]
      ,etc.[CreatedOn] as CommitmentCreatedOn
      ,etc.[LastAction]
      ,etc.[LastUpdatedByEmployerName]
      ,etc.[LastUpdatedByEmployerEmail]
      ,etc.[LastUpdatedByProviderName]
      ,etc.[LastUpdatedByProviderEmail]
      ,etc.[TransferApprovalActionedByEmployerName]
      ,etc.[TransferApprovalActionedByEmployerEmail]
      ,etc.[TransferApprovalActionedOn]
      ,etc.[AccountLegalEntityPublicHashedId]
      ,etc.[Originator]
	  ,EA.iD as EmployerAccountId
	  ,EALE.id as EmployerAccountLegalEntityId
	  ,Pro.Id as ProviderId
into #tSourceCommitments
from #tCommitments ETC
left
join dbo.EmployerAccount EA
  on ETC.EmployerAccountId=EA.Source_AccountId
LEFT
JOIN dbo.EmployerAccountLegalEntity EALE
  on ETC.EmployerAccountId=EALE.Source_AccountId
 and ETC.LegalEntityId=EALE.LegalEntityId
left
join dbo.Provider Pro
  on Pro.Ukprn=ETC.ProviderId

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN 
BEGIN TRANSACTION

INSERT INTO dbo.Commitment(EmployerAccountId
              ,EmployerAccountLegalEntityId
              ,ProviderId
			  ,Reference
			  ,CommitmentStatus
			  ,EditStatus
			  ,CommitmentCreatedOn
			  ,LastAction
			  ,LastUpdatedByEmployerName
			  ,LastUpdatedByEmployerEmail
			  ,LastUpdatedByProviderName
			  ,LastUpdatedByProviderEmail
			  --,EmployerProviderPaymentPriority
			  --,ProviderCanApproveCommitment
			  --,EmployerCanApproveCommitment
			  ,Originator
			  ,Data_Source
			  ,Commitments_SourceId
			  ,RunId
			  )
SELECT Source.EmployerAccountId
	          ,Source.EmployerAccountLegalEntityId
              ,Source.ProviderId
			  ,Source.Reference
			  ,Source.CommitmentStatus
			  ,Source.EditStatus
			  ,Source.CommitmentCreatedOn
			  ,Source.LastAction
			  ,Source.LastUpdatedByEmployerName
			  ,Source.LastUpdatedByEmployerEmail
			  ,Source.LastUpdatedByProviderName
			  ,Source.LastUpdatedByProviderEmail
			  --,Source.EmployerProviderPaymentPriority
			  --,Source.ProviderCanApproveCommitment
			  --,Source.EmployerCanApproveCommitment
			  ,Source.Originator
			  ,'Commitments'
			  ,Source.Commitments_SourceId
			  ,@RunId
   FROM #tSourceCommitments Source


COMMIT TRANSACTION
END





  /* Delta Code */
/*

 MERGE dbo.Commitment as Target
 USING #tSourceCommitments as Source
    ON Target.Reference=Source.Reference
  WHEN MATCHED AND (  Target.EmployerAccountId<>Source.EmployerAccountId
                   OR Target.EmployerAccountLegalEntityId<>Source.EmployerAccountLegalEntityId
                   OR Target.ProviderId<>Source.ProviderId
				   OR Target.CommitmentStatus<>Source.CommitmentStatus
				   OR Target.EditStatus<>Source.EditStatus
				   OR Target.CommitmentCreatedOn<>Source.CommitmentCreatedOn
				   OR Target.LastAction<>Source.LastAction
				   OR Target.LastUpdatedByEmployerName<>Source.LastUpdatedByEmployerName
				   OR Target.LastUpdatedByEmployerEmail<>Source.LastUpdatedByEmployerEmail
				   OR Target.LastUpdatedByProviderName<>Source.LastUpdatedByProviderName
				   OR Target.LastUpdatedByProviderEmail<>Source.LastUpdatedByProviderEmail
				   --OR Target.EmployerProviderPaymentPriority<>Source.EmployerProviderPaymentPriority
				   --OR Target.ProviderCanApproveCommitment<>Source.ProviderCanApproveCommitment
				   --OR Target.EmployerCanApproveCommitment<>Source.EmployerCanApproveCommitment
				   OR Target.Originator<>Source.Originator
				   OR Target.Commitments_SourceId<>Source.Commitments_SourceId
				   )
  THEN UPDATE SET Target.EmployerAccountId=Source.EmployerAccountId
                 ,Target.EmployerAccountLegalEntityId=Source.EmployerAccountLegalEntityId
                 ,Target.ProviderId=Source.ProviderId
				 ,Target.CommitmentStatus=Source.CommitmentStatus
				 ,Target.EditStatus=Source.EditStatus
				 ,Target.CommitmentCreatedOn=Source.CommitmentCreatedOn
				 ,Target.LastAction=Source.LastAction
				 ,Target.LastUpdatedByEmployerName=Source.LastUpdatedByEmployerName
				 ,Target.LastUpdatedByEmployerEmail=Source.LastUpdatedByEmployerEmail
				 ,Target.LastUpdatedByProviderName=Source.LastUpdatedByProviderName
				 ,Target.LastUpdatedByProviderEmail=Source.LastUpdatedByProviderEmail
				 --,Target.EmployerProviderPaymentPriority=Source.EmployerProviderPaymentPriority
				 --,Target.ProviderCanApproveCommitment=Source.ProviderCanApproveCommitment
				 --,Target.EmployerCanApproveCommitment=Source.EmployerCanApproveCommitment
				 ,Target.Originator=Source.Originator
				 ,Target.Commitments_SourceId=Source.Commitments_SourceId
				 ,Target.AsDm_UpdatedDate=getdate()
   WHEN NOT MATCHED BY TARGET 
   THEN INSERT(EmployerAccountId
              ,EmployerAccountLegalEntityId
              ,ProviderId
			  ,Reference
			  ,CommitmentStatus
			  ,EditStatus
			  ,CommitmentCreatedOn
			  ,LastAction
			  ,LastUpdatedByEmployerName
			  ,LastUpdatedByEmployerEmail
			  ,LastUpdatedByProviderName
			  ,LastUpdatedByProviderEmail
			  --,EmployerProviderPaymentPriority
			  --,ProviderCanApproveCommitment
			  --,EmployerCanApproveCommitment
			  ,Originator
			  ,Data_Source
			  ,Commitments_SourceId
			  )
	   VALUES (Source.EmployerAccountId
	          ,Source.EmployerAccountLegalEntityId
              ,Source.ProviderId
			  ,Source.Reference
			  ,Source.CommitmentStatus
			  ,Source.EditStatus
			  ,Source.CommitmentCreatedOn
			  ,Source.LastAction
			  ,Source.LastUpdatedByEmployerName
			  ,Source.LastUpdatedByEmployerEmail
			  ,Source.LastUpdatedByProviderName
			  ,Source.LastUpdatedByProviderEmail
			  --,Source.EmployerProviderPaymentPriority
			  --,Source.ProviderCanApproveCommitment
			  --,Source.EmployerCanApproveCommitment
			  ,Source.Originator
			  ,'Commitments'
			  ,Source.Commitments_SourceId
			  );

*/
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportCommitments',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tCommitments]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Source_AccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[Source_AccountId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider].[Ukprn]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[EmployerAccountLegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[ProviderId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Reference]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[CommitmentStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[EditStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[CommitmentCreatedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[LastAction]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[LastUpdatedByEmployerName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[LastUpdatedByEmployerEmail]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[LastUpdatedByProviderName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[LastUpdatedByProviderEmail]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Originator]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Commitments_SourceId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[EmployerAccountLegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[ProviderId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[Reference]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[CommitmentStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[EditStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[CommitmentCreatedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastAction]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByEmployerName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByEmployerEmail]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByProviderName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByProviderEmail]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[Originator]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments].[#tSourceCommitments].[Commitments_SourceId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportCommitments].[#tCommitments]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tCommitments].[*]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportCommitments].[#tSourceCommitments]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[Commitments_SourceId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[Reference]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[CmtEmployerAccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LegalEntityId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LegalEntityName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LegalEntityAddress]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LegalEntityOrganisationType]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[ProviderName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[CommitmentStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[EditStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[CommitmentCreatedOn]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastAction]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByEmployerName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByEmployerEmail]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByProviderName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[LastUpdatedByProviderEmail]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[TransferApprovalActionedByEmployerName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[TransferApprovalActionedByEmployerEmail]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[TransferApprovalActionedOn]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[AccountLegalEntityPublicHashedId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[Originator]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[EmployerAccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[EmployerAccount].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[EmployerAccountLegalEntityId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[EmployerAccountLegalEntity].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportCommitments].[#tSourceCommitments].[ProviderId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[Provider].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportCommitments].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="8305" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportCommitments&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportCommitmentsDb]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Data from Commitments Database
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportCommitmentsDb'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportCommitmentsDb'
     AND RunId=@RunID
  


/* Clear Existing Tables for Full Refresh */


DELETE FROM dbo.DataLockStatus
DELETE FROM dbo.Apprenticeship
DELETE FROM dbo.Commitment
DELETE FROM dbo.Provider
DELETE FROM dbo.Apprentice
DELETE FROM dbo.AssessmentOrganisation
DELETE FROM dbo.EmployerAccountLegalEntity
DELETE FROM dbo.EmployerAccount
DELETE FROM DBO.TrainingCourse
DELETE FROM dbo.Transfers

/* Load with Latest Data */

EXEC dbo.ImportProvider @RunId

EXEC dbo.ImportEmployer @RunId

EXEC ImportCommitments @RunId

EXEC ImportTransfers @RunId

EXEC ImportApprentice @RunId

EXEC ImportTrainingCourse @RunId

EXEC ImportAssessmentOrganisation @RunId

EXEC ImportApprenticeship @RunId

EXEC ImportDataLockStatus @RunId




  
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH

 IF @@TRANCOUNT > 0
  ROLLBACK TRAN

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportCommitmentsDb',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitmentsDb].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportProvider]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportCommitments]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprentice]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTrainingCourse]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportAssessmentOrganisation]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportApprenticeship]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportCommitmentsDb].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2560" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportCommitmentsDb]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportDataLockStatus]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import DataLock Status Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportDataLockStatus'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportDataLockStatus'
     AND RunId=@RunID

  /* Get DataLockStatus Data into Temp Table */

 IF OBJECT_ID ('tempdb..#tDataLockStatus') IS NOT NULL
DROP TABLE #tDataLockStatus

  SELECT *
  INTO #tDataLockStatus
  FROM Comt.Ext_Tbl_DataLockStatus

    IF OBJECT_ID ('tempdb..#tSourceDataLock') IS NOT NULL
DROP TABLE #tSourceDataLock

 select  a.ID as ApprenticeshipId
       -- ,tc.ID as TrainingCourseId 
        ,tSD.DataLockEventId
        ,tSD.DataLockEventDateTime
        ,tSD.PriceEpisodeIdentifier 
        ,tSD.IlrTrainingCourseCode 
        ,tSD.IlrTrainingType
        ,tSD.IlrActualStartDate 
        ,tSD.IlrEffectiveFromDate 
        ,tSD.IlrPriceEffectiveToDate
        ,tSD.IlrTotalCost 
        ,tSD.ErrorCode
        ,tSD.Status as DataLockStatus
        ,tSD.TriageStatus
        ,tSD.IsResolved
        ,tSD.EventStatus
        ,tSD.IsExpired
        ,tSD.Expired as Expireddatetime
		,tSD.ID as Source_DataLockStatusId
  into  #tSourceDataLock 
  from  #tDataLockStatus tSD
  LEFT
  JOIN  dbo.Apprenticeship a
    ON  a.Source_ApprenticeshipId=tSD.ApprenticeshipId 
  --LEFT
  --JOIN  dbo.TrainingCourse tc
  --  ON  tc.TrainingCode=tSD.IlrTrainingCourseCode
  -- AND  tc.TrainingType=tSD.IlrTrainingType

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.DataLockStatus([DataLockEventId]
              ,[DataLockEventDatetime]
              ,[PriceEpisodeIdentifier]
              ,[ApprenticeshipId]
              ,[IlrTrainingCourseCode]
              ,[IlrTrainingType]
              ,[IlrActualStartDate]
              ,[IlrEffectiveFromDate]
              ,[IlrPriceEffectiveToDate]
              ,[IlrTotalCost]
              ,[ErrorCode]
              ,[DataLockStatus]
              ,[TriageStatus]
              ,[IsResolved]
              ,[EventStatus]
              ,[IsExpired]
              ,[ExpiredDateTime]
			  ,Data_Source
			  ,Source_DataLockStatusId
			  ,RunId) 
 SELECT Source.[DataLockEventId]
              ,Source.[DataLockEventDatetime]
              ,Source.[PriceEpisodeIdentifier]
              ,Source.[ApprenticeshipId]
              ,Source.[IlrTrainingCourseCode]
              ,Source.[IlrTrainingType]
              ,Source.[IlrActualStartDate]
              ,Source.[IlrEffectiveFromDate]
              ,Source.[IlrPriceEffectiveToDate]
              ,Source.[IlrTotalCost]
              ,Source.[ErrorCode]
              ,Source.[DataLockStatus]
              ,Source.[TriageStatus]
              ,Source.[IsResolved]
              ,Source.[EventStatus]
              ,Source.[IsExpired]
              ,Source.[ExpiredDateTime]
			  ,'Commitments-DataLockStatus'
			  ,Source.Source_DataLockStatusId
			  ,@RunId
   FROM #tSourceDataLock Source

COMMIT TRANSACTION
END



 /* Delta Code */  
/*
 MERGE dbo.DataLockStatus as Target
 USING #tSourceDataLock as Source
    ON Target.DataLockEventId=Source.DataLockEventId
  WHEN MATCHED AND ( Target.ApprenticeshipId<>Source.ApprenticeshipId
                --  OR Target.TrainingCourseId<>Source.TrainingCourseId
                  OR Target.DataLockEventId<>Source.DataLockEventId
                  OR Target.DataLockEventDateTime<>Source.DataLockEventDateTime
                  OR Target.PriceEpisodeIdentifier<>Source.PriceEpisodeIdentifier
                  OR Target.IlrTrainingCourseCode<>Source.IlrTrainingCourseCode
                  OR Target.IlrTrainingType<>Source.IlrTrainingType
                  OR Target.IlrActualStartDate<>Source.IlrActualStartDate
                  OR Target.IlrEffectiveFromDate<>Source.IlrEffectiveFromDate
                  OR Target.IlrPriceEffectiveToDate<>Source.IlrPriceEffectiveToDate
                  OR Target.IlrTotalCost<>Source.IlrTotalCost
                  OR Target.ErrorCode<>Source.ErrorCode
                  OR Target.DataLockStatus<>Source.DataLockStatus
                  OR Target.TriageStatus<>Source.TriageStatus
                  OR Target.IsResolved<>Source.IsResolved
                  OR Target.EventStatus<>Source.EventStatus
                  OR Target.IsExpired<>Source.IsExpired
                  OR Target.Expireddatetime<>Source.Expireddatetime
				  OR Target.Source_DataLockStatusId<>Source.Source_DataLockStatusId
				  )
  THEN UPDATE SET Target.ApprenticeshipId=Source.ApprenticeshipId
            --     ,Target.TrainingCourseId=Source.TrainingCourseId
                 ,Target.DataLockEventId=Source.DataLockEventId
                 ,Target.DataLockEventDateTime=Source.DataLockEventDateTime
                 ,Target.PriceEpisodeIdentifier=Source.PriceEpisodeIdentifier
                 ,Target.IlrTrainingCourseCode=Source.IlrTrainingCourseCode
                 ,Target.IlrTrainingType=Source.IlrTrainingType
                 ,Target.IlrActualStartDate=Source.IlrActualStartDate
                 ,Target.IlrEffectiveFromDate=Source.IlrEffectiveFromDate
                 ,Target.IlrPriceEffectiveToDate=Source.IlrPriceEffectiveToDate
                 ,Target.IlrTotalCost=Source.IlrTotalCost
                 ,Target.ErrorCode=Source.ErrorCode
                 ,Target.DataLockStatus=Source.DataLockStatus
                 ,Target.TriageStatus=Source.TriageStatus
                 ,Target.IsResolved=Source.IsResolved
                 ,Target.EventStatus=Source.EventStatus
                 ,Target.IsExpired=Source.IsExpired
                 ,Target.Expireddatetime=Source.Expireddatetime
				 ,Target.Source_DataLockStatusId=Source.Source_DataLockStatusId
                 ,Target.AsDm_UpdatedDate=getdate()
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT ([DataLockEventId]
              ,[DataLockEventDatetime]
              ,[PriceEpisodeIdentifier]
              ,[ApprenticeshipId]
              ,[IlrTrainingCourseCode]
              ,[IlrTrainingType]
              ,[IlrActualStartDate]
              ,[IlrEffectiveFromDate]
              ,[IlrPriceEffectiveToDate]
              ,[IlrTotalCost]
              ,[ErrorCode]
              ,[DataLockStatus]
              ,[TriageStatus]
              ,[IsResolved]
              ,[EventStatus]
              ,[IsExpired]
              ,[ExpiredDateTime]
			  ,Data_Source
			  ,Source_DataLockStatusId) 
       VALUES (Source.[DataLockEventId]
              ,Source.[DataLockEventDatetime]
              ,Source.[PriceEpisodeIdentifier]
              ,Source.[ApprenticeshipId]
              ,Source.[IlrTrainingCourseCode]
              ,Source.[IlrTrainingType]
              ,Source.[IlrActualStartDate]
              ,Source.[IlrEffectiveFromDate]
              ,Source.[IlrPriceEffectiveToDate]
              ,Source.[IlrTotalCost]
              ,Source.[ErrorCode]
              ,Source.[DataLockStatus]
              ,Source.[TriageStatus]
              ,Source.[IsResolved]
              ,Source.[EventStatus]
              ,Source.[IsExpired]
              ,Source.[ExpiredDateTime]
			  ,'Commitments-DataLockStatus'
			  ,Source.Source_DataLockStatusId
	          );
 */
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportDataLockStatus',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 



/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tDataLockStatus]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Apprenticeship].[Source_ApprenticeshipId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[Apprenticeship].[ID]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[DataLockEventId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[DataLockEventDateTime]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[PriceEpisodeIdentifier]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[ApprenticeshipId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IlrTrainingCourseCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IlrTrainingType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IlrActualStartDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IlrEffectiveFromDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IlrPriceEffectiveToDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IlrTotalCost]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[ErrorCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[DataLockStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[TriageStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IsResolved]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[EventStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[IsExpired]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[Expireddatetime]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[Source_DataLockStatusId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DataLockStatus].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[DataLockEventId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[DataLockEventDateTime]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[PriceEpisodeIdentifier]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[ApprenticeshipId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrTrainingCourseCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrTrainingType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrActualStartDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrEffectiveFromDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrPriceEffectiveToDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrTotalCost]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[ErrorCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[DataLockStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[TriageStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IsResolved]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[EventStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IsExpired]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[Expireddatetime]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[Source_DataLockStatusId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportDataLockStatus].[#tDataLockStatus]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tDataLockStatus].[*]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[ApprenticeshipId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[Apprenticeship].[ID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[DataLockEventId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[DataLockEventDateTime]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[PriceEpisodeIdentifier]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrTrainingCourseCode]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrTrainingType]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrActualStartDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrEffectiveFromDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrPriceEffectiveToDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IlrTotalCost]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[ErrorCode]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[DataLockStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[TriageStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IsResolved]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[EventStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[IsExpired]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[Expireddatetime]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportDataLockStatus].[#tSourceDataLock].[Source_DataLockStatusId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportDataLockStatus].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="8860" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportDataLockStatus&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportEmployer]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Employer Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportEmployer'
	   ,getdate()
	   ,0

    SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportEmployer'
     AND RunId=@RunID

  /* Get Employer Account Data into Temp Table */

IF OBJECT_ID ('tempdb..#tEmployerAccount') IS NOT NULL
DROP TABLE #tEmployerAccount

SELECT ETA.HashedId as EmpHashedId
      ,ETA.PublicHashedId as EmpPublicHashedId
	  ,ETA.Name as EmpName
      ,ETA.Created as AccountCreatedDate
	  ,ETA.Updated as AccountUpdatedDate
	  ,ETA.Id as Source_AccountId
INTO #tEmployerAccount
FROM Comt.Ext_Tbl_Accounts ETA

/* Full Refresh EmployerAccount*/

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.EmployerAccount(EmpHashedId
              ,EmpPublicHashedID
              ,EmpName
			  ,AccountCreatedDate
			  ,AccountUpdatedDate
			  ,Data_Source
			  ,Source_AccountId
			  ,RunId) 
SELECT Source.EmpHashedId
	         , Source.EmpPublicHashedId
	         , Source.EmpName
			 , Source.AccountCreatedDate
			 , Source.AccountUpdatedDate
			 , 'Commitments-Accounts'
			 , Source.Source_AccountId
			 ,@RunId
  FROM #tEmployerAccount Source

COMMIT TRANSACTION
END


/* Code for Delta */

 /*MERGE dbo.EmployerAccount as Target
 USING #tEmployerAccount as Source
    ON Target.EmpHashedID=Source.EmpHashedID
  WHEN MATCHED AND (Target.EmpPublicHashedId<>Source.EmpPublicHashedId
                  OR Target.EmpName<>Source.EmpName
				  OR Target.AccountCreatedDate<>Source.AccountCreatedDate
				  OR Target.AccountUpdatedDate<>Source.AccountUpdatedDate
				  OR Target.Source_AccountId<>Source.Source_AccountId
				  )
  THEN UPDATE SET Target.EmpPublicHashedId=Source.EmpPublicHashedId
                 ,Target.EmpName=Source.EmpName
	             ,Target.AccountCreatedDate=Source.AccountCreatedDate
				 ,Target.AccountUpdatedDate=Source.AccountUpdatedDate
                 ,Target.Asdm_UpdatedDate=getdate()
				 ,Target.Source_AccountId=Source.Source_AccountId
				 ,Target.Data_Source='Commitments-Accounts'
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (EmpHashedId
              ,EmpPublicHashedID
              ,EmpName
			  ,AccountCreatedDate
			  ,AccountUpdatedDate
			  ,Data_Source
			  ,Source_AccountId) 
       VALUES (Source.EmpHashedId
	         , Source.EmpPublicHashedId
	         , Source.EmpName
			 , Source.AccountCreatedDate
			 , Source.AccountUpdatedDate
			 , 'Commitments-Accounts'
			 , Source.Source_AccountId);

*/

  /* Get Employer Account Legal Entity Data into Temp Table */


IF OBJECT_ID ('tempdb..#tEmployerAccountLegalEntity') IS NOT NULL
DROP TABLE #tEmployerAccountLegalEntity

SELECT   ETAL.LegalEntityId 
        ,ETAL.PublicHashedId as LegalEntityPublicHashedId
        ,ETAL.Name as LegalEntityName
        ,ETAL.OrganisationType 
        ,ETAL.Address as LegalEntityAddress 
        ,ETAL.Created as LegalEntityCreatedDate 
        ,ETAL.Updated as LegalEntityUpdatedDate 
        ,ETAL.Deleted as LegalEntityDeletedDate 
		,ETAL.ID as Source_AccountLegalEntityId
		,ETAL.AccountId as Source_AccountId
		,EA.Id as EmployerAccountId
INTO #tEmployerAccountLegalEntity
FROM Comt.Ext_Tbl_AccountLegalEntities ETAL
LEFT
JOIN dbo.EmployerAccount EA
  ON EA.Source_AccountId=ETAL.AccountId

/* Full Refresh Employer Account Legal Entity*/

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION


INSERT INTO dbo.EmployerAccountLegalEntity(LegalEntityId
			  ,LegalEntityPublicHashedId
			  ,LegalEntityName
			  ,OrganisationType
			  ,LegalEntityAddress
			  ,LegalEntityCreatedDate
			  ,LegalEntityUpdatedDate
			  ,LegalEntityDeletedDate
			  ,Data_Source
			  ,Source_AccountLegalEntityId
			  ,Source_AccountId
			  ,EmployerAccountId) 
SELECT Source.LegalEntityId
			 , Source.LegalEntityPublicHashedId
			 , Source.LegalEntityName
			 , Source.OrganisationType
			 , Source.LegalEntityAddress
			 , Source.LegalEntityCreatedDate
			 , Source.LegalEntityUpdatedDate
			 , Source.LegalEntityDeletedDate
			 , 'Commitments-AccountLegalEntity'
			 , Source.Source_AccountLegalEntityId
			 , Source.Source_AccountId
			 , Source.EmployerAccountId
  FROM #tEmployerAccountLegalEntity Source

COMMIT TRANSACTION
END

  /* Delta Code */
/*
 MERGE dbo.EmployerAccountLegalEntity as Target
 USING #tEmployerAccountLegalEntity as Source
    ON Target.LegalEntityPublicHashedId=Source.LegalEntityPublicHashedId
  WHEN MATCHED AND (Target.LegalEntityId<>Source.LegalEntityId
				  OR Target.LegalEntityPublicHashedId<>Source.LegalEntityPublicHashedId
				  OR Target.LegalEntityName<>Source.LegalEntityName
				  OR Target.OrganisationType<>Source.OrganisationType
				  OR Target.LegalEntityAddress<>Source.LegalEntityAddress
				  OR Target.LegalEntityCreatedDate<>Source.LegalEntityCreatedDate
				  OR Target.LegalEntityUpdatedDate<>Source.LegalEntityUpdatedDate
				  OR Target.LegalEntityDeletedDate<>Source.LegalEntityDeletedDate
				  OR Target.Source_AccountLegalEntityID<>Source.Source_AccountLegalEntityId
				  OR Target.Source_AccountId<>Source.Source_AccountId
				  OR Target.EmployerAccountId<>Source.EmployerAccountId
				  )
  THEN UPDATE SET Target.LegalEntityId=Source.LegalEntityId
				 ,Target.LegalEntityPublicHashedId=Source.LegalEntityPublicHashedId
				 ,Target.LegalEntityName=Source.LegalEntityName
				 ,Target.OrganisationType=Source.OrganisationType
				 ,Target.LegalEntityAddress=Source.LegalEntityAddress
				 ,Target.LegalEntityCreatedDate=Source.LegalEntityCreatedDate
				 ,Target.LegalEntityUpdatedDate=Source.LegalEntityUpdatedDate
				 ,Target.LegalEntityDeletedDate=Source.LegalEntityDeletedDate
				 ,Target.Data_Source='Commitments-AccountLegalEntity'
				 ,Target.Source_AccountLegalEntityID=Source.Source_AccountLegalEntityId
				 ,Target.Source_AccountId=Source.Source_AccountId
				 ,Target.EmployerAccountId=Source.EmployerAccountId
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (LegalEntityId
			  ,LegalEntityPublicHashedId
			  ,LegalEntityName
			  ,OrganisationType
			  ,LegalEntityAddress
			  ,LegalEntityCreatedDate
			  ,LegalEntityUpdatedDate
			  ,LegalEntityDeletedDate
			  ,Data_Source
			  ,Source_AccountLegalEntityId
			  ,Source_AccountId
			  ,EmployerAccountId) 
       VALUES (Source.LegalEntityId
			 , Source.LegalEntityPublicHashedId
			 , Source.LegalEntityName
			 , Source.OrganisationType
			 , Source.LegalEntityAddress
			 , Source.LegalEntityCreatedDate
			 , Source.LegalEntityUpdatedDate
			 , Source.LegalEntityDeletedDate
			 , 'Commitments-AccountLegalEntity'
			 , Source.Source_AccountLegalEntityId
			 , Source.Source_AccountId
			 , Source.EmployerAccountId);

			 */
 
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportEmployer',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[EmpHashedId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[EmpPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[EmpName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[AccountCreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[AccountUpdatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Source_AccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount].[EmpHashedId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount].[EmpPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount].[EmpName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount].[AccountCreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount].[AccountUpdatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccount].[Source_AccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Source_AccountId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[OrganisationType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityAddress]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityCreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityUpdatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[LegalEntityDeletedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[Source_AccountLegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[Source_AccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[OrganisationType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityAddress]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityCreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityUpdatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityDeletedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[Source_AccountLegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[Source_AccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportEmployer].[#tEmployerAccount]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccount].[EmpHashedId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccount].[EmpPublicHashedId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccount].[EmpName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccount].[AccountCreatedDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccount].[AccountUpdatedDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccount].[Source_AccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityPublicHashedId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[OrganisationType]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityAddress]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityCreatedDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityUpdatedDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[LegalEntityDeletedDate]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[Source_AccountLegalEntityId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[Source_AccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportEmployer].[#tEmployerAccountLegalEntity].[EmployerAccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[EmployerAccount].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportEmployer].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="8376" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportEmployer&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportPaymentsSnapshot]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 03/02/2020
-- Description: Import Payments Snapshot Data to help with Data Science Metadata Refresh Issue
--              ADM- 1036
-- Change Control
--     
-- Date				Author        Jira      Description
-- 06/05/2020 S Heath       ADM-1312  Change to StgPmnts.Payment instead of external table.
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportPaymentsSnapshot'
	   ,getdate()
	   ,0

    SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportPaymentsSnapshot'
     AND RunId=@RunID


/* Import Payments Snapshot for Data Science */

TRUNCATE TABLE dbo.Payments_SS

DECLARE @vsql1 nvarchar(max)
DECLARE @vsql2 nvarchar(max)
DECLARE @vsql3 nvarchar(max)
DECLARE @vsql4 nvarchar(max)

-- CTEs
SET @vsql1='
WITH cte_Payment AS
( -- rework data from new payments staging table to match data sourced from external table
SELECT
      P.ID 
    , P.EventId AS PaymentID
    , P.Ukprn
    , P.LearnerUln
    , P.AccountId
    , P.ApprenticeshipId
    , P.Amount
    , P.FundingSource
    , P.TransactionType
    , P.ContractType
    -- Mapped 0 as -1 in these codes to match original query
    , CASE WHEN P.LearningAimStandardCode = 0 THEN -1 
        ELSE P.LearningAimStandardCode 
      END                                           AS StdCode
    , CASE WHEN P.LearningAimFrameworkCode = 0 THEN -1
        ELSE P.LearningAimFrameworkCode 
     END                                            AS FworkCode
    , CASE WHEN P.LearningAimProgrammeType = 0 THEN -1
        ELSE P.LearningAimProgrammeType
      END                                           AS ProgType
    , CASE WHEN P.LearningAimPathwayCode = 0 THEN -1 
        ELSE P.LearningAimPathwayCode
      END                                           AS PwayCode
    -- derive dates from academic year / month to match original view calendar year values
    -- There are no calendar loookup for collection period R13/14 so deal with them in a case.
    , CASE WHEN P.CollectionPeriod <= 12 THEN CalCP.CalendarMonthNumber                     
        WHEN P.CollectionPeriod = 13 THEN 9
        WHEN P.CollectionPeriod = 14 THEN 10
      END                                           AS CollectionMonth
    , CASE WHEN P.CollectionPeriod <= 12 THEN CalCP.CalendarYear                            
      WHEN P.CollectionPeriod IN (13,14) THEN  
        Cast( ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) AS INT )
      END                                           AS CollectionYear
    , Cast( P.AcademicYear AS varchar) + ''-R'' 
      + RIGHT( ''0'' 
      + Cast (CollectionPeriod AS varchar), 2 )     AS CollectionPeriodName
    , ''R'' + Right( ''0'' 
          + Cast (CollectionPeriod AS varchar), 2 ) AS CollectionPeriodMonth
    , P.AcademicYear                                AS CollectionPeriodYear
    -- Need to lookup actual date for collection date as its used in age calcs (not academic calendar)
    , CASE WHEN P.CollectionPeriod <=12 THEN 
          Cast(CalCP.CalendarYear AS varchar)+ ''-''
          + RIGHT(''0'' + RTRIM(cast(CalCP.CalendarMonthNumber AS varchar)), 2)
          + ''-01''  
        WHEN P.CollectionPeriod = 13 THEN
          ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) 
          + ''-09-01''
        WHEN P.CollectionPeriod = 14 THEN
          ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4)
          + ''-10-01''
      END                                           AS CollectionDate
    , CalDP.CalendarMonthNumber                     AS DeliveryMonth
    , CalDP.CalendarYear                            AS DeliveryYear
    , CalDP.CalendarMonthShortNameYear              AS DeliveryMonthShortNameYear 
    , P.DeliveryPeriod                              AS DeliveryPeriod
    , Cast(CalDP.CalendarYear AS varchar) + ''-''
      + RIGHT(''0'' + RTRIM(cast(CalDP.CalendarMonthNumber AS varchar)), 2)
      + ''-01''                                     AS DeliveryDate
    , P.IlrSubmissionDateTime                       AS EvidenceSubmittedOn
  FROM StgPmts.Payment P
  LEFT OUTER JOIN dbo.DASCalendarMonth CalCP -- Calendar Conversion for CollectionPeriod Dates
    ON ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 1, 2) 
      + ''/'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) = CalCP.AcademicYear 
    AND P.CollectionPeriod = CalCP.AcademicMonthNumber
  LEFT OUTER JOIN dbo.DASCalendarMonth CalDP -- Calendar Conversion for DeliveryPeriod Dates
    ON ''20'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 1, 2) 
      + ''/'' + Substring( Cast ( P.AcademicYear AS VARCHAR) , 3, 4) = CalDP.AcademicYear 
      AND P.DeliveryPeriod = CalDP.AcademicMonthNumber 
)
'
-- Insert
SET @vsql2='
        INSERT INTO  dbo.Payments_SS
		  ([PaymentId]
           ,[UkPrn]
           ,[Uln]
           ,[EmployerAccountId]
		   ,DasAccountId
		   ,CommitmentID
		   ,DeliveryMonth
		   ,DeliveryYear
		   ,CollectionMonth
		   ,CollectionYear
		   ,EvidenceSubmittedOn
		   ,EmployerAccountVersion
		   ,ApprenticeshipVersion
		   ,FundingSource
		   ,FundingAccountId
		   ,TransactionType
		   ,Amount
		   ,StdCode
		   ,FworkCode
		   ,ProgType
		   ,PwayCode
		   ,ContractType
		   ,UpdateDateTime
		   ,UpdateDate
		   ,Flag_Latest
		   ,Flag_FirstPayment
		   ,PaymentAge
		   ,PaymentAgeBand
		   ,DeliveryMonthShortNameYear
		   ,DASAccountName
		   ,CollectionPeriodName
		   ,CollectionPeriodMonth
		   ,CollectionPeriodYear
          )
'
-- Main Select
SET @VSQL3 = '
SELECT 
-- not needed as its a sequence on SS table P.ID
   CAST( P.PaymentId AS nvarchar(100) )                              AS PaymentID  
  , P.UKprn                                                           AS UKPRN 
  , P.LearnerUln                                                      AS ULN 
  , CAST(P.AccountId AS nvarchar(100) )                               AS EmployerAccountID 
  , Acct.HashedId                                                     AS DasAccountId 
  , IsNull( P.ApprenticeshipId, -1)                                   AS CommitmentID 
  , P.DeliveryMonth                                                   AS DeliveryMonth 
  , P.DeliveryYear                                                    AS DeliveryYear 
  , ISNULL( CAST(P.CollectionMonth AS INT), -1)                       AS CollectionMonth 
  , ISNULL( CAST(P.CollectionYear  AS INT), -1)                       AS CollectionYear 
  , ISNULL(CAST( P.EvidenceSubmittedOn AS datetime ), ''9999-12-31'') AS EvidenceSubmittedOn 
  , CAST( NULL AS nvarchar(50) )                                      AS EmployerAccountVersion 
  , CAST( NULL AS nvarchar(50) )                                      AS ApprenticeshipVersion 
	, CAST( COALESCE(FS.FieldDesc,''Unknown'') AS nvarchar(25) )        AS FundingSource
  , CASE
      WHEN P.FundingSource = 5 THEN EAT.SenderAccountId
      ELSE NULL
    END                                                               AS FundingAccountId
	, CAST( COALESCE(TT.FieldDesc,''Unknown'') AS nvarchar(50) )        AS TransactionType
  , ISNULL( CAST( P.Amount AS DECIMAL (18, 5) ), -1 )                 AS Amount
  , P.StdCode
  , P.FworkCode
  , P.ProgType
  , P.PwayCode
  , CAST(CT.FieldDesc AS NVARCHAR(50))                                AS ContractType 
  , ISNULL( CAST( EvidenceSubmittedOn AS DATETIME ), ''9999-12-31'')  AS UpdateDateTime 
  , CAST( EvidenceSubmittedOn AS DATE )                               AS UpdateDate
  , 1                                                                 AS Flag_Latest
  , COALESCE(FP.Flag_FirstPayment, 0)                                 AS Flag_FirstPayment 
  , CASE
      WHEN C.DateOfBirth IS NULL THEN -1
      WHEN DATEPART(M,C.DateOfBirth) > DATEPART(M,P.CollectionDate) 
        OR (DATEPART(M,C.DateOfBirth) = DATEPART(M,P.CollectionDate) 
            AND DATEPART(DD,C.DateOfBirth) > DATEPART(DD,P.CollectionDate)
            ) THEN DATEDIFF(YEAR,C.DateOfBirth,P.CollectionDate) -1
      ELSE DATEDIFF(YEAR, C.DateOfBirth, p.CollectionDate)
    END                                                               AS PaymentAge 
  , CASE
      WHEN C.DateOfBirth IS NULL THEN ''Unknown DOB (no commitment)''
      WHEN 
        CASE
          WHEN C.DateOfBirth IS NULL THEN -1
          WHEN DATEPART(M,C.DateOfBirth) > DATEPART(M,P.CollectionDate) 
            OR ( DATEPART(M,C.DateOfBirth) = DATEPART(M,P.CollectionDate) 
                 AND DATEPART(DD,C.DateOfBirth) > DATEPART(DD,P.CollectionDate)
               ) THEN DATEDIFF(YEAR,C.DateOfBirth,P.CollectionDate) -1
          ELSE DATEDIFF(YEAR,C.DateOfBirth, P.CollectionDate)
        END BETWEEN 0 AND 18 THEN ''16-18''
      ELSE ''19+''
    END                                                               AS PaymentAgeBand 
  , P.DeliveryMonthShortNameYear 
  , Acct.Name                                                         AS DASAccountName 
  , CAST ( P.CollectionPeriodName AS nvarchar(20) )                   AS CollectionPeriodName
  , CAST ( P.CollectionPeriodMonth AS nvarchar(10) )                  AS CollectionPeriodMonth
  , CAST ( P.CollectionPeriodYear AS nvarchar(10) )                   AS CollectionPeriodYear'
-- Joins
SET @VSQL4 = '
FROM cte_Payment P 
LEFT JOIN Acct.Ext_Tbl_Account Acct ON Acct.Id = P.AccountId
LEFT JOIN Comt.Ext_Tbl_Apprenticeship C
  ON P.ApprenticeshipId = C.ID
LEFT JOIN -- transfers
( SELECT DISTINCT 
    SenderAccountId
    , ReceiverAccountId
    , ApprenticeshipId
  FROM Fin.Ext_Tbl_AccountTransfers
) EAT ON P.ApprenticeshipId = EAT.ApprenticeshipId 
-- need to use cte_payment as weve messed with the delivery dates and they wont join
-- create a string to decide which is min doing individual columns doesnt 
-- work as dates and IDs are in alignment
LEFT JOIN
( SELECT P.AccountId
  , P.ApprenticeshipId
   , MIN( CAST( P.CollectionDate AS VARCHAR (12) ) 
    + ''-'' + CAST( P.DeliveryDate AS varchar(12) )
    + ''-'' + CAST( P.EvidenceSubmittedOn AS varchar(25) )
    + ''-'' + CAST( P.Id AS VARCHAR(12) ) ) AS MinPaymentString
  , 1 AS Flag_FirstPayment
  FROM cte_Payment P
  GROUP BY P.AccountId, P.ApprenticeshipId  
) FP ON P.AccountId = FP.AccountId
  AND ( CAST( P.CollectionDate AS VARCHAR (12) ) 
    + ''-'' + CAST( P.DeliveryDate AS varchar(12) )
    + ''-'' + CAST( P.EvidenceSubmittedOn AS varchar(25) )
    + ''-'' + CAST( P.Id AS VARCHAR(12) ) ) = FP.MinPaymentString
LEFT JOIN dbo.ReferenceData TT
  ON TT.FieldValue = P.TransactionType
    AND TT.FieldName = ''TransactionType''
    AND TT.Category = ''Payments''
LEFT JOIN dbo.ReferenceData FS
  ON FS.FieldValue=P.FundingSource
    AND FS.FieldName=''FundingSource''
    AND FS.Category=''Payments''
LEFT JOIN dbo.ReferenceData CT
  ON CT.FieldValue=P.ContractType
    AND CT.FieldName=''ContractType''
    AND CT.Category=''Payments''
'

EXEC (@vsql1+@vsql2+@vsql3+@vsql4)
 
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportPaymentsSnapshot',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportPaymentsSnapshot].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Payments_SS]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportPaymentsSnapshot].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="12606" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportPaymentsSnapshot&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportProvider]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Provider Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportProvider'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportProvider'
     AND RunId=@RunID

  /* Get Provider Data into Temp Table */

 /* Code for Full Refresh */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

 INSERT INTO dbo.Provider
 (Ukprn,ProviderName,RunId)
 SELECT Ukprn,Name,@RunId
   FROM Comt.Ext_Tbl_Providers
COMMIT TRANSACTION
END





/* Code for Delta */

/* MERGE dbo.Provider as Target
 USING dbo.Ext_Tbl_Providers as Source
    ON Target.Ukprn=Source.Ukprn
  WHEN MATCHED AND Target.Ukprn<>Source.Ukprn
  THEN UPDATE SET Target.ProviderName=Source.Name
                 ,Target.Asdm_UpdatedDate=getdate()
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (Ukprn,ProviderName) 
       VALUES (Source.Ukprn, Source.[Name]);

*/
 
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
   IF @@TRANCOUNT>0
   ROLLBACK TRANSACTION


    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportProvider',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportProvider].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider].[Ukprn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider].[ProviderName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Provider].[RunId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportProvider].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="2475" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportProvider&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportRAAUsersStgToLive]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ============================================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 08/04/2020
-- Description: Import RAA Users Stg Tables To Live Tables, Apply Transformations where needed
-- ============================================================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-5'
	   ,'ImportRAAUsersStgToLive'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportRAAUsersStgToLive'
     AND RunId=@RunID

  /* Get RAA Users From Staging to Live Tables, Apply Transformation Rules */

   
BEGIN TRANSACTION

DELETE FROM ASData_PL.RAA_Users

INSERT INTO [ASData_PL].[RAA_Users]
           ([BinaryId]
           ,[TypeCode]
           ,[IdamUserId]
           ,[UserType]
           ,[UserName]
           ,[UserEmail]
           ,[UserCreatedTimeStamp]
		   ,UserCreatedDateTime
           ,[LastSignedInTimeStamp]
		   ,LastSignedDateTime
           ,[EmployerAccountId]
           ,[Ukprn]
           ,[RunId]
           ,[AsDm_CreatedDate]
           ,[AsDm_UpdatedDate])
 SELECT  Src.BinaryId
	          ,Src.TypeCode
	          ,Src.IdamUserId
	          ,Src.UserType
	          ,Src.UserName
	          ,Src.UserEmail
	          ,Src.UserCreatedTimeStamp
	          ,dbo.Fn_ConvertTimeStampToDateTime(UserCreatedTimeStamp)
	          ,Src.LastSignedInTimeStamp 
	          ,dbo.Fn_ConvertTimeStampToDateTime(LastSignedInTimeStamp)
			  ,REPLACE(REPLACE(REPLACE(Src.EmployerAccountId,'[',''),']',''),'"','')
	          ,Src.Ukprn
			  ,@RunId
			  ,getdate()
			  ,getdate()
	FROM Stg.RAA_Users Src

COMMIT TRANSACTION


 
 
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

	
  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  ,ErrorADFTaskType
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportRAAUsersStgToLive',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId,
		'ImportRAAUsersToLive'; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportRAAUsersStgToLive].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[BinaryId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[TypeCode]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[IdamUserId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[UserType]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[UserEmail]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[UserCreatedTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[UserCreatedDateTime]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[LastSignedInTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[LastSignedDateTime]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[Ukprn]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[AsDm_CreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[RAA_Users].[AsDm_UpdatedDate]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[BinaryId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[TypeCode]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[IdamUserId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[UserType]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[UserEmail]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[UserCreatedTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[UserCreatedTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[LastSignedInTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[LastSignedInTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Users].[Ukprn]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorADFTaskType]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportRAAUsersStgToLive].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="3185" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportRAAUsersStgToLive&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportTrainingCourse]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import TrainingCourse Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportTrainingCourse'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportTrainingCourse'
     AND RunId=@RunID

  /* Get AssessmentOrganisation Data into Temp Table */

IF OBJECT_ID ('tempdb..#tTrainingCourse') IS NOT NULL
DROP TABLE #tTrainingCourse

  SELECT DISTINCT 
         TrainingType
        ,TrainingCode
		,TrainingName
    INTO #tTrainingCourse
    FROM Comt.Ext_Tbl_Apprenticeship

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.TrainingCourse(TrainingType,TrainingCode,TrainingName,Data_Source,RunId) 
SELECT Source.TrainingType,Source.TrainingCode,Source.TrainingName,'Commitments-Apprenticeship',@RunId
  FROM #tTrainingCourse Source

COMMIT TRANSACTION
END





	/* Delta Code */
	/*
 MERGE dbo.TrainingCourse as Target
 USING #tTrainingCourse as Source
    ON Target.TrainingCode=Source.TrainingCode
  WHEN MATCHED AND ( Target.TrainingType<>Source.TrainingType
                  OR Target.TrainingName<>Source.TrainingName
				  )
  THEN UPDATE SET Target.TrainingType=Source.TrainingType
                 ,Target.TrainingName=Source.TrainingName
                 ,Target.AsDm_UpdatedDate=getdate()
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (TrainingType,TrainingCode,TrainingName,Data_Source) 
       VALUES (Source.TrainingType,Source.TrainingCode,Source.TrainingName,'Commitments-Apprenticeship');
 */
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportTrainingCourse',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTrainingCourse].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[TrainingType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[TrainingCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[TrainingName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[TrainingCourse].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse].[TrainingType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse].[TrainingCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse].[TrainingName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse].[TrainingType]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse].[TrainingCode]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTrainingCourse].[#tTrainingCourse].[TrainingName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportTrainingCourse].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3124" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportTrainingCourse]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportTransfers]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 29/05/2019
-- Description: Import Transfers Related Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-2'
	   ,'ImportTransfers'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportTransfers'
     AND RunId=@RunID


  /* Get Transfers Data into Temp Table */

   
IF OBJECT_ID ('tempdb..#tCommitment') IS NOT NULL
DROP TABLE #tCommitment

SELECT *
  INTO #tCommitment
  FROM Comt.Ext_Tbl_Commitment

IF OBJECT_ID ('tempdb..#tTransferRequest') IS NOT NULL
DROP TABLE #tTransferRequest

SELECT *
  INTO #tTransferRequest
  FROM Comt.Ext_Tbl_TransferRequest

IF OBJECT_ID ('tempdb..#tTransfers') IS NOT NULL
DROP TABLE #tTransfers

 SELECT DISTINCT 
         ETR.TrainingCourses
        ,ETR.Cost
		,ETR.Status as TransferStatus
		,ETR.TransferApprovalActionedByEmployerName
		,ETR.TransferApprovalActionedByEmployerEmail
		,ETR.TransferApprovalActionedOn
		,ETR.CreatedOn as TransferCreatedOn
		,ETR.FundingCap as FundingCap
		,TransferSender.ID as TransferSenderAccountId
		,TransferReceiver.ID as TransferReceiverAccountId
		,C.ID as CommitmentId
		,ETR.ID AS Source_TransferId
  into #tTransfers
  from #tTransferRequest ETR
  LEFT
  JOIN #tCommitment ETC
    ON ETR.CommitmentId=ETC.Id
  LEFT
  JOIN dbo.Commitment C
    ON C.Commitments_SourceId=ETC.Id
  LEFT
  JOIN dbo.EmployerAccount TransferSender
    ON TransferSender.Source_AccountId=ETC.TransferSenderId
  LEFT
  JOIN dbo.EmployerAccount TransferReceiver
    on TransferReceiver.Source_AccountId=ETC.EmployerAccountId

/* Full Refresh Code */

IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION

INSERT INTO dbo.Transfers(CommitmentId
	          ,Cost
	          ,TrainingCourses
	          ,TransferStatus
	          ,TransferSenderAccountId
	          ,TransferReceiverAccountId
	          ,TransferApprovalActionedByEmployerName
	          ,TransferApprovalActionedByEmployerEmail
	          ,TransferApprovalActionedOn 
	          ,FundingCap
			  ,TransferCreatedOn
	          ,Data_Source
	          ,Source_CommitmentTransferId
			  ,RunId
			  ,AsDm_UpdatedDate
			  ,AsDm_CreatedDate) 
 SELECT  Source.CommitmentId
	          ,Source.Cost
	          ,Source.TrainingCourses
	          ,Source.TransferStatus
	          ,Source.TransferSenderAccountId
	          ,Source.TransferReceiverAccountId
	          ,Source.TransferApprovalActionedByEmployerName
	          ,Source.TransferApprovalActionedByEmployerEmail
	          ,Source.TransferApprovalActionedOn 
	          ,Source.FundingCap
			  ,Source.TransferCreatedOn
	          ,'Commitments-TransferRequest'
	          ,Source.Source_TransferId
			  ,@RunId
			  ,getdate()
			  ,getdate()
	FROM #tTransfers Source

COMMIT TRANSACTION
END
/* Delta Code */
/*

 MERGE dbo.Transfers as Target
 USING #tTransfers as Source
    ON Target.CommitmentID=Source.CommitmentID
   AND Target.TransferSenderAccountId=Source.TransferSenderAccountId
   AND Target.TransferReceiverAccountId=Source.TransferReceiverAccountId
  WHEN MATCHED AND (Target.TrainingCourses<>Source.TrainingCourses
                 OR Target.Cost<>Source.Cost
				 OR Target.TransferStatus<>Source.TransferStatus
				 OR Target.TransferApprovalActionedByEmployerName<>Source.TransferApprovalActionedByEmployerName
				 OR Target.TransferApprovalActionedByEmployerEmail<>Source.TransferApprovalActionedByEmployerEmail
				 OR Target.TransferApprovalActionedOn<>Source.TransferApprovalActionedOn
				 OR Target.TransferCreatedOn<>Source.TransferCreatedOn
				 OR Target.FundingCap<>Source.FundingCap
				 OR Target.Source_TransferId<>Source.Source_TransferId
				 )           
  THEN UPDATE SET Target.TrainingCourses=Source.TrainingCourses
                 ,Target.Cost=Source.Cost
				 ,Target.TransferStatus=Source.TransferStatus
				 ,Target.TransferApprovalActionedByEmployerName=Source.TransferApprovalActionedByEmployerName
				 ,Target.TransferApprovalActionedByEmployerEmail=Source.TransferApprovalActionedByEmployerEmail
				 ,Target.TransferApprovalActionedOn=Source.TransferApprovalActionedOn
				 ,Target.TransferCreatedOn=Source.TransferCreatedOn
				 ,Target.FundingCap=Source.FundingCap
				 ,Target.AsDm_UpdatedDate=getdate()
				 ,Target.Source_TransferId=Source.Source_TransferId
  WHEN NOT MATCHED BY TARGET 
  THEN INSERT (CommitmentId
	          ,Cost
	          ,TrainingCourses
	          ,TransferStatus
	          ,TransferSenderAccountId
	          ,TransferReceiverAccountId
	          ,TransferApprovalActionedByEmployerName
	          ,TransferApprovalActionedByEmployerEmail
	          ,TransferApprovalActionedOn 
	          ,FundingCap
			  ,TransferCreatedOn
	          ,Data_Source
	          ,Source_TransferId
			  ,AsDm_UpdatedDate
			  ,AsDm_CreatedDate) 
       VALUES (Source.CommitmentId
	          ,Source.Cost
	          ,Source.TrainingCourses
	          ,Source.TransferStatus
	          ,Source.TransferSenderAccountId
	          ,Source.TransferReceiverAccountId
	          ,Source.TransferApprovalActionedByEmployerName
	          ,Source.TransferApprovalActionedByEmployerEmail
	          ,Source.TransferApprovalActionedOn 
	          ,Source.FundingCap
			  ,Source.TransferCreatedOn
	          ,'Commitments-TransferRequest'
	          ,Source.Source_TransferId
			  ,getdate()
			  ,getdate());

*/
 
 
 
 /* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportTransfers',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tCommitment]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransferRequest]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Commitments_SourceId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Source_AccountId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Source_AccountId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[EmployerAccount].[Id]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Commitment].[Id]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[dbo].[Transfers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[CommitmentId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[Cost]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TrainingCourses]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferSenderAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferReceiverAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferApprovalActionedByEmployerName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferApprovalActionedByEmployerEmail]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferApprovalActionedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[FundingCap]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[TransferCreatedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[Data_Source]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[Source_CommitmentTransferId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[AsDm_UpdatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Transfers].[AsDm_CreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[CommitmentId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[Cost]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TrainingCourses]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferStatus]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferSenderAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferReceiverAccountId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferApprovalActionedByEmployerName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferApprovalActionedByEmployerEmail]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferApprovalActionedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[FundingCap]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[TransferCreatedOn]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportTransfers].[#tTransfers].[Source_TransferId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportTransfers].[#tCommitment]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tCommitment].[*]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportTransfers].[#tTransferRequest]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransferRequest].[*]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportTransfers].[#tTransfers]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TrainingCourses]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[Cost]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferStatus]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferApprovalActionedByEmployerName]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferApprovalActionedByEmployerEmail]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferApprovalActionedOn]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferCreatedOn]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[FundingCap]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferSenderAccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[EmployerAccount].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[TransferReceiverAccountId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[EmployerAccount].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[CommitmentId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[Commitment].[Id]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportTransfers].[#tTransfers].[Source_TransferId]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportTransfers].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="6970" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE ImportTransfers&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesApplicationToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Application Data from v1 and v2
--              Fields that are in v1 but not in v2 or viceversa are replaced with Defaults/Dummy Values
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesApplicationToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesApplicationToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_Application

INSERT INTO [ASData_PL].[Va_Application]
           ([CandidateId]
           ,[VacancyId]
           ,[ApplicationStatusTypeId]
           ,[ApplicationStatusDesc]
           ,[BeingSupportedBy]
           ,[LockedForSupportUntil]
           ,[IsWithdrawn]
           ,[ApplicationGuid]
           ,[CreatedDateTime]
           ,[SourceDb]
           ,[SourceApplicationId])
    SELECT  c.CandidateId                  as CandidateId
           ,v.[VacancyId]                  as VacancyId
           ,AA.[ApplicationStatusTypeId]   as ApplicationStatusTypeId
	       ,AST.FullName                   as ApplicationStatusDesc 
           ,[BeingSupportedBy]             as BeingSupportedBy        
           ,[LockedForSupportUntil]        as LockedForSupportUntil
          ,Case when AA.ApplicationStatusTypeId in (4,8) THEN 1
	            ELSE 0
	        END                            as IsWithdrawn
          ,cast([ApplicationGuid] as varchar(256)) as ApplicationGuid
		  ,AH.HistoryDate                  as CreatedDateTime
		  ,'RAAv1'                         as SourceDb
		  ,AA.ApplicationId                as SourceApplicationId
  FROM [Stg].[Avms_Application] AA
  LEFT
  JOIN ASData_PL.Va_Vacancy v
    ON v.SourceVacancyId=AA.VacancyId
   AND v.SourceDb='RAAv1'
  LEFT
  JOIN Stg.Avms_ApplicationStatusType AST
    ON AA.ApplicationStatusTypeId=AST.ApplicationStatusTypeId
  left
  join (select ApplicationId,min(ApplicationHistoryEventDate) HistoryDate
          from Stg.Avms_ApplicationHistory Ah
		 group by ApplicationId) AH
          ON AH.ApplicationId=AA.ApplicationId
  left
  join ASData_PL.Va_Candidate C
    on c.SourceCandidateId_v1=AA.CandidateId
   AND C.SourceDb='RAAv1'
 UNION
 SELECT C.CandidateId                       as CandidateId
	   ,v.VacancyId                         as VacancyId
	   ,-1                                  as ApplicationStatusTypeId       
	   ,AR.ApplicationStatus                as ApplicationStatusDesc
	   ,'N/A'                               as BeingSupportedBy 
	   ,''                                  as LockedForSupportUntil
	   ,CASE WHEN AR.IsWithDrawn='False' then 0
	         WHEN AR.IsWithDrawn='True' then 1
		 END                                as IsWithdrawn
	   ,CAST(AR.BinaryId as varchar(256))   as ApplicationGuid
	   ,dbo.Fn_ConvertTimeStampToDateTime(ar.CreatedDateTimeStamp) as CreatedDateTime
	   ,'RAAv2'                             as SourceDb
	   ,AR.SourseSK                         as SourceApplicationId
 from Stg.RAA_ApplicationReviews AR
 left
 join ASData_PL.Va_Vacancy V   
   ON V.VacancyReferenceNumber=ar.VacancyReference
  and v.SourceDb='RAAv2'
 left
 join AsData_PL.Va_Candidate C
   on C.CandidateGuid=CAST(AR.CandidateId as Varchar(256))
  and C.SourceDb='RAAv2'




COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesApplicationToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesApplicationToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[VacancyId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[ApplicationStatusTypeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[ApplicationStatusDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[BeingSupportedBy]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[LockedForSupportUntil]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[IsWithdrawn]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[ApplicationGuid]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[CreatedDateTime]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application].[SourceApplicationId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SourceVacancyId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SourceDb]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceCandidateId_v1]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyReferenceNumber]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[VacancyReference]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateGuid]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[ApplicationStatus]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[IsWithDrawn]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[BinaryId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[CreatedDateTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[SourseSK]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesApplicationToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="4896" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesApplicationToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesApprenticeshipFrameworkStandardELToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Employer Data from v1 and v2
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesApprenticeshipFrameworkStandardELToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesApprenticeshipFrameworkStandardELToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_ApprenticeshipFrameWorkAndOccupation
DELETE FROM AsData_PL.Va_ApprenticeshipStandard
DELETE FROM AsData_PL.Va_EducationLevel

/* Load Framework into Presentation Layer */

INSERT INTO [ASData_PL].[Va_ApprenticeshipFrameWorkAndOccupation]
           ([SourceApprenticeshipFrameworkId]
           ,[ProgrammeId_v2]
           ,[SourceDb]
           ,[ApprenticeshipOccupationId]
           ,[FrameworkCodeName]
           ,[FrameworkShortName]
           ,[FrameWorkFullName]
           ,[FrameworkTitle_v2]
           ,[ApprenticeshipFrameworkStatus]
           ,[FrameworkClosedDate]
           ,[PreviousApprenticeshipOccupationId]
           ,[StandardId]
           ,[ApprenticeshipOccupationCodeName]
           ,[ApprenticeshipOccupationShortName]
           ,[ApprenticehipOccupationFullName]
           ,[ApprenticeshipOccupationStatus]
           ,[ApprenticeshipOccupationClosedDate])
SELECT AF.ApprenticeshipFrameworkId  as ApprenticeshipFrameworkId
      ,'N/A'                         as ProgrammeId_v2
	  ,'RAAv1'                       as SourceDb
	  ,AO.ApprenticeshipOccupationId as ApprenticeshipOccupationId
	  ,AF.CodeName                   as FrameworkCodeName
	  ,AF.ShortName                  as FrameworkShortName
	  ,AF.FullName                   as FrameworkFullName
	  ,'N/A'                         as FrameworkTitle_v2
	  ,AFST.ShortName                as FrameworkStatus
	  ,AF.ClosedDate                 as FrameworkClosedDate
	  ,AF.PreviousApprenticeshipOccupationId as PreviousApprenticeshipOccupationId
	  ,AF.StandardId                 as StandardId
	  ,AO.Codename                   as ApprenticeshipOccupationCodeName
	  ,AO.ShortName                  as ApprenticeshipOccupationShortName
	  ,AO.FullName                   as ApprenticeshipOccupationFullName
	  ,AOST.FullName                 as ApprenticeshipOccupationStatus
	  ,AO.ClosedDate                 as ApprenticeshipOccupationClosedDate
  FROM Stg.Avms_ApprenticeshipFramework AF 
  JOIN Stg.Avms_ApprenticeshipOccupation AO 
    ON AO.ApprenticeshipOccupationId=AF.ApprenticeshipOccupationId
  LEFT
  JOIN Stg.Avms_ApprenticeshipFrameworkStatusType AFST
    ON AFST.ApprenticeshipFrameworkStatusTypeId=AF.ApprenticeshipFrameworkStatusTypeId
  LEFT
  JOIN Stg.Avms_ApprenticeshipOccupationStatusType AOST
    ON AOST.ApprenticeshipOccupationStatusTypeId=AO.ApprenticeshipOccupationStatusTypeId
 UNION
SELECT ap.SourseSK                                 as ApprenticeshipFrameworkId
      ,ap.ProgrammeId                              as ProgrammeId_v2
	  ,'RAAv2'                                     as SourceDb
	  ,AO.ApprenticeshipOccupationId               as ApprenticeshipOccupationId
	  ,AF.CodeName                                 as FrameworkCodeName
	  ,AF.ShortName                                as FrameworkShortName
	  ,AF.FullName                                 as FrameworkFullName
	  ,ap.Title                                    as FrameworkTitle
	  ,AFST.ShortName                              as FrameworkStatus
	  ,AF.ClosedDate                               as FrameworkClosedDate
	  ,AF.PreviousApprenticeshipOccupationId       as PreviousApprenticeshipOccupationId
	  ,AF.StandardId                               as StandardId
	  ,AO.Codename                                 as ApprenticeshipOccupationCodeName   
	  ,AO.ShortName                                as ApprenticeshipOccupationShortName
	  ,AO.FullName                                 as ApprenticeshipOccupationFullName
	  ,AOST.FullName                               as ApprenticeshipOccupationStatus
	  ,AO.ClosedDate                               as ApprenticeshipOccupationClosedDate
  FROM Stg.RAA_ReferenceDataApprenticeshipProgrammes AP
  LEFT
  JOIN Stg.Avms_ApprenticeshipFramework AF 
    ON AF.CodeName=SUBSTRING(AP.ProgrammeId,1,3)
   AND AP.ApprenticeshipType='Framework'
  JOIN Stg.Avms_ApprenticeshipOccupation AO 
    ON AO.ApprenticeshipOccupationId=AF.ApprenticeshipOccupationId
  LEFT
  JOIN Stg.Avms_ApprenticeshipFrameworkStatusType AFST
    ON AFST.ApprenticeshipFrameworkStatusTypeId=AF.ApprenticeshipFrameworkStatusTypeId
  LEFT
  JOIN Stg.Avms_ApprenticeshipOccupationStatusType AOST
    ON AOST.ApprenticeshipOccupationStatusTypeId=AO.ApprenticeshipOccupationStatusTypeId

/* Load Standard Into Presentation Layer */

INSERT INTO [ASData_PL].[Va_ApprenticeshipStandard]
           ([StandardId]
           ,[LarsCode]
           ,[StandardFullName]
           ,[StandardSectorId]
           ,[StandardSectorName]
           ,[LarsStandardSectorCode]
           ,[ApprenticeshipOccupationId]
           ,[EducationLevelId]
           ,[ApprenticeshipFrameworkStatusType])
SELECT  ST.StandardId               as StandardId
       ,ST.LarsCode                 as LarsCode
       ,ST.FullName                 as StandardFullName 
	   ,ST.StandardSectorId         as StandardSectorId
	   ,SS.FullName                 as StandardFullName
	   ,SS.[LarsStandardSectorCode] as LarsStandardSectorCode
	   ,SS.ApprenticeshipOccupationId as ApprenticeshipOccupationId
	   ,ST.EducationLevelId         as EducationLevelId
	   ,AFST.FullName               as ApprenticeshipFrameworkStatusType
  FROM Stg.Avms_Standard ST 
  JOIN Stg.Avms_StandardSector SS 
    ON ST.StandardSectorId=SS.StandardSectorId
  LEFT
  JOIN Stg.Avms_ApprenticeshipFrameworkStatusType AFST
    ON AFST.ApprenticeshipFrameworkStatusTypeId=ST.ApprenticeshipFrameworkStatusTypeId

/* Load Education Level Into Presentation Layer */

INSERT INTO [ASData_PL].[Va_EducationLevel]
           ([EducationLevelId]
           ,[EducationLevelCodeName]
           ,[EducationLevelShortName]
           ,[EducationLevelFullName])
SELECT EducationLevelId as EducationLevelId
      ,CodeName         as EducationLevelCodeName
	  ,ShortName        as EducationLevelShortName
	  ,FullName         as EducationLevelFullName
  FROM Stg.Avms_EducationLevel








COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesApprenticeshipFrameworkStandardELToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesApprenticeshipFrameworkStandardELToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceApprenticeshipFrameworkId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ProgrammeId_v2]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkCodeName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkShortName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameWorkFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkTitle_v2]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipFrameworkStatus]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkClosedDate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[PreviousApprenticeshipOccupationId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[StandardId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationCodeName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationShortName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticehipOccupationFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationStatus]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipOccupationClosedDate]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ProgrammeId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ApprenticeshipType]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[SourseSK]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ProgrammeId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[Title]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[LarsCode]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardSectorId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardSectorName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[LarsStandardSectorCode]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[ApprenticeshipOccupationId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[EducationLevelId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[ApprenticeshipFrameworkStatusType]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelCodeName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelShortName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelFullName]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesApprenticeshipFrameworkStandardELToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="8071" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesApprenticeshipFrameworkStandardELToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesCandidateDetailsToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import and Integrate Vacancies Candidate Details from FAA, RAA and AVMS Dbs
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesCandidateDetailsToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesCandidateDetailsToPL'
     AND RunId=@RunID

/* Check if the Copy Activity Count and Candidate Config Count Match for RAAv2 to check if Random ID is generated for all codes , If not raise error */

if((select count(*) CACount
     from stg.CopyActivity
    where runid in (select runid from stg.CandidateConfig)
      and SourceDb='RAAv2')=
   (select count(*) CCCount
      from stg.CandidateConfig
     where SourceDb='RAAv2') 
	 AND
	 (select count(*) CACount
     from stg.CopyActivity
    where runid in (select runid from stg.CandidateConfig)
      and SourceDb='RAAv1')=
   (select count(*) CCCount
      from stg.CandidateConfig
     where SourceDb='RAAv1')
	 AND
	 (select count(*) CCcount
     from stg.CandidateConfig
    where SourceDb='RAAv2')=
   (select count(*) CCCount
      from dbo.CandidateEthLookUp
     where SourceDb='RAAv2')
	 AND
	 (select count(*) CCcount
     from stg.CandidateConfig
    where SourceDb='RAAv1')=
   (select count(*) CCCount
      from dbo.CandidateEthLookUp
     where SourceDb='RAAv1'))
--RAISERROR( 'Vacancies Eth Code not generated correctly for RAAv2 Look at Log Error Table for errors',1,1)
BEGIN

BEGIN TRANSACTION


DELETE FROM ASData_PL.Va_CandidateDetails

IF OBJECT_ID(N'tempdb..#tRAAv2Eth') IS NOT NULL
BEGIN
DROP TABLE #tRAAv2Eth
END

/* Bring the Derived Code and Actual Code for Eth */
SELECT ELookUp.FullName,EDerived.ShortCode,EDerived.NID
  INTO #tRAAv2Eth
  FROM (SELECT FullName, ROW_NUMBER() OVER (PARTITION BY SourceDb Order By CELId) RN
	      FROM dbo.CandidateEthLookUp
	     WHERE SourceDb='RAAv2') ELookUp
  JOIN (SELECT CA.NID,CC.ShortCode,CC.SourceDb
	          ,row_number() over (partition by CC.SourceDb order by Cast(replace(CC.ShortCode,'''null''',-1) as int)) rn
	      FROM (SELECT *,row_number() over (partition by sourcedb ORDER BY CAID) RN
	              FROM Stg.CopyActivity
		         WHERE SourceDb='RAAv2'
		           AND Category='Eth'
			       AND RunId=(SELECT MAX(RunId) FROM Stg.CopyActivity)) CA
	      JOIN (SELECT *,row_number() over (partition by sourcedb ORDER BY CCId) RN
	              FROM Stg.CandidateConfig
		         WHERE SourceDb='RAAv2'
		           AND Category='Ethnicity') CC
	        ON CA.RN=CC.RN
	       AND CA.RunId=CC.RunId
         )EDerived
	ON ELookUp.rn=EDerived.rn





/* Insert Candidate Ethnicity Details to Presentation Layer Table */

IF ((SELECT COUNT(*) FROM #tRAAv2Eth) > 0)
BEGIN
INSERT INTO [ASData_PL].[Va_CandidateDetails]
           (
		    [CandidateId] 
           ,[CandidateEthnicCode] 
           ,[CandidateEthnicDesc] 
           ,[SourceDb] 
		   )
SELECT VC.CandidateId
      ,ETH.ShortCode
	  ,ETH.FullName
	  ,'FAA'
  FROM Stg.FAA_CandidateDetails FCD
  JOIN ASData_PL.Va_Candidate VC
    ON VC.CandidateGuid=FCD.CandidateId
   AND VC.SourceDb='RAAv2'
  LEFT
  JOIN #tRAAv2Eth Eth
    ON FCD.EID=Eth.NID
END
ELSE RAISERROR( 'Ethnicity Lookup for RAAv2 is empty',1,1)


/* RAAv1(AVMS) Candidate Eth Details */

IF OBJECT_ID(N'tempdb..#tRAAv1Eth') IS NOT NULL
BEGIN
DROP TABLE #tRAAv1Eth
END

/* Bring the Derived Code and Actual Code for Eth */
SELECT ELookUp.FullName,EDerived.ShortCode,EDerived.NID
  INTO #tRAAv1Eth
  FROM (SELECT FullName, ROW_NUMBER() OVER (PARTITION BY SourceDb Order By CELId) RN
	      FROM dbo.CandidateEthLookUp
	     WHERE SourceDb='RAAv1') ELookUp
  JOIN (SELECT CA.NID,CC.ShortCode,CC.SourceDb
	          ,row_number() over (partition by CC.SourceDb order by Cast(replace(CC.ShortCode,'''null''',-1) as int)) rn
	      FROM (SELECT *,row_number() over (partition by sourcedb ORDER BY CAID) RN
	              FROM Stg.CopyActivity
		         WHERE SourceDb='RAAv1'
		           AND Category='Eth'
			       AND RunId=(SELECT MAX(RunId) FROM Stg.CopyActivity)) CA
	      JOIN (SELECT *,row_number() over (partition by sourcedb ORDER BY CCId) RN
	              FROM Stg.CandidateConfig
		         WHERE SourceDb='RAAv1'
		           AND Category='Ethnicity') CC
	        ON CA.RN=CC.RN
	       AND CA.RunId=CC.RunId
         )EDerived
	ON ELookUp.rn=EDerived.rn

/* Insert Candidate Ethnicity Details for RAAv1(AVMS) from FAA and RAAv1(AVMS) to Presentation Layer Table */

IF ((SELECT COUNT(*) FROM #tRAAv1Eth) > 0)
BEGIN
INSERT INTO [ASData_PL].[Va_CandidateDetails]
           (
		    [CandidateId] 
           ,[CandidateEthnicCode] 
           ,[CandidateEthnicDesc] 
           ,[SourceDb] 
		   )
SELECT VC.CandidateId
      ,ETH.ShortCode
	  ,ETH.FullName
	  ,'RAAv1'
  FROM Stg.Avms_CandidateDetails ACD
  JOIN ASData_PL.Va_Candidate VC
    ON VC.SourceCandidateId_v1=ACD.CandidateId
   AND VC.SourceDb='RAAv1'
  LEFT
  JOIN #tRAAv1Eth Eth
    ON ACD.EID=Eth.NID
 UNION
SELECT VC.CandidateId
      ,ETH.ShortCode
	  ,ETH.FullName
	  ,'FAA'
  FROM Stg.FAA_CandidateDetails FCD
  JOIN ASData_PL.Va_Candidate VC
    ON VC.SourceCandidateId_v1=FCD.LegacyCandidateId
   AND VC.SourceDb='RAAv1'
  LEFT
  JOIN #tRAAv2Eth Eth
    ON FCD.EID=Eth.NID
END
ELSE RAISERROR( 'Ethnicity Lookup for RAAv1 is empty',1,1)
   

     
COMMIT TRANSACTION

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId


END
ELSE
BEGIN
  DECLARE @RangeErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    99999,
	    ERROR_STATE(),
	    9,
	    ERROR_LINE(),
	    'ImportVacanciesCandidateToPL' AS ErrorProcedure,
	    'Inconsistency Found between Candidate Config and Ethnicity LookUp, Correct Stg.CandidateConfig Or Stg.CandidateEthLookUp For Consistency',
	    GETDATE(),
		@RunId as RunId; 

  SELECT @RangeErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@RangeErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

END





 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesCandidateToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_CandidateDetails]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[CELId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[CAId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[Category]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[CCId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[Category]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[NID]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[SourceDb]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CopyActivity].[NID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_CandidateDetails].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_CandidateDetails].[CandidateEthnicCode]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_CandidateDetails].[CandidateEthnicDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_CandidateDetails].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[FAA_CandidateDetails]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateGuid]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[FAA_CandidateDetails].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[FAA_CandidateDetails].[EID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth].[NID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[Avms_CandidateDetails]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceCandidateId_v1]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[Avms_CandidateDetails].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[Avms_CandidateDetails].[EID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth].[NID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceCandidateId_v1]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[FAA_CandidateDetails].[LegacyCandidateId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth].[FullName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[CandidateEthLookUp].[FullName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth].[ShortCode]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[ShortCode]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv2Eth].[NID]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CopyActivity].[NID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth].[FullName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[CandidateEthLookUp].[FullName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth].[ShortCode]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CandidateConfig].[ShortCode]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[#tRAAv1Eth].[NID]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[Stg].[CopyActivity].[NID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesCandidateDetailsToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="7942" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesCandidateDetailsToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesCandidateToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Candidate Data from v1 and v2
--              Fields that are in v1 but not in v2 or viceversa are replaced with Defaults/Dummy Values
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesCandidateToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesCandidateToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_Candidate

INSERT INTO [ASData_PL].[Va_Candidate]
           ([CandidateStatusTypeId]
           ,[CandidateStatusTypeDesc]
           --,[CountyId]
           --,[CountyName]
           --,[PostCode]
           --,[LocalAuthorityId]
           --,[LocalAuthorityName]
           --,[UniqueLearnerNumber]
           --,[Gender]
           ,[ApplicationLimitEnforced_v1]
           ,[LastAccessedDate_v1]
           ,[LastAccessedManageApplications_v1]
           ,[BeingSupportedBy_v1]
           ,[LockedForSupportUntil_v1]
           ,[AllowMarketingMessages_v1]
           ,[CandidateGuid]
         --  ,[Age]
           ,[SourceDb]
           ,[SourceCandidateId_v1])
SELECT CandidateStatusTypeId
      ,CASE WHEN CandidateStatusTypeId=1 THEN 'Pre-Registered'
            WHEN CandidateStatusTypeId=2 THEN 'Activated'
			WHEN CandidateStatusTypeId=3 THEN 'Registered'
            WHEN CandidateStatusTypeId=4 THEN 'Suspended'
            WHEN CandidateStatusTypeId=5 THEN 'Pending Delete'
            WHEN CandidateStatusTypeId=6 THEN 'Deleted'
			ELSE 'Unknown'
		END
	   ,ApplicationLimitEnforced
	   ,LastAccessedDate
	   ,LastAccessedManageApplications
	   ,BeingSupportedBy
	   ,LockedForSupportUntil
	   ,AllowMarketingMessages
	   ,Cast(CandidateGuid as Varchar(256))
	   ,'RAAv1'
	   ,CandidateId
  FROM Stg.Avms_Candidate C
 union
SELECT DISTINCT 
       -1
      ,'N/A'as CandidateStatusDesc
	  ,NULL as ApplicationLimitEnforced
	  ,'' as LastAccessedDate
	  ,'' as LastAccessedManageApplications
	  ,'N/A' as BeingSupportedBy
	  ,'' as LockedForSupportUntil
	  ,NULL as AllowMarketingMessages
	  ,CAST(CandidateId as Varchar(256))
	  ,'RAAv2'
	  ,''
   FROM Stg.RAA_ApplicationReviews AR


   

     
COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesCandidateToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesCandidateToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateStatusTypeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateStatusTypeDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[ApplicationLimitEnforced_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[LastAccessedDate_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[LastAccessedManageApplications_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[BeingSupportedBy_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[LockedForSupportUntil_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[AllowMarketingMessages_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[CandidateGuid]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Candidate].[SourceCandidateId_v1]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ApplicationReviews].[CandidateId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesCandidateToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3812" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesCandidateToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesEmployerToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Employer Data from v1 and v2
--              Fields that are in v1 but not in v2 or viceversa are replaced with Defaults/Dummy Values
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesEmployerToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesEmployerToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_Employer

INSERT INTO [ASData_PL].[Va_Employer]
           ([FullName]
           ,[TradingName]
           ,[SourceEmployerId_v1]
           ,[DasAccountId_v2]
           ,[LocalAuthorityId]
           ,[OwnerOrgnistaion_v1]
           ,[EdsUrn_v1]
           ,[EmployerStatusTypeId_v1]
           ,[EmployerStatusTypeDesc_v1]
           ,[SourceDb])
 SELECT     E.FullName               as EmployerFullName
           ,E.TradingName            as TradingName
           ,EmployerId               as SourceEmployerId_v1
	       ,'N/A'                    as DasAccountId_v2
		   ,-1                       as LocalAuthorityId
		   ,OwnerOrgnistaion         as OwnerOrganisation
		   ,-1                       as EdsUrn_v1
		   ,EmployerStatusTypeId     as EmployerStatusTypeId_v1
		   ,ETPS.FullName            as EmployerStatusTypeDesc_v1
		   ,'RAAv1'                  as SourceDb
	   FROM Stg.Avms_Employer E
	   LEFT
	   JOIN Stg.Avms_EmployerTrainingProviderStatus ETPS
	     ON E.EmployerStatusTypeId=ETPS.EmployerTrainingProviderStatusId
	  UNION
	 SELECT DISTINCT
	        EmployerName             as EmployerFullName
	       ,EmployerName             as TradingName
		   ,-1                       as SourceEmployerId_v1
		   ,EmployerAccountId        as DasAccountId_v2
		   ,-1                       as LocalAuthorityId
		   ,'N/A'                    as OwnerOrganisation
		   ,-1                       as EdsUrn_v1
		   ,-1                       as EmployerStatusTypeId_v1
		   ,'N/A'                    as EmployerStatusTypeDesc_v1
		   ,'RAAv2'                  as SourceDb
	   FROM (SELECT DISTINCT EmployerAccountId,EmployerName,row_number() over (Partition by EmployerAccountId order by EmployerName Desc) rn
	           from Stg.RAA_Vacancies) v
	  where rn=1






COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesEmployerToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesEmployerToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[TradingName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[SourceEmployerId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[DasAccountId_v2]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[LocalAuthorityId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[OwnerOrgnistaion_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[EdsUrn_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[EmployerStatusTypeId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[EmployerStatusTypeDesc_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[SourceDb]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesEmployerToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3861" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesEmployerToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesLegalEntityToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Legal Entity Data from v1 and v2
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesLegalEntityToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesLegalEntityToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_LegalEntity

INSERT INTO [ASData_PL].[Va_LegalEntity]
           ([LegalEntityPublicHashedId]
           ,[EmployerId]
           ,[EmployerAccountId]
           ,[LegalEntityName]
           ,[SourceLegalEntityId]
           ,[SourceDb])
     SELECT AccountLegalEntityPublicHashedId as LegalEntityPublicHashedId
		   ,E.EmployerId                     as EmployerId
		   ,EmployerAccountId                as EmployerAccountId
		   ,LegalEntityName                  as LegalEntityName
		   ,LegalEntityId                    as SourceLegalEntityId
		   ,'RAAv2'                          as SourceDb
	   FROM (SELECT DISTINCT LegalEntityId
	                        ,AccountLegalEntityPublicHashedId
							,EmployerAccountId
							,LegalEntityName
			                ,ROW_NUMBER() OVER (PARTITION BY EmployerAccountId,LegalEntityId
							                        ORDER BY LegalEntityName Desc) rn
			   FROM Stg.RAA_Vacancies) v
	   LEFT
	   JOIN ASData_PL.Va_Employer E
	     ON E.DasAccountId_v2=V.EmployerAccountId
		AND E.SourceDb='RAAv2'
	  WHERE V.rn=1






COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesLegalEntityToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesLegalEntityToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[LegalEntityPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[EmployerId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[SourceLegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[AccountLegalEntityPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[DasAccountId_v2]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[AccountLegalEntityPublicHashedId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[EmployerId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesLegalEntityToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3037" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesLegalEntityToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesProviderToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===============================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Provider Data from v1 and v2
--              Fields that are in v1 but not in v2 or viceversa are replaced with Defaults/Dummy Values
-- ===============================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesProviderToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesProviderToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_Provider

INSERT INTO [ASData_PL].[Va_Provider]
           ([UPIN_v1]
           ,[SourceProviderID_v1]
           ,[UKPRN]
           ,[FullName]
           ,[TradingName]
           ,[IsContracted_v1]
           ,[ContractedFrom_v1]
           ,[ContractedTo_v1]
           ,[ProviderStatusTypeID]
           ,[ProviderStatusTypeDesc]
           ,[IsNASProvider_v1]
           ,[ProviderToUseFAA_v1]
           ,[SourceDb])
 SELECT -1                              as Upin
       ,ProviderID                      as SourceProviderId
	   ,UKPRN                           as Ukprn  
	   ,P.FullName                      as FullName
	   ,TradingName                     as TradingName
	   ,IsContracted                    as IsContracted
	   ,ISNULL(ContractedFrom,'1900-01-01 00:00:00.000') as ContractedFrom
	   ,ISNULL(ContractedTo,'1900-01-01 00:00:00.000')   as ContractedTo
	   ,ProviderStatusTypeID            as ProviderStatusTypeID
	   ,ETPS.FullName                   as ProviderStatusDesc
	   ,IsNASProvider                   as IsNASProvider 
	   ,ProviderToUseFAA                as ProviderToUseFAA
	   ,'RAAv1'                         as SourceDb
   FROM Stg.Avms_Provider P
   LEFT
   JOIN Stg.Avms_EmployerTrainingProviderStatus ETPS
     ON P.ProviderStatusTypeID=ETPS.EmployerTrainingProviderStatusId
  UNION
 SELECT DISTINCT
        -1                              as UPIN
       ,-1                              as SourceProviderId
	   ,TrainingProviderUkprn           as Ukprn
	   ,TrainingProviderName            as FullName
	   ,TrainingProviderName            as TradingName
	   ,NULL                            as IsContracted
	   ,''                              as ContractedFrom
	   ,''                              as ContractedTo
	   ,-1                              as ProviderStatusTypeID      
	   ,'N/A'                           as ProviderStatusDesc
	   ,NULL                            as IsNASProvider
	   ,-1                              as ProviderToUseFAA
	   ,'RAAv2'                         as SourceDb
   FROM  (SELECT DISTINCT TrainingProviderUkprn
                         ,TrainingProviderName
						 ,Row_Number() Over (Partition by TrainingProviderUkprn 
						                         order by TrainingProviderName Desc) rn
		    FROM Stg.RAA_Vacancies) sv
  WHERE rn=1
    AND NOT EXISTS (SELECT 1 FROM Stg.Avms_Provider P
	                 WHERE P.Ukprn=SV.TrainingProviderUkprn)






COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesProviderToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesProviderToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[UPIN_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[SourceProviderID_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[UKPRN]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[TradingName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[IsContracted_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ContractedFrom_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ContractedTo_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderStatusTypeID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderStatusTypeDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[IsNASProvider_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderToUseFAA_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[SourceDb]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderUkprn]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderUkprn]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderUkprn]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesProviderToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="4529" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesProviderToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[ImportVacanciesToPL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ==========================================================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 02/07/2020
-- Description: Import Vacancies Data from v1 and v2
--              Fields that are in v1 but not in v2 or viceversa are replaced with Defaults/Dummy Values
-- ==========================================================================================================

BEGIN TRY

DECLARE @LogID int
DEClARE @quote varchar(5) = ''''

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,'ImportVacanciesToPL'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='ImportVacanciesToPL'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM ASData_PL.Va_Application  -- Delete Application First to be able to resolve Foreign key conflicts */

DELETE FROM ASData_PL.Va_Vacancy

/* Load RAAv1 */

INSERT INTO [ASData_PL].[Va_Vacancy]
           ([VacancyGuid]
           ,[VacancyReferenceNumber]
           ,[VacancyStatus]
           ,[VacancyTitle]
           --,[VacancyLocalAuthorityId]
           --,[VacancyLocalAuthorityName]
           --,[VacancyPostcode]
           --,[VacancyCountyId]
           --,[VacancyCounty]
           ,[EmployerId]
           ,[EmployerFullName]
           --,[LegalEntitiyId]
           --,[LegalEntityName]
           ,[ProviderId]
           ,[ProviderUkprn]
           ,[ProviderFullName]
           ,[ProviderTradingName]
         --  ,[VacancyOwner_v2]
           ,[ApprenticeshipType]
           ,[VacancyShortDescription]
           ,[VacancyDescription]
           --,[VacancyLocationTypeId_v1]
           --,[VacancyLocationType_v1]
           ,[NumberOfPositions]
           ,[SectorName]
           ,[FrameworkOrStandardID]
           ,[FrameworkOrStandardLarsCode]
           ,[FrameworkOrStandardName]
           ,[EducationLevel]
           ,[WeeklyWage_v1]
           ,[WageLowerBound_v1]
           ,[WageUpperBound_v1]
           ,[WageType]
           ,[WageText]
           ,[WageUnitId_v1]
           ,[WageUnitDesc]
           ,[WorkingWeek]
           ,[HoursPerWeek]
           ,[DurationTypeId]
           ,[DurationTypeDesc]
           ,[ApplicationClosingDate]
           ,[InterviewsFromDate_v1]
           ,[ExpectedStartDate]
           ,[ExpectedDuration]
           ,[NumberOfViews_v1]
           ,[MaxNumberOfApplications_v1]
           ,[ApplyOutsideNAVMS_v1]
           ,[NoOfOfflineApplicants_v1]
           ,[MasterVacancyId_v1]
           ,[NoOfOfflineSystemApplicants_v1]
           ,[SmallEmployerWageIncentive_v1]
           ,[SubmissionCount_v1]
           ,[StartedToQADateTime_v1]
           ,[TrainingTypeId]
           ,[TrainingTypeFullName]
           ,[VacancyTypeId]
           ,[VacancyTypeDesc]
           ,[UpdatedDateTime]
           ,[EditedInRaa_v1]
           ,[VacancySourceId_v1]
           ,[VacancySource]
           ,[OfflineVacancyTypeId_v1]
           ,[CreatedDate]
           ,[SourceVacancyId]
           ,[SourceDb])
     SELECT v.VacancyGuid                                     as VacancyGuid
           ,v.[VacancyReferenceNumber]                        as VacancyReferenceNumber
           ,vs.FullName                                       as VacancyStatus
	       ,v.[Title]                                         as VacancyTitle
	       ,E.EmployerId                                      as EmployerId
           ,E.FullName                                        as EmployerFullNAME
           ,P.ProviderID                                      as ProviderId
           ,p.UKPRN                                           as ProviderUKPrn
           ,P.FullName                                        as ProviderFullName
           ,P.TradingName                                     as ProviderTradingName
	 --  , psrt.ProviderSiteRelationshipTypeName as ProviderSiteRelationshipType
	       ,AT.FullName                                       as ApprenticeshipType
           ,v.[ShortDescription]                              as VacancyShortDescription
           ,v.[Description]                                   as VacancyDescription
           ,v.[NumberofPositions]                             as NumberOfPositions
	       ,CASE WHEN V.ApprenticeshipFrameworkId is not null 
                 then AF.ApprenticehipOccupationFullName
                 WHEN V.StandardId is not null then Std.StandardSectorName 
                 ELSE 'Unknown' 
             END                                              as [Framework/Standard Sector] 
           ,CASE WHEN V.ApprenticeshipFrameworkId is not null 
                 then AF.ApprenticeshipFrameworkId
                 WHEN V.StandardId is not null then Std.StandardId 
                 ELSE -1 
             END                                              as [Framework/StandardId] 
           ,CASE WHEN AF.FrameworkCodeName IS NOT NULL THEN AF.FrameworkCodeName
                 WHEN Std.LarsCode IS NOT NULL THEN CAST(Std.LarsCode AS Varchar)
		         ELSE ''
		     END                                              as LarsCode
            ,CASE WHEN V.ApprenticeshipFrameworkId is not null 
                  then Af.FrameWorkFullName 
                  WHEN V.StandardId is not null then Std.StandardFullName 
                  ELSE '' 
              END                                             as [Framework/Standard Name] 
            ,Std.EducationLevelFullName                       as EducationLevel
            ,v.[WeeklyWage]                                   as WeeklyWage
            ,v.[WageLowerBound]                               as WageLowerBound
            ,v.[WageUpperBound]                               as WageUpperBound
            ,WT.FullName                                      AS WageType 
	        ,v.WageText                                       as WageText
	        ,v.WageUnitId                                     as WageUnitId
	        ,WU.FullName                                      as WageUnit
	        ,v.[WorkingWeek]                                  as WorkingWeek
	        ,v.[HoursPerWeek]                                 as HoursPerWeek
	        ,v.DurationTypeId                                 as DurationTypeId
	        ,v.DurationValue                                  as DurationValue
            ,v.[ApplicationClosingDate]                       as ApplicationClosingDate
            ,v.[InterviewsFromDate]                           as InterviewFromDate
            ,v.[ExpectedStartDate]                            as ExpectedStartDate
            ,v.[ExpectedDuration]                             as ExpectedDuration
            ,v.[NumberOfViews]                                as NumberOfViews
	        ,v.MaxNumberofApplications                        as MaxNumberOfApplications
	        ,v.ApplyOutsideNAVMS                              as ApplyOutsideNAVMS
	        ,v.[NoOfOfflineApplicants]                        AS NoOfOfflineApplicants
	        ,v.MasterVacancyId                                as MasterVacancyId
	        ,v.NoOfOfflineSystemApplicants                    as NoOfOfflineSystemApplicants
	        ,v.SmallEmployerWageIncentive                     as SmallEmployerWageIncentive
	        ,v.SubmissionCount                                as SubmissionCount
	        ,v.StartedToQADateTime                            as StartedToQADateTime
	        ,CASE WHEN V.ApprenticeshipFrameworkId is not null 
                  then 1 
                  WHEN V.StandardId is not null then 2 
                  ELSE 0
              END                                             as TrainingTypeId
	        ,CASE WHEN V.ApprenticeshipFrameworkId is not null 
                  then 'Frameworks' 
                  WHEN V.StandardId is not null then 'Standards'
                  ELSE 'Unknown' 
              END                                             as TrainingTypeDesc
	        ,v.VacancyTypeId
            ,CASE WHEN v.[VacancyTypeId]=1 THEN 'Apprenticeship'
	              WHEN V.VacancyTypeId=2 THEN 'Traineeship'
			      ELSE 'Unknown'
			  end                                             as VacancyType
	        ,v.UpdatedDateTime                                as UpdatedDateTime
	        ,v.EditedInRaa                                    as EditedInRAA
	        ,v.VacancySourceId                                as VacancySourceId
	        ,vas.FullName                                     as VacancySource
            ,v.OfflineVacancyTypeId                           as OfflineVacancyTypeId   
	        ,ISNULL(VH.HistoryDate,V.UpdatedDateTime)         as CreatedDate
			,v.VacancyId                                      as SourceVacancyId
			,'RAAv1'                                          as SourceDb
       FROM Stg.[Avms_Vacancy] V
       join Stg.Avms_VacancyStatusType vs 
	     on V.VacancyStatusId = vs.VacancyStatusTypeId
       join Stg.Avms_VacancyOwnerRelationship vor 
	     on V.VacancyOwnerRelationshipId = vor.VacancyOwnerRelationshipId
       join ASData_PL.Va_Employer E 
	     on vor.EmployerId = e.SourceEmployerId_v1
		and E.SourceDb='RAAv1'
       join (SELECT ps.providersiteid,psr.ProviderID
               from stg.Avms_ProviderSite ps 
               join (SELECT ProviderID,ProviderSiteID
                       FROM
                    (select *, Row_number() over (partition by providersiteid order by providersiterelationshiptypeid) rn 
                       from stg.Avms_ProviderSiteRelationship) PSR
                      WHERE rn=1) PSR
                 ON PSR.ProviderSiteID=PS.ProviderSiteID) Ps
          on vor.ProviderSiteID=ps.ProviderSiteID
        join ASData_PL.Va_Provider p 
		  on ps.ProviderID = p.SourceProviderID_v1
		 and p.SourceDb='RAAv1'
        LEFT 
		JOIN (SELECT AST.*,EL.EducationLevelFullName
        	    FROM ASData_PL.Va_ApprenticeshipStandard AST
			    LEFT 
			    JOIN AsData_PL.Va_EducationLevel EL
			      ON EL.EducationLevelId=AST.EducationLevelId) Std 
          ON Std.StandardId=V.StandardId 
        LEFT
		JOIN ASData_PL.Va_ApprenticeshipFrameWorkAndOccupation AF 
          ON AF.SourceApprenticeshipFrameworkId=V.ApprenticeshipFrameworkId
	     AND AF.SourceDb='RAAv1'
        left
        join (select vacancyid,min(HistoryDate) HistoryDate
                from Stg.Avms_VacancyHistory vh
		       group by vacancyid) VH
          ON VH.VacancyId=V.VacancyId
        left
        join Stg.Avms_ApprenticeshipType AT
          ON AT.ApprenticeshipTypeId=v.ApprenticeshipType
        left 
        join Stg.Avms_WageType WT
          ON WT.WageTypeId=V.WageType
        left
        join Stg.Avms_VacancySource VaS
          on VaS.VacancySourceId=V.VacancySourceId
        left
        join stg.Avms_WageUnit wu
          on v.WageUnitId=wu.WageUnitId






/* Load RAAv2 */

INSERT INTO [ASData_PL].[Va_Vacancy]
           ([VacancyGuid]
           ,[VacancyReferenceNumber]
           ,[VacancyStatus]
           ,[VacancyTitle]
           --,[VacancyLocalAuthorityId]
           --,[VacancyLocalAuthorityName]
           --,[VacancyPostcode]
           --,[VacancyCountyId]
           --,[VacancyCounty]
           ,[EmployerId]
           ,[EmployerFullName]
           ,[LegalEntitiyId]
           ,[LegalEntityName]
           ,[ProviderId]
           ,[ProviderUkprn]
           ,[ProviderFullName]
           ,[ProviderTradingName]
         --  ,[VacancyOwner_v2]
           ,[ApprenticeshipType]
           ,[VacancyShortDescription]
           ,[VacancyDescription]
           --,[VacancyLocationTypeId_v1]
           --,[VacancyLocationType_v1]
           ,[NumberOfPositions]
           ,[SectorName]
           ,[FrameworkOrStandardID]
           ,[FrameworkOrStandardLarsCode]
           ,[FrameworkOrStandardName]
           ,[EducationLevel]
           --,[WeeklyWage_v1]
           --,[WageLowerBound_v1]
           --,[WageUpperBound_v1]
           ,[WageType]
           ,[WageText]
      --     ,[WageUnitId_v1]
           ,[WageUnitDesc]
           ,[WorkingWeek]
           ,[HoursPerWeek]
       --    ,[DurationTypeId]
           ,[DurationTypeDesc]
           ,[ApplicationClosingDate]
        --   ,[InterviewsFromDate_v1]
           ,[ExpectedStartDate]
           ,[ExpectedDuration]
           --,[NumberOfViews_v1]
           --,[MaxNumberOfApplications_v1]
           --,[ApplyOutsideNAVMS_v1]
           --,[NoOfOfflineApplicants_v1]
           --,[MasterVacancyId_v1]
           --,[NoOfOfflineSystemApplicants_v1]
           --,[SmallEmployerWageIncentive_v1]
           --,[SubmissionCount_v1]
           --,[StartedToQADateTime_v1]
           ,[TrainingTypeId]
           ,[TrainingTypeFullName]
           ,[VacancyTypeId]
           ,[VacancyTypeDesc]
           ,[UpdatedDateTime]
           --,[EditedInRaa_v1]
           --,[VacancySourceId_v1]
           ,[VacancySource]
           --,[OfflineVacancyTypeId_v1]
           ,[CreatedDate]
           ,[IsDeleted_v2]
           ,[DeletedDateTime_v2]
           ,[SubmittedDateTime_v2]
           ,[SourceVacancyId]
           ,[SourceDb])
   SELECT  cast(v.BinaryId as varchar(256))                        as VacancyGuid
	      ,cast(VacancyReference as int)                           as VacancyReference
		  ,cast(VacancyStatus as varchar(100))                     as VacancyStatus
		  ,VacancyTitle                                            as VacancyTitle
		  ,E.EmployerId                                            as EmployerId
		  ,E.FullName                                              as EmployerFullName
		  ,LE.LegalEntityId                                        as LegalEntityId
		  ,LE.LegalEntityName                                      as LegalEntityName
		  ,P.ProviderID                                            as ProviderId
		  ,cast(v.TrainingProviderUkprn as int)                    as ProviderUkprn
	      ,v.TrainingProviderName                                  as ProviderName
		  ,v.TrainingProviderName                                  as ProviderTradingName
		  ,CASE WHEN EL.CodeName IN (2,3,4) then EL.FullName +' Level Apprenticeship'
		        ELSE EL.FullName
			END                                                    as ApprenticeshipType
          ,[VacancyDescription]                                    as VacancyShortDesc
          ,[VacancyDescription]                                    as VacancyDesc
		  ,cast(v.NumberOfPositions as int)                        as NumberOfPositions
	      ,CASE WHEN AP.ApprenticeshipType='Standard' THEN ST.StandardSectorName
                WHEN AP.ApprenticeshipType='Framework' then AF.ApprenticehipOccupationFullName
                ELSE 'Unknown' 
            END                                                    as [Framework/Standard Sector] 
	      ,CASE WHEN AP.ApprenticeshipType='Framework' then AF.ApprenticeshipFrameworkId
                WHEN AP.ApprenticeshipType='Standard' then ST.StandardId 
                ELSE -1 
            END                                                    as [Framework/StandardId] 
          ,V.ProgrammeId                                           as LarsCode
          , CASE WHEN ApprenticeshipType='Framework'  
                 then AF.FrameWorkFullName 
                 WHEN ApprenticeshipType='Standard' 
			     then ST.StandardFullName 
                 ELSE '' 
             END                                                   as [Framework/Standard Name] 
          ,EL.FullName                                             as EducationLevel
		  ,v.[WageType]                                            as WageType
          ,v.WageAdditionalInformation                             as WageText
          -- ,[WageUnitId]
          ,v.WageDurationUnit                                      as WageUnitDesc
          ,v.WorkingWeekDescription                                as WorkingWeek
          ,cast(v.WeeklyHours as decimal(10,2))                    as HoursPerWeek
         --  ,[DurationTypeId]
          ,cast(v.WageDuration as int)                             as DurationTypeDesc
	      ,dbo.Fn_ConvertTimeStampToDateTime(v.ClosingDateTimeStamp) as ClosingDateTime
         --  ,[InterviewsFromDate]
          ,dbo.Fn_ConvertTimeStampToDateTime(v.StartDateTimeStamp) as ExpectedStartDate
          ,v.WageDuration                                          as ExpectedDuration
		  ,CASE WHEN AP.ApprenticeshipType='Frameworks' THEN 1
                WHEN AP.ApprenticeshipType='Standards' THEN 2
                ELSE 0
              END                                                  as TrainingTypeId
	      ,ISNULL(AP.ApprenticeshipType,'Unknown')                 as TrainingTypeFullName
	      ,CASE WHEN AP.EducationLevelNumber=8 THEN 2
	            WHEN AP.EducationLevelNumber IN (2,3,4,6) THEN 1
			    ELSE 0
			END                                                    as VacancyTypeId
	      ,CASE WHEN AP.EducationLevelNumber=8 THEN 'Traineeship'
	            WHEN AP.EducationLevelNumber IN (2,3,4,6) THEN 'Apprenticeship'
			    ELSE 'Unknown'
			END                                                    as VacancyTypeDesc
          ,dbo.Fn_ConvertTimeStampToDateTime(v.LastUpdatedTimeStamp) as UpdateDateTime
          ,v.SourceOrigin                                            as VacancySource
          ,dbo.Fn_ConvertTimeStampToDateTime(v.CreatedDateTimeStamp) as CreatedDateTime
		  ,v.IsDeleted                                               as IsDeleted
		  ,dbo.Fn_ConvertTimeStampToDateTime(v.DeletedDateTimeStamp) as DeletedDateTime
		  ,dbo.Fn_ConvertTimeStampToDateTime(v.SubmittedDateTimeStamp) as SubmittedDateTime
		  ,v.SourseSK                                                as SourceVacancyId
		  ,'RAAv2'                                                   as SourceDb
	  FROM Stg.RAA_Vacancies V
	  LEFT
	  JOIN ASData_PL.Va_Employer E
	    ON E.DasAccountId_v2=V.EmployerAccountId
	   and E.SourceDb='RAAv2'
	  LEFT
	  JOIN ASData_PL.Va_LegalEntity LE
	    ON LE.SourceLegalEntityId=V.LegalEntityId
	   AND LE.EmployerAccountId=v.EmployerAccountId
	   AND LE.SourceDb='RAAv2'
	  LEFT
	  JOIN (SELECT providerid ,UKPRN
              FROM 
           (SELECT providerid,Ukprn,row_number() over (partition by ukprn order by providerstatustypeid asc) rn -- ToSelectOnlyActivatedProviders
	          FROM ASData_PL.Va_Provider) Provider
             WHERE rn=1) P
	    ON P.UKPRN=V.TrainingProviderUkprn
	 --  AND P.SourceDb='RAAv2'
	  LEFT
	  JOIN Stg.RAA_ReferenceDataApprenticeshipProgrammes ap
	    on V.ProgrammeId=ap.ProgrammeId
	  LEFT 
	  JOIN Stg.Avms_EducationLevel EL
        ON EL.CodeName=ap.EducationLevelNumber
	  LEFT
      JOIN (SELECT AST.*,EL.FullName AS EducationLevel
        	  FROM ASData_PL.Va_ApprenticeshipStandard AST
			  LEFT 
			  JOIN Stg.Avms_EducationLevel EL
			    ON EL.EducationLevelId=AST.EducationLevelId
				) ST
	    on cast(ST.LarsCode as Varchar)=V.ProgrammeId 
      LEFT 
	  JOIN ASData_PL.Va_ApprenticeshipFrameWorkAndOccupation AF
        ON AF.ProgrammeId_v2=V.ProgrammeId
	   AND AF.SourceDb='RAAv2'





COMMIT TRANSACTION



UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'ImportVacanciesToPL',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ImportVacanciesToPL].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Application]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyGuid]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyReferenceNumber]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyStatus]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyTitle]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[EmployerId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[EmployerFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ProviderId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ProviderUkprn]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ProviderFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ProviderTradingName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ApprenticeshipType]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyShortDescription]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyDescription]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[NumberOfPositions]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SectorName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[FrameworkOrStandardID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[FrameworkOrStandardLarsCode]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[FrameworkOrStandardName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[EducationLevel]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WeeklyWage_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WageLowerBound_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WageUpperBound_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WageType]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WageText]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WageUnitId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WageUnitDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[WorkingWeek]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[HoursPerWeek]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[DurationTypeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[DurationTypeDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ApplicationClosingDate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[InterviewsFromDate_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ExpectedStartDate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ExpectedDuration]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[NumberOfViews_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[MaxNumberOfApplications_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[ApplyOutsideNAVMS_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[NoOfOfflineApplicants_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[MasterVacancyId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[NoOfOfflineSystemApplicants_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SmallEmployerWageIncentive_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SubmissionCount_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[StartedToQADateTime_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[TrainingTypeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[TrainingTypeFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyTypeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancyTypeDesc]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[UpdatedDateTime]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[EditedInRaa_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancySourceId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[VacancySource]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[OfflineVacancyTypeId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[CreatedDate]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SourceVacancyId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SourceDb]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Employer]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[SourceEmployerId_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[SourceDb]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Provider]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[SourceProviderID_v1]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[EducationLevelId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceApprenticeshipFrameworkId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceDb]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[EmployerId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[UKPRN]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[TradingName]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticehipOccupationFullName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardSectorName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipFrameworkId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameworkCodeName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[LarsCode]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameWorkFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_EducationLevel].[EducationLevelFullName]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[LegalEntitiyId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[IsDeleted_v2]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[DeletedDateTime_v2]" />
				</Entry>
				<Entry>
					<References Name="[AsData_Pl].[Va_Vacancy].[SubmittedDateTime_v2]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[DasAccountId_v2]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[SourceLegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[EmployerAccountId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[UKPRN]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderStatusTypeID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[UKPRN]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[UKPRN]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderUkprn]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[ProgrammeId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ProgrammeId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[EducationLevelNumber]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[EducationLevelId]" />
				</Entry>
				<Entry />
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[LarsCode]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[ProgrammeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ProgrammeId_v2]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[ProgrammeId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[SourceDb]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[BinaryId]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[VacancyReference]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[VacancyStatus]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[VacancyTitle]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[EmployerId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Employer].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[LegalEntityId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_LegalEntity].[LegalEntityName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_Provider].[ProviderID]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderUkprn]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderName]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[TrainingProviderName]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[VacancyDescription]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[VacancyDescription]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[NumberOfPositions]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ApprenticeshipType]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardSectorName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticehipOccupationFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[ApprenticeshipFrameworkId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[ProgrammeId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ApprenticeshipType]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipFrameWorkAndOccupation].[FrameWorkFullName]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[Va_ApprenticeshipStandard].[StandardFullName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WageType]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WageAdditionalInformation]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WageDurationUnit]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WorkingWeekDescription]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WeeklyHours]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WageDuration]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[ClosingDateTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[StartDateTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[WageDuration]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[EducationLevelNumber]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[LastUpdatedTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[SourceOrigin]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[CreatedDateTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[IsDeleted]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[DeletedDateTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[SubmittedDateTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Fn_ConvertTimeStampToDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[RAA_Vacancies].[SourseSK]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[ImportVacanciesToPL].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="20733" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[ImportVacanciesToPL]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[InsertLogErrorDetails]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 01/04/2020
-- Description: Stored Procedure to Log Error
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

 DECLARE @ErrorId int

 SELECT @LogID = MAX(LogID)
   FROM Mgmt.Log_Execution_Results
  WHERE ADFTaskType=@TaskType

  INSERT INTO Mgmt.Log_Error_Details
	  (
	   ErrorProcedure
	  ,ErrorADFTaskType
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        
	    'DataFactory',
		@TaskType,
	    @ErrorMessage,
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

   END TRY
BEGIN CATCH

SELECT  SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    ERROR_MESSAGE()
END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ADFTaskType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[InsertLogErrorDetails].[@TaskType]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorADFTaskType]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[InsertLogErrorDetails].[@ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[InsertLogErrorDetails].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[InsertLogErrorDetails].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[InsertLogErrorDetails].[@TaskType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[InsertLogErrorDetails].[@ErrorMessage]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1249" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[InsertLogErrorDetails]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;  ,@TaskType varchar(256)&#xD;&#xA;  ,@ErrorMessage varchar(256)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[LoadCandidateConfig]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- =======================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 27/07/2020
-- Description: Load Candidate Config for Import
-- =======================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-3'
	   ,'LoadCandidateConfig'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='LoadCandidateConfig'
     AND RunId=@RunID


IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION
DELETE FROM Stg.CandidateConfig


/* RAAv2 */

INSERT INTO Stg.CandidateConfig
(SourceDb,Category,ShortCode)
VALUES
('RAAv1','Ethnicity',0),
('RAAv1','Ethnicity',1),
('RAAv1','Ethnicity',2),
('RAAv1','Ethnicity',3),
('RAAv1','Ethnicity',4),
('RAAv1','Ethnicity',5),
('RAAv1','Ethnicity',6),
('RAAv1','Ethnicity',7),
('RAAv1','Ethnicity',8),
('RAAv1','Ethnicity',9),
('RAAv1','Ethnicity',10),
('RAAv1','Ethnicity',11),
('RAAv1','Ethnicity',12),
('RAAv1','Ethnicity',13),
('RAAv1','Ethnicity',14),
('RAAv1','Ethnicity',15),
('RAAv1','Ethnicity',16),
('RAAv1','Ethnicity',17),
('RAAv1','Ethnicity',18),
('RAAv1','Ethnicity',19),
('RAAv1','Ethnicity',20),
('RAAv1','Ethnicity',21),
/*RAAv2*/
('RAAv2','Ethnicity',31),
('RAAv2','Ethnicity',32),
('RAAv2','Ethnicity',33),
('RAAv2','Ethnicity',34),
('RAAv2','Ethnicity',35),
('RAAv2','Ethnicity',36),
('RAAv2','Ethnicity',37),
('RAAv2','Ethnicity',38),
('RAAv2','Ethnicity',39),
('RAAv2','Ethnicity',40),
('RAAv2','Ethnicity',41),
('RAAv2','Ethnicity',42),
('RAAv2','Ethnicity',43),
('RAAv2','Ethnicity',44),
('RAAv2','Ethnicity',45),
('RAAv2','Ethnicity',46),
('RAAv2','Ethnicity',47),
('RAAv2','Ethnicity',98),
('RAAv2','Ethnicity',99),
('RAAv2','Ethnicity',0)


INSERT INTO Stg.CandidateConfig
(SourceDb,Category,ShortCode)
VALUES
('RAAv2','Ethnicity','''null''')






COMMIT TRANSACTION
END

/* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'LoadCandidateConfig',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[LoadCandidateConfig].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[Category]" />
				</Entry>
				<Entry>
					<References Name="[Stg].[CandidateConfig].[ShortCode]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[LoadCandidateConfig].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3282" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[LoadCandidateConfig]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[LoadCandidateEthLookUp]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- =======================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 27/07/2020
-- Description: Load Candidate Ethnicity Reference Data
-- =======================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-3'
	   ,'LoadCandidateEthLookUp'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='LoadCandidateEthLookUp'
     AND RunId=@RunID


IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION
DELETE FROM dbo.CandidateEthLookUp


/* RAAv2 */

INSERT INTO dbo.CandidateEthLookUp
(FullName,SourceDb)
VALUES
 ('Unknown','RAAv2')
,('Unknown','RAAv2')
,( 'English / Welsh / Scottish / Northern Irish / British','RAAv2')
,('Irish','RAAv2')
,('Gypsy or Irish Traveller','RAAv2')
,('Any Other White background','RAAv2')
,('White and Black Caribbean','RAAv2')
,('White and Black African','RAAv2')
,('White and Asian','RAAv2')
,('Any Other Mixed / multiple ethnic background','RAAv2')
,('Indian','RAAv2')
,('Pakistani','RAAv2')
,('Bangladeshi','RAAv2')
,('Chinese','RAAv2')
,('Any other Asian background','RAAv2')
,('African','RAAv2')
,('Caribbean','RAAv2')
,('Any other Black / African / Caribbean background','RAAv2')
,('Arab','RAAv2')
,('Any other ethnic group','RAAv2')
,('Not provided','RAAv2')

/* RAAv1 */

INSERT INTO dbo.CandidateEthLookUp
(ShortName,FullName,SourceDb)
VALUES
 ('Please Select','Select a group first','RAAv1')
,('Asian or Asian British','Please Select','RAAv1')
,('Asian or Asian British','Bangladeshi','RAAv1')
,('Asian or Asian British','Indian','RAAv1')
,('Asian or Asian British','Pakistani','RAAv1')
,('Asian or Asian British','Other Asian Background','RAAv1')
,('Black or black British','Please Select','RAAv1')
,('Black or black British','African','RAAv1')
,('Black or black British','Caribbean','RAAv1')
,('Black or black British','Other black background','RAAv1')
,('Mixed','Please Select','RAAv1')
,('Mixed','White Asian','RAAv1')
,('Mixed','White and black African','RAAv1')
,('Mixed','White and black Caribbean','RAAv1')
,('Mixed','Other mixed background','RAAv1')
,('White','Please Select','RAAv1')
,('White','British','RAAv1')
,('White','Irish','RAAv1')
,('White','Other white background','RAAv1')
,('Chinese','Chinese','RAAv1')
,('Other (please specify)','Not applicable','RAAv1')
,('Don''t know or don''t want to say','Not applicable','RAAv1')



COMMIT TRANSACTION
END

/* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'LoadCandidateEthLookUp',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[LoadCandidateEthLookUp].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[SourceDb]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[CandidateEthLookUp].[ShortName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[LoadCandidateEthLookUp].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3868" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[LoadCandidateEthLookUp]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[LoadReferenceData]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 24/09/2019
-- Description: Load Reference Data from Discrete Dbs
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-3'
	   ,'LoadReferenceData'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='LoadReferenceData'
     AND RunId=@RunID


IF @@TRANCOUNT=0
BEGIN
BEGIN TRANSACTION
DELETE FROM dbo.ReferenceData

INSERT INTO dbo.ReferenceData
(Category,FieldName,FieldValue,FieldDesc)
VALUES
--TransactionType
('Payments','TransactionType',1,'Learning'),
('Payments','TransactionType',2,'Completion'),
('Payments','TransactionType',3,'Balancing'),
('Payments','TransactionType',4,'First16To18EmployerIncentive'),
('Payments','TransactionType',5,'First16To18ProviderIncentive'),
('Payments','TransactionType',6,'Second16To18EmployerIncentive'),
('Payments','TransactionType',7,'Second16To18ProviderIncentive'),
('Payments','TransactionType',8,'OnProgramme16To18FrameworkUplift'),
('Payments','TransactionType',9,'Completion16To18FrameworkUplift'),
('Payments','TransactionType',10,'Balancing16To18FrameworkUplift'),
('Payments','TransactionType',11,'FirstDisadvantagePayment'),
('Payments','TransactionType',12,'SecondDisadvantagePayment'),
('Payments','TransactionType',13,'OnProgrammeMathsAndEnglish'),
('Payments','TransactionType',14,'BalancingMathsAndEnglish'),
('Payments','TransactionType',15,'LearningSupport'),
('Payments','TransactionType',16,'CareLeaverApprenticePayment'),
--FundingSource
('Payments','FundingSource',1,'Levy'),
('Payments','FundingSource',2,'CoInvestedSfa'),
('Payments','FundingSource',3,'CoInvestedEmployer'),
('Payments','FundingSource',4,'FullyFundedSfa'),
('Payments','FundingSource',5,'LevyTransfer'),
-- Contract Type
('Payments','ContractType',0,'Unknown'),
('Payments','ContractType',1,'ContractWithEmployer'),
('Payments','ContractType',2,'ContractWithSfa'),
--Approvals
('Commitments','Approvals',0,'NotAgreed'),
('Commitments','Approvals',1,'EmployerAgreed'),
('Commitments','Approvals',2,'ProviderAgreed'),
('Commitments','Approvals',3,'EmployerAndProviderAgreed'),
('Commitments','Approvals',4,'TransferSenderAgreed'),
('Commitments','Approvals',5,'TransferSenderAndEmployerAgreed'),
('Commitments','Approvals',6,'TransferSenderAndProviderAgreed'),
('Commitments','Approvals',7,'AllAgreed')

COMMIT TRANSACTION
END

/* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'LoadReferenceData',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[LoadReferenceData].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ReferenceData]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ReferenceData].[Category]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ReferenceData].[FieldName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ReferenceData].[FieldValue]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[ReferenceData].[FieldDesc]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[LoadReferenceData].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="3884" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[LoadReferenceData]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Payments_SS]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[PaymentID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[UKPRN]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[ULN]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[EmployerAccountID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[DasAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[CommitmentID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[DeliveryMonth]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[DeliveryYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[CollectionMonth]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[CollectionYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[EvidenceSubmittedOn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[EmployerAccountVersion]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[ApprenticeshipVersion]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[FundingSource]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="25" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[FundingAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[TransactionType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[StdCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[FworkCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[ProgType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[PwayCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[ContractType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[UpdateDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[UpdateDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[Flag_Latest]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[Flag_FirstPayment]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[PaymentAge]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[PaymentAgeBand]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="27" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[DeliveryMonthShortNameYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[DASAccountName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[CollectionPeriodName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[CollectionPeriodMonth]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Payments_SS].[CollectionPeriodYear]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Apprentice_ID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[Apprentice].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprentice]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="101" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Apprenticeship_ID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[Apprenticeship].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Apprenticeship]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="102" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_AssOrg_Id]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[AssessmentOrganisation].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[AssessmentOrganisation]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="107" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Commitment_Id]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[Commitment].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Commitment]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="108" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_DataLockStatus_Id]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[DataLockStatus].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[DataLockStatus]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="112" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_EmployerAccLE]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[EmployerAccountLegalEntity].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccountLegalEntity]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="115" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_EmployerAccount_Id]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[EmployerAccount].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[EmployerAccount]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="114" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Provider_Id]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[Provider].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Provider]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="117" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_ReferenceData_ID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[ReferenceData].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[ReferenceData]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="118" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_SourceDbChanges_SDCId]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[SourceDbChanges].[SDC_Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[SourceDbChanges]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="119" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_TrainingCourse_ID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[TrainingCourse].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[TrainingCourse]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="120" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Transfers_Id]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[Transfers].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Transfers]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="121" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[PopulateSourceDbMetadataForImport]">
			<Property Name="BodyScript">
				<Value><![CDATA[
/* =========================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 28/05/2020
-- Description: Populate Metadata Table with Source Config for Import 
-- =========================================================================

*/

BEGIN TRY


DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-3'
	   ,'PopulateSourceDbMetadataForImport'
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='PopulateSourceDbMetadataForImport'
     AND RunId=@RunID

BEGIN TRANSACTION

DELETE FROM Mtd.SourceConfigForImport

INSERT INTO Mtd.SourceConfigForImport
(SourceDatabaseName,SourceTableName,SourceSchemaName,ColumnNamesToInclude,ColumnNamesToExclude)
VALUES
/* AVMSPlus Metadata */
('AvmsPlus','Candidate','dbo','[CandidateId],[PersonId],[CandidateStatusTypeId],[ApplicationLimitEnforced],[LastAccessedDate],[DisableAlerts],[LastAccessedManageApplications],[BeingSupportedBy],[LockedForSupportUntil],[AllowMarketingMessages],[CandidateGuid]','[AddressLine1],[AddressLine2],[AddressLine3],[AddressLine4],[AddressLine5],[Town],[Longitude],[Latitude],[GeocodeEasting],[GeocodeNorthing],[NiReference],[EthnicOrigin],[EthnicOriginOther],[AdditionalEmail],[Disability],[DisabilityOther],[HealthProblems],[UnconfirmedEmailAddress],[MobileNumberUnconfirmed],[NewVacancyAlertEmail],[NewVacancyAlertSMS],[CountyId],[Postcode],[LocalAuthorityId],[UniqueLearnerNumber],[UlnStatusId],[Gender],[ReferralAgent],[ReceivePushedContent],[DoBFailureCount],[ForgottenUsernameRequested],[ForgottenPasswordRequested],[TextFailureCount],[EmailFailureCount],[ReferralPoints],[ReminderMessageSent],[DateofBirth],[VoucherReferenceNumber]')
,('AvmsPlus','Vacancy','dbo','[VacancyId],[VacancyOwnerRelationshipId],[VacancyReferenceNumber],[VacancyStatusId],[ApprenticeshipFrameworkId],[Title],[ApprenticeshipType],[ShortDescription],[Description],[WeeklyWage],[WageLowerBound],[WageUpperBound],[WageType],[WageTypeReason],[WageText],[NumberofPositions],[ApplicationClosingDate],[InterviewsFromDate],[ExpectedStartDate],[ExpectedDuration],[WorkingWeek],[NumberOfViews],[MaxNumberofApplications],[ApplyOutsideNAVMS],[BeingSupportedBy],[LockedForSupportUntil],[NoOfOfflineApplicants],[MasterVacancyId],[VacancyLocationTypeId],[NoOfOfflineSystemApplicants],[DeliveryOrganisationID],[ContractOwnerID],[SmallEmployerWageIncentive],[OriginalContractOwnerId],[VacancyGuid],[SubmissionCount],[StartedToQADateTime],[StandardId],[HoursPerWeek],[WageUnitId],[DurationTypeId],[DurationValue],[TrainingTypeId],[VacancyTypeId],[SectorId],[UpdatedDateTime],[EditedInRaa],[VacancySourceId],[OfflineVacancyTypeId]','[AddressLine1],[AddressLine2],[AddressLine3],[AddressLine4],[AddressLine5],[Town],[GeocodeEasting],[GeocodeNorthing],[Longitude],[Latitude],[ContactEmail],[ContactNumber],[QAUserName],[ContactName],[EmployerDescription],[EmployersWebsite],[EmployersRecruitmentWebsite],[EmployerAnonymousReason],[AnonymousAboutTheEmployer],[IsDisabilityConfident],[AdditionalLocationInformation],[VacancyManagerAnonymous],[VacancyManagerID],[EmployerAnonymousName],[EmployersApplicationInstructions],[LocalAuthorityId],[CountyId],[PostCode]')
,('AvmsPlus','VacancyStatusType','dbo','[VacancyStatusTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','VacancyOwnerRelationship','dbo','[VacancyOwnerRelationshipId],[EmployerId],[ProviderSiteID],[ContractHolderIsEmployer],[StatusTypeId],[NationWideAllowed],[EditedInRaa]','[ManagerIsEmployer],[EmployerDescription],[EmployerWebsite],[EmployerLogoAttachmentId],[Notes]')
,('AvmsPlus','Employer','dbo','[EmployerId],[FullName],[TradingName],[OwnerOrgnistaion],[TotalVacanciesPosted],[BeingSupportedBy],[LockedForSupportUntil],[EmployerStatusTypeId]','[AddressLine1],[AddressLine2],[AddressLine3],[AddressLine4],[AddressLine5],[Town],[Longitude],[Latitude],[GeocodeEasting],[GeocodeNorthing],[NumberofEmployeesAtSite],[NumberOfEmployeesInGroup],[PrimaryContact],[CompanyRegistrationNumber],[EdsUrn],[CountyId],[PostCode],[DisableAllowed],[TrackingAllowed],[LocalAuthorityId]')
,('AvmsPlus','ProviderSite','dbo','[ProviderSiteID],[FullName],[TradingName],[TrainingProviderStatusTypeId],[IsRecruitmentAgency],[OwnerOrganisation]','[AddressLine1],[AddressLine2],[AddressLine3],[AddressLine4],[AddressLine5],[Town],[Longitude],[Latitude],[GeocodeEasting],[GeocodeNorthing],[ContactDetailsForEmployer],[ContactDetailsForCandidate],[EDSURN],[CountyId],[PostCode],[LocalAuthorityId],[ManagingAreaID],[EmployerDescription],[CandidateDescription],[WebPage],[OutofDate],[HideFromSearch],[ContactDetailsAsARecruitmentAgency]')
,('AvmsPlus','ProviderSiteRelationship','dbo','[ProviderSiteRelationshipID],[ProviderID],[ProviderSiteID],[ProviderSiteRelationShipTypeID]','')
,('AvmsPlus','ProviderSiteRelationshipType','dbo','[ProviderSiteRelationshipTypeID],[ProviderSiteRelationshipTypeName]','')
,('AvmsPlus','Provider','dbo','[ProviderID],[UKPRN],[FullName],[TradingName],[IsContracted],[ContractedFrom],[ContractedTo],[ProviderStatusTypeID],[IsNASProvider],[ProviderToUseFAA]','[UPIN],[OriginalUPIN],[MigrateProviderMessageID]')
,('AvmsPlus','TrainingType','dbo','[TrainingTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','Standard','Reference','[StandardId],[StandardSectorId],[LarsCode],[FullName],[EducationLevelId],[ApprenticeshipFrameworkStatusTypeId],[EducationLevelNumber]','')
,('AvmsPlus','StandardSector','Reference','[StandardSectorId],[FullName],[ApprenticeshipOccupationId],[LarsStandardSectorCode]','')
,('AvmsPlus','EducationLevel','Reference','[EducationLevelId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','ApprenticeshipFramework','dbo','[ApprenticeshipFrameworkId],[ApprenticeshipOccupationId],[CodeName],[ShortName],[FullName],[ApprenticeshipFrameworkStatusTypeId],[ClosedDate],[PreviousApprenticeshipOccupationId],[StandardId]','')
,('AvmsPlus','ApprenticeshipOccupation','dbo','[ApprenticeshipOccupationId],[Codename],[ShortName],[FullName],[ApprenticeshipOccupationStatusTypeId],[ClosedDate]','')
,('AvmsPlus','VacancyHistory','dbo','[VacancyHistoryId],[VacancyId],[VacancyHistoryEventTypeId],[VacancyHistoryEventSubTypeId],[HistoryDate],[Comment]','[UserName]')
,('AvmsPlus','LocalAuthority','dbo','[LocalAuthorityId],[CodeName],[ShortName],[FullName],[CountyId]','')
,('AvmsPlus','County','dbo','[CountyId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','ApprenticeshipType','dbo','[ApprenticeshipTypeId],[CodeName],[ShortName],[FullName],[EducationLevelId]','')
,('AvmsPlus','WageType','dbo','[WageTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','VacancySource','dbo','[VacancySourceId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','Application','dbo','[ApplicationId],[CandidateId],[VacancyId],[ApplicationStatusTypeId],[BeingSupportedBy],[LockedForSupportUntil],[WithdrawalAcknowledged],[ApplicationGuid]','[CVAttachmentId],[Notes],[WithdrawnOrDeclinedReasonId],[UnsuccessfulReasonId],[OutcomeReasonOther],[NextActionId],[NextActionOther]')
,('AvmsPlus','ApplicationStatusType','dbo','[ApplicationStatusTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','VacancyHistoryEventType','dbo','[VacancyHistoryEventTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','ApplicationHistoryEvent','dbo','[ApplicationHistoryEventId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','EmployerTrainingProviderStatus','dbo','[EmployerTrainingProviderStatusId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','ApprenticeshipFrameworkStatusType','dbo','[ApprenticeshipFrameworkStatusTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','ApprenticeshipOccupationStatusType','dbo','[ApprenticeshipOccupationStatusTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','LocalAuthorityGroup','dbo','[LocalAuthorityGroupID],[CodeName],[ShortName],[FullName],[LocalAuthorityGroupTypeID],[LocalAuthorityGroupPurposeID],[ParentLocalAuthorityGroupID]','')
,('AvmsPlus','LocalAuthorityGroupMembership','dbo','[LocalAuthorityID],[LocalAuthorityGroupID]','')
,('AvmsPlus','LocalAuthorityGroupType','dbo','[LocalAuthorityGroupTypeID],[LocalAuthorityGroupTypeName]','')
,('AvmsPlus','VacancyLocationType','dbo','[VacancyLocationTypeId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','WageUnit','dbo','[WageUnitId],[CodeName],[ShortName],[FullName]','')
,('AvmsPlus','ApplicationHistory','dbo','[ApplicationHistoryId],[ApplicationId],[ApplicationHistoryEventDate],[ApplicationHistoryEventTypeId],[ApplicationHistoryEventSubTypeId]','[UserName],[Comment]')
,('EmpInc','Accounts','dbo','[Id],[AccountLegalEntityId],[LegalEntityId],[HasSignedIncentivesTerms]','[LegalEntityName]')
,('EmpInc','IncentiveApplication','dbo','[Id],[AccountId],[AccountLegalEntityId],[DateCreated],[Status],[DateSubmitted]','[SubmittedByEmail],[SubmittedByName]')
,('EmpInc','IncentiveApplicationApprenticeship','dbo','[Id],[IncentiveApplicationId],[ApprenticeshipId],[PlannedStartDate],[ApprenticeshipEmployerTypeOnApproval],[TotalIncentiveAmount]','[FirstName],[LastName],[DateOfBirth],[ULN]')



COMMIT TRANSACTION


UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'PopulateSourceDbMetadataForImport',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[PopulateSourceDbMetadataForImport].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceDatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceTableName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[SourceSchemaName]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[ColumnNamesToInclude]" />
				</Entry>
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport].[ColumnNamesToExclude]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[PopulateSourceDbMetadataForImport].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="10408" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[PopulateSourceDbMetadataForImport]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[PresentationLayerFullRefresh]">
			<Property Name="BodyScript">
				<Value><![CDATA[
/* ===============================================================================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 24/08/2020
-- Description: Dynamically Refresh Data Mart Presentation Layer
--              This is built dynamically such that it can be used for any Full Refresh of Presentation Layer.
-- ===============================================================================================================
*/

BEGIN TRY


DECLARE @LogID int
DECLARE @SPName Varchar(255)

select @SPName = 'PresentationLayerFullRefresh-'+SUBSTRING(@PLTableName,CHARINDEX('.',@PLTableName)+1,LEN(@PLTableName))

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-6'
	   ,@SPName
	   ,getdate()
	   ,0

  SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName=@SPName
     AND RunId=@RunID

BEGIN TRANSACTION

Declare @VSQL1 NVARCHAR(MAX)

SET @VSQL1=

'
DELETE FROM '+@PLTableName+'

INSERT INTO '+@PLTableName+'
('+@ColumnList+')
SELECT '+@ColumnList+'
  FROM '+@StgTableName+'
'

EXEC SP_EXECUTESQL @VSQL1

COMMIT TRANSACTION

/* Drop Staging Table */

DECLARE @VSQL2 NVARCHAR(MAX)
Declare @TableName Varchar(255)
SELECT @TableName=SUBSTRING(@StgTableName,CHARINDEX('.',@StgTableName)+1,LEN(@StgTableName))

SET @VSQL2=
'
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N'''+@TableName+''' AND TABLE_SCHEMA=N''Stg'') 
DROP TABLE [Stg].'+@TableName+'
'
EXEC SP_EXECUTESQL @VSQL2


UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunId=@RunId

 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION;

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    @SPName,
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[PresentationLayerFullRefresh].[@PLTableName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[PresentationLayerFullRefresh].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[PresentationLayerFullRefresh].[@ColumnList]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[PresentationLayerFullRefresh].[@StgTableName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[PresentationLayerFullRefresh].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[PresentationLayerFullRefresh].[@PLTableName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[PresentationLayerFullRefresh].[@StgTableName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[PresentationLayerFullRefresh].[@ColumnList]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2830" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[PresentationLayerFullRefresh]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;  ,@PLTableName varchar(255)&#xD;&#xA;  ,@StgTableName varchar(255)&#xD;&#xA;  ,@ColumnList varchar(max)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Provider]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Provider].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Provider].[Ukprn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Provider].[ProviderName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Provider].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="21" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Provider].[Asdm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="22" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Provider].[Asdm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="23" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="117" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[ReferenceData]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[ReferenceData].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[ReferenceData].[Category]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[ReferenceData].[FieldName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[ReferenceData].[FieldValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[ReferenceData].[FieldDesc]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="118" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[SaltKeyLogging]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma EVani
-- Create Date: 27/07/2020
-- Description: SaltKey Logging
-- ===========================================================================
BEGIN TRY
	DECLARE @LogID int

		/* Start Logging Execution */

	  INSERT INTO Mgmt.Log_Execution_Results
		  (
			RunId
		   ,StepNo
		   ,StoredProcedureName
		   ,StartDateTime
		   ,Execution_Status
		  )
	  SELECT 
			@RunId
		   ,'Step-4'
		   ,'SaltKeyLogging'
		   ,getdate()
		   ,0

		SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
		WHERE StoredProcedureName='SaltKeyLogging'
		AND RunId=@RunID
		
		Declare @SaltKeyID BigInt = replace(replace(replace(replace(convert(Nvarchar(25), current_timestamp, 121),'-',''),':',''),'.',''),' ','')				
		insert into AsData_PL.SaltKeyLog(SaltKeyID,SourceType) Values (@SaltKeyID,@SourceType)

		 UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=1
			  ,EndDateTime=getdate()
			  ,FullJobStatus='Pending'
		 WHERE LogId=@LogID
		   AND RunId=@RunId

 
END TRY
BEGIN CATCH
		DECLARE @ErrorId int

		INSERT INTO Mgmt.Log_Error_Details
			(UserName
			,ErrorNumber
			,ErrorState
			,ErrorSeverity
			,ErrorLine
			,ErrorProcedure
			,ErrorMessage
			,ErrorDateTime
			,RunId
			)
		SELECT 
			SUSER_SNAME(),
			ERROR_NUMBER(),
			ERROR_STATE(),
			ERROR_SEVERITY(),
			ERROR_LINE(),
			'SaltKeyLogging',
			ERROR_MESSAGE(),
			GETDATE(),
			@RunId as RunId; 

		SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

		/* Update Log Execution Results as Fail if there is an Error*/

		UPDATE Mgmt.Log_Execution_Results
		   SET Execution_Status=0
			  ,EndDateTime=getdate()
			  ,ErrorId=@ErrorId
		 WHERE LogId=@LogID
		   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[SaltKeyLogging].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[SaltKeyLog]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[SaltKeyLog].[SaltKeyID]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[SaltKeyLog].[SourceType]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[SaltKeyLogging].[@SourceType]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[SaltKeyLogging].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[SaltKeyLogging].[@SourceType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1939" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE dbo.SaltKeyLogging&#xD;&#xA;(&#xD;&#xA;   @RunId int,&#xD;&#xA;   @SourceType Varchar(50)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[SourceDbChanges]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[SourceDbChanges].[SDC_Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[SourceDbChanges].[SourceDatabaseName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[SourceDbChanges].[SouceTableName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[SourceDbChanges].[SourceSchemaName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[SourceDbChanges].[ChangesDetected]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[SourceDbChanges].[DetectedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="39" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="119" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[TrainingCourse]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[TrainingType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[TrainingCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[TrainingName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[Source_ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="33" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[AsDm_CreatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="34" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[TrainingCourse].[AsDm_UpdatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="35" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="120" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Transfers]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[CommitmentId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[Cost]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TrainingCourses]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferSenderAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferReceiverAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferApprovalActionedByEmployerName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferApprovalActionedByEmployerEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferApprovalActionedOn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[FundingCap]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="17" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[TransferCreatedOn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[Data_Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[Source_CommitmentTransferId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="12" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[AsDm_CreatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="13" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Transfers].[AsDm_UpdatedDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="14" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="121" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[UpdateApprenticeshipStdRoute]">
			<Property Name="BodyScript">
				<Value><![CDATA[
-- ===========================================================================
-- Author:      Sarma Evani
-- Create Date: 29/07/2020
-- Description: Apprenticeship Stds Route Lookup Data
-- ===========================================================================
if not exists (select * from [AsData_PL].ApprenticeshipStdRoute)
Begin 
		insert into [AsData_PL].ApprenticeshipStdRoute([Reference],[LARSCode],[Route]) values 
		('ST0127','1','Digital'),
		('ST0116','2','Digital'),
		('ST0011','3','Engineering and manufacturing'),
		('ST0026','4','Engineering and manufacturing'),
		('ST0152','5','Construction'),
		('ST0156','6','Engineering and manufacturing'),
		('ST0184','7','Legal, finance and accounting'),
		('ST0177','8','Legal, finance and accounting'),
		('ST0023','9','Engineering and manufacturing'),
		('ST0024','10','Engineering and manufacturing'),
		('ST0025','11','Engineering and manufacturing'),
		('ST0027','12','Engineering and manufacturing'),
		('ST0028','13','Engineering and manufacturing'),
		('ST0248','14','Health and science'),
		('ST0250','15','Engineering and manufacturing'),
		('ST0195','16','Engineering and manufacturing'),
		('ST0004','17','Legal, finance and accounting'),
		('ST0108','18','Health and science'),
		('ST0110','19','Health and science'),
		('ST0109','20','Business and administration'),
		('ST0209','21','Agriculture, environmental and animal care'),
		('ST0285','22','Creative and design'),
		('ST0171','23','Construction'),
		('ST0315','24','Construction'),
		('ST0119','25','Digital'),
		('ST0158','26','Construction'),
		('ST0160','27','Engineering and manufacturing'),
		('ST0178','28','Legal, finance and accounting'),
		('ST0179','29','Legal, finance and accounting'),
		('ST0180','30','Legal, finance and accounting'),
		('ST0185','31','Legal, finance and accounting'),
		('ST0187','32','Legal, finance and accounting'),
		('ST0181','33','Legal, finance and accounting'),
		('ST0274','34','Transport and logistics'),
		('ST0292','35','Engineering and manufacturing'),
		('ST0314','36','Business and administration'),
		('ST0010','37','Engineering and manufacturing'),
		('ST0013','38','Engineering and manufacturing'),
		('ST0100','39','Legal, finance and accounting'),
		('ST0101','40','Legal, finance and accounting'),
		('ST0244','41','Legal, finance and accounting'),
		('ST0245','42','Legal, finance and accounting'),
		('ST0246','43','Legal, finance and accounting'),
		('ST0247','44','Health and science'),
		('ST0249','45','Engineering and manufacturing'),
		('ST0290','46','Engineering and manufacturing'),
		('ST0289','47','Engineering and manufacturing'),
		('ST0183','48','Legal, finance and accounting'),
		('ST0322','49','Construction'),
		('ST0331','50','Construction'),
		('ST0332','51','Construction'),
		('ST0159','53','Engineering and manufacturing'),
		('ST0078','54','Sales, marketing and procurement'),
		('ST0272','55','Business and administration'),
		('ST0012','56','Engineering and manufacturing'),
		('ST0205','57','Engineering and manufacturing'),
		('ST0204','58','Engineering and manufacturing'),
		('ST0033','59','Engineering and manufacturing'),
		('ST0240','60','Legal, finance and accounting'),
		('ST0113','61','Health and science'),
		('ST0182','62','Legal, finance and accounting'),
		('ST0241','63','Legal, finance and accounting'),
		('ST0235','64','Sales, marketing and procurement'),
		('ST0234','65','Sales, marketing and procurement'),
		('ST0236','66','Sales, marketing and procurement'),
		('ST0288','67','Engineering and manufacturing'),
		('ST0161','68','Construction'),
		('ST0242','69','Agriculture, environmental and animal care'),
		('ST0243','70','Agriculture, environmental and animal care'),
		('ST0256','71','Creative and design'),
		('ST0055','72','Creative and design'),
		('ST0313','73','Sales, marketing and procurement'),
		('ST0155','74','Construction'),
		('ST0342','75','Creative and design'),
		('ST0059','76','Engineering and manufacturing'),
		('ST0176','77','Legal, finance and accounting'),
		('ST0122','78','Sales, marketing and procurement'),
		('ST0114','79','Digital'),
		('ST0118','80','Digital'),
		('ST0131','81','Digital'),
		('ST0125','82','Digital'),
		('ST0273','83','Business and administration'),
		('ST0347','84','Creative and design'),
		('ST0346','85','Creative and design'),
		('ST0038','86','Transport and logistics'),
		('ST0037','87','Transport and logistics'),
		('ST0316','88','Engineering and manufacturing'),
		('ST0318','89','Engineering and manufacturing'),
		('ST0317','90','Engineering and manufacturing'),
		('ST0129','91','Digital'),
		('ST0164','92','Engineering and manufacturing'),
		('ST0228','93','Catering and hospitality'),
		('ST0349','94','Engineering and manufacturing'),
		('ST0350','95','Engineering and manufacturing'),
		('ST0233','96','Catering and hospitality'),
		('ST0009','97','Engineering and manufacturing'),
		('ST0124','98','Digital'),
		('ST0218','99','Health and science'),
		('ST0336','100','Transport and logistics'),
		('ST0327','101','Sales, marketing and procurement'),
		('ST0215','102','Health and science'),
		('ST0216','103','Health and science'),
		('ST0385','104','Business and administration'),
		('ST0384','105','Business and administration'),
		('ST0296','106','Engineering and manufacturing'),
		('ST0151','107','Engineering and manufacturing'),
		('ST0222','108','Protective services'),
		('ST0258','109','Transport and logistics'),
		('ST0257','110','Transport and logistics'),
		('ST0259','111','Transport and logistics'),
		('ST0341','112','Creative and design'),
		('ST0020','113','Engineering and manufacturing'),
		('ST0019','114','Engineering and manufacturing'),
		('ST0015','116','Engineering and manufacturing'),
		('ST0003','117','Legal, finance and accounting'),
		('ST0006','118','Care services'),
		('ST0005','119','Care services'),
		('ST0340','120','Sales, marketing and procurement'),
		('ST0036','121','Transport and logistics'),
		('ST0072','122','Sales, marketing and procurement'),
		('ST0039','123','Transport and logistics'),
		('ST0052','124','Construction'),
		('ST0051','125','Construction'),
		('ST0189','126','Construction'),
		('ST0157','127','Engineering and manufacturing'),
		('ST0310','128','Business and administration'),
		('ST0196','129','Engineering and manufacturing'),
		('ST0199','130','Engineering and manufacturing'),
		('ST0198','131','Health and science'),
		('ST0358','132','Engineering and manufacturing'),
		('ST0002','133','Legal, finance and accounting'),
		('ST0067','134','Engineering and manufacturing'),
		('ST0068','135','Engineering and manufacturing'),
		('ST0066','136','Engineering and manufacturing'),
		('ST0203','137','Engineering and manufacturing'),
		('ST0230','138','Catering and hospitality'),
		('ST0232','139','Catering and hospitality'),
		('ST0326','140','Sales, marketing and procurement'),
		('ST0014','141','Engineering and manufacturing'),
		('ST0115','142','Sales, marketing and procurement'),
		('ST0362','143','Legal, finance and accounting'),
		('ST0363','144','Legal, finance and accounting'),
		('ST0210','145','Agriculture, environmental and animal care'),
		('ST0154','146','Engineering and manufacturing'),
		('ST0325','147','Sales, marketing and procurement'),
		('ST0175','148','Legal, finance and accounting'),
		('ST0393','149','Engineering and manufacturing'),
		('ST0220','150','Health and science'),
		('ST0217','151','Health and science'),
		('ST0077','152','Sales, marketing and procurement'),
		('ST0374','153','Legal, finance and accounting'),
		('ST0128','154','Digital'),
		('ST0130','155','Digital'),
		('ST0287','156','Health and science'),
		('ST0213','157','Hair and beauty'),
		('ST0383','158','Creative and design'),
		('ST0168','159','Sales, marketing and procurement'),
		('ST0094','160','Engineering and manufacturing'),
		('ST0153','161','Engineering and manufacturing'),
		('ST0170','162','Construction'),
		('ST0380','163','Engineering and manufacturing'),
		('ST0065','164','Construction'),
		('ST0117','165','Digital'),
		('ST0456','166','Engineering and manufacturing'),
		('ST0457','167','Engineering and manufacturing'),
		('ST0413','168','Health and science'),
		('ST0227','169','Catering and hospitality'),
		('ST0293','170','Health and science'),
		('ST0271','171','Construction'),
		('ST0194','172','Sales, marketing and procurement'),
		('ST0062','173','Construction'),
		('ST0105','174','Creative and design'),
		('ST0144','175','Engineering and manufacturing'),
		('ST0352','176','Engineering and manufacturing'),
		('ST0191','177','Catering and hospitality'),
		('ST0063','178','Construction'),
		('ST0058','179','Health and science'),
		('ST0223','180','Agriculture, environmental and animal care'),
		('ST0225','181','Agriculture, environmental and animal care'),
		('ST0224','182','Agriculture, environmental and animal care'),
		('ST0328','183','Creative and design'),
		('ST0197','184','Health and science'),
		('ST0064','185','Construction'),
		('ST0163','186','Engineering and manufacturing'),
		('ST0282','187','Health and science'),
		('ST0419','188','Transport and logistics'),
		('ST0338','189','Transport and logistics'),
		('ST0238','190','Business and administration'),
		('ST0239','191','Business and administration'),
		('ST0060','192','Construction'),
		('ST0061','193','Construction'),
		('ST0391','194','Construction'),
		('ST0266','195','Construction'),
		('ST0070','196','Business and administration'),
		('ST0382','197','Creative and design'),
		('ST0372','198','Construction'),
		('ST0091','199','Construction'),
		('ST0417','200','Construction'),
		('ST0407','201','Engineering and manufacturing'),
		('ST0162','202','Construction'),
		('ST0490','203','Education and childcare'),
		('ST0001','204','Legal, finance and accounting'),
		('ST0520','205','Legal, finance and accounting'),
		('ST0339','206','Transport and logistics'),
		('ST0369','207','Engineering and manufacturing'),
		('ST0508','208','Health and science'),
		('ST0201','209','Transport and logistics'),
		('ST0474','210','Legal, finance and accounting'),
		('ST0102','211','Legal, finance and accounting'),
		('ST0150','212','Construction'),
		('ST0472','213','Legal, finance and accounting'),
		('ST0337','214','Transport and logistics'),
		('ST0478','215','Health and science'),
		('ST0475','216','Engineering and manufacturing'),
		('ST0320','217','Business and administration'),
		('ST0321','218','Business and administration'),
		('ST0267','219','Construction'),
		('ST0528','220','Engineering and manufacturing'),
		('ST0626','221','Health and science'),
		('ST0313','222','Sales, marketing and procurement'),
		('ST0229','223','Catering and hospitality'),
		('ST0569','224','Engineering and manufacturing'),
		('ST0303','225','Construction'),
		('ST0364','226','Engineering and manufacturing'),
		('ST0291','227','Engineering and manufacturing'),
		('ST0301','228','Business and administration'),
		('ST0106','229','Creative and design'),
		('ST0375','230','Construction'),
		('ST0526','231','Business and administration'),
		('ST0575','232','Business and administration'),
		('ST0521','233','Construction'),
		('ST0333','234','Construction'),
		('ST0395','235','Creative and design'),
		('ST0480','236','Business and administration'),
		('ST0192','237','Business and administration'),
		('ST0193','238','Business and administration'),
		('ST0264','239','Construction'),
		('ST0263','240','Construction'),
		('ST0486','241','Protective services'),
		('ST0092','242','Business and administration'),
		('ST0431','243','Health and science'),
		('ST0491','244','Construction'),
		('ST0529','245','Engineering and manufacturing'),
		('ST0503','246','Transport and logistics'),
		('ST0530','247','Health and science'),
		('ST0473','248','Engineering and manufacturing'),
		('ST0422','249','Engineering and manufacturing'),
		('ST0188','250','Protective services'),
		('ST0093','251','Health and science'),
		('ST0564','252','Health and science'),
		('ST0430','253','Business and administration'),
		('ST0492','254','Construction'),
		('ST0502','255','Legal, finance and accounting'),
		('ST0304','256','Protective services'),
		('ST0311','257','Sales, marketing and procurement'),
		('ST0410','258','Construction'),
		('ST0046','259','Construction'),
		('ST0550','260','Protective services'),
		('ST0334','261','Sales, marketing and procurement'),
		('ST0483','262','Protective services'),
		('ST0166','263','Agriculture, environmental and animal care'),
		('ST0539','264','Transport and logistics'),
		('ST0428','265','Transport and logistics'),
		('ST0484','266','Construction'),
		('ST0458','267','Engineering and manufacturing'),
		('ST0429','268','Agriculture, environmental and animal care'),
		('ST0386','269','Protective services'),
		('ST0561','270','Legal, finance and accounting'),
		('ST0190','271','Engineering and manufacturing'),
		('ST0477','272','Education and childcare'),
		('ST0359','273','Construction'),
		('ST0418','274','Engineering and manufacturing'),
		('ST0041','275','Construction'),
		('ST0040','276','Construction'),
		('ST0042','277','Construction'),
		('ST0071','278','Sales, marketing and procurement'),
		('ST0275','279','Catering and hospitality'),
		('ST0532','280','Creative and design'),
		('ST0493','281','Health and science'),
		('ST0509','282','Protective services'),
		('ST0499','283','Engineering and manufacturing'),
		('ST0389','284','Agriculture, environmental and animal care'),
		('ST0645','285','Transport and logistics'),
		('ST0073','286','Legal, finance and accounting'),
		('ST0095','287','Construction'),
		('ST0202','289','Engineering and manufacturing'),
		('ST0295','290','Construction'),
		('ST0411','291','Business and administration'),
		('ST0427','292','Transport and logistics'),
		('ST0481','293','Sales, marketing and procurement'),
		('ST0580','294','Engineering and manufacturing'),
		('ST0587','295','Legal, finance and accounting'),
		('ST0604','296','Engineering and manufacturing'),
		('ST0454','297','Education and childcare'),
		('ST0627','298','Health and science'),
		('ST0534','299','Construction'),
		('ST0533','300','Construction'),
		('ST0497','301','Engineering and manufacturing'),
		('ST0637','302','Engineering and manufacturing'),
		('ST0022','303','Construction'),
		('ST0031','304','Engineering and manufacturing'),
		('ST0558','305','Transport and logistics'),
		('ST0582','306','Health and science'),
		('ST0609','307','Health and science'),
		('ST0087','308','Care services'),
		('ST0088','309','Care services'),
		('ST0329','310','Sales, marketing and procurement'),
		('ST0423','311','Sales, marketing and procurement'),
		('ST0268','312','Construction'),
		('ST0496','313','Engineering and manufacturing'),
		('ST0018','314','Agriculture, environmental and animal care'),
		('ST0414','315','Construction'),
		('ST0507','316','Transport and logistics'),
		('ST0283','317','Health and science'),
		('ST0567','318','Health and science'),
		('ST0597','319','Health and science'),
		('ST0602','320','Business and administration'),
		('ST0302','321','Health and science'),
		('ST0400','322','Transport and logistics'),
		('ST0603','323','Legal, finance and accounting'),
		('ST0610','324','Legal, finance and accounting'),
		('ST0563','325','Business and administration'),
		('ST0562','326','Business and administration'),
		('ST0482','327','Digital'),
		('ST0574','328','Engineering and manufacturing'),
		('ST0461','329','Construction'),
		('ST0145','330','Engineering and manufacturing'),
		('ST0467','331','Agriculture, environmental and animal care'),
		('ST0397','332','Agriculture, environmental and animal care'),
		('ST0343','333','Agriculture, environmental and animal care'),
		('ST0549','334','Engineering and manufacturing'),
		('ST0167','335','Agriculture, environmental and animal care'),
		('ST0053','336','Construction'),
		('ST0585','337','Digital'),
		('ST0103','338','Transport and logistics'),
		('ST0622','339','Engineering and manufacturing'),
		('ST0583','340','Health and science'),
		('ST0571','341','Engineering and manufacturing'),
		('ST0588','342','Engineering and manufacturing'),
		('ST0615','343','Construction'),
		('ST0017','344','Agriculture, environmental and animal care'),
		('ST0495','345','Engineering and manufacturing'),
		('ST0465','346','Engineering and manufacturing'),
		('ST0376','347','Engineering and manufacturing'),
		('ST0612','348','Sales, marketing and procurement'),
		('ST0596','349','Sales, marketing and procurement'),
		('ST0307','350','Transport and logistics'),
		('ST0479','351','Health and science'),
		('ST0537','352','Engineering and manufacturing'),
		('ST0373','353','Construction'),
		('ST0426','354','Creative and design'),
		('ST0409','355','Digital'),
		('ST0366','356','Construction'),
		('ST0099','357','Construction'),
		('ST0463','358','Construction'),
		('ST0540','359','Engineering and manufacturing'),
		('ST0498','360','Engineering and manufacturing'),
		('ST0541','361','Engineering and manufacturing'),
		('ST0276','362','Engineering and manufacturing'),
		('ST0630','363','Hair and beauty'),
		('ST0589','364','Catering and hospitality'),
		('ST0566','365','Engineering and manufacturing'),
		('ST0511','366','Engineering and manufacturing'),
		('ST0330','367','Protective services'),
		('ST0601','368','Health and science'),
		('ST0572','369','Sales, marketing and procurement'),
		('ST0632','370','Health and science'),
		('ST0586','371','Health and science'),
		('ST0504','372','Construction'),
		('ST0644','373','Sales, marketing and procurement'),
		('ST0545','374','Transport and logistics'),
		('ST0555','375','Business and administration'),
		('ST0433','376','Construction'),
		('ST0432','377','Engineering and manufacturing'),
		('ST0169','378','Construction'),
		('ST0398','379','Agriculture, environmental and animal care'),
		('ST0368','380','Construction'),
		('ST0510','381','Care services'),
		('ST0516','382','Protective services'),
		('ST0255','383','Creative and design'),
		('ST0547','384','Sales, marketing and procurement'),
		('ST0269','385','Construction'),
		('ST0394','386','Transport and logistics'),
		('ST0794','387','Health and science'),
		('ST0513','388','Construction'),
		('ST0635','389','Hair and beauty'),
		('ST0636','390','Hair and beauty'),
		('ST0517','391','Health and science'),
		('ST0226','392','Agriculture, environmental and animal care'),
		('ST0460','393','Creative and design'),
		('ST0592','394','Transport and logistics'),
		('ST0664','395','Business and administration'),
		('ST0299','396','Health and science'),
		('ST0519','397','Health and science'),
		('ST0548','398','Transport and logistics'),
		('ST0607','399','Engineering and manufacturing'),
		('ST0056','400','Sales, marketing and procurement'),
		('ST0146','401','Education and childcare'),
		('ST0149','402','Education and childcare'),
		('ST0148','403','Education and childcare'),
		('ST0252','404','Engineering and manufacturing'),
		('ST0556','405','Business and administration'),
		('ST0649','406','Health and science'),
		('ST0396','407','Creative and design'),
		('ST0173','408','Creative and design'),
		('ST0781','409','Health and science'),
		('ST0523','410','Transport and logistics'),
		('ST0584','411','Sales, marketing and procurement'),
		('ST0594','412','Sales, marketing and procurement'),
		('ST0505','413','Digital'),
		('ST0390','414','Health and science'),
		('ST0663','415','Business and administration'),
		('ST0453','416','Engineering and manufacturing'),
		('ST0515','417','Engineering and manufacturing'),
		('ST0611','418','Creative and design'),
		('ST0695','419','Engineering and manufacturing'),
		('ST0708','420','Business and administration'),
		('ST0600','421','Health and science'),
		('ST0542','422','Health and science'),
		('ST0616','423','Construction'),
		('ST0536','424','Construction'),
		('ST0568','425','Health and science'),
		('ST0659','426','Engineering and manufacturing'),
		('ST0593','427','Protective services'),
		('ST0669','428','Construction'),
		('ST0221','429','Creative and design'),
		('ST0135','430','Education and childcare'),
		('ST0619','431','Health and science'),
		('ST0633','432','Health and science'),
		('ST0107','433','Engineering and manufacturing'),
		('ST0827','434','Health and science'),
		('ST0405','435','Engineering and manufacturing'),
		('ST0448','436','Engineering and manufacturing'),
		('ST0403','437','Engineering and manufacturing'),
		('ST0506','438','Creative and design'),
		('ST0120','439','Digital'),
		('ST0617','440','Construction'),
		('ST0749','441','Creative and design'),
		('ST0696','442','Creative and design'),
		('ST0559','443','Creative and design'),
		('ST0535','444','Health and science'),
		('ST0620','445','Health and science'),
		('ST0524','446','Health and science'),
		('ST0652','447','Construction'),
		('ST0485','448','Digital'),
		('ST0487','449','Protective services'),
		('ST0406','450','Engineering and manufacturing'),
		('ST0628','451','Creative and design'),
		('ST0016','452','Agriculture, environmental and animal care'),
		('ST0694','453','Business and administration'),
		('ST0624','454','Engineering and manufacturing'),
		('ST0623','455','Engineering and manufacturing'),
		('ST0752','456','Engineering and manufacturing'),
		('ST0759','457','Health and science'),
		('ST0683','458','Sales, marketing and procurement'),
		('ST0678','459','Engineering and manufacturing'),
		('ST0424','460','Creative and design'),
		('ST0309','461','Engineering and manufacturing'),
		('ST0698','462','Transport and logistics'),
		('ST0613','463','Construction'),
		('ST0714','464','Health and science'),
		('ST0778','465','Agriculture, environmental and animal care'),
		('ST0577','466','Agriculture, environmental and animal care'),
		('ST0265','467','Construction'),
		('ST0049','468','Construction'),
		('ST0599','469','Health and science'),
		('ST0388','470','Construction'),
		('ST0300','471','Health and science'),
		('ST0531','472','Engineering and manufacturing'),
		('ST0618','473','Health and science'),
		('ST0662','474','Engineering and manufacturing'),
		('ST0681','475','Engineering and manufacturing'),
		('ST0693','476','Construction'),
		('ST0675','477','Engineering and manufacturing'),
		('ST0772','478','Engineering and manufacturing'),
		('ST0791','479','Engineering and manufacturing'),
		('ST0807','480','Sales, marketing and procurement'),
		('ST0172','481','Agriculture, environmental and animal care'),
		('ST0045','482','Construction'),
		('ST0786','483','Health and science'),
		('ST0769','484','Creative and design'),
		('ST0668','485','Sales, marketing and procurement'),
		('ST0852','486','Engineering and manufacturing'),
		('ST0851','487','Engineering and manufacturing'),
		('ST0608','488','Legal, finance and accounting'),
		('ST0788','489','Health and science'),
		('ST0595','490','Transport and logistics'),
		('ST0345','491','Digital'),
		('ST0789','492','Agriculture, environmental and animal care'),
		('ST0420','493','Engineering and manufacturing'),
		('ST0554','494','Health and science'),
		('ST0648','495','Protective services'),
		('ST0494','496','Protective services'),
		('ST0605','497','Engineering and manufacturing'),
		('ST0654','498','Engineering and manufacturing'),
		('ST0740','499','Engineering and manufacturing'),
		('ST0043','500','Construction'),
		('ST0047','501','Construction'),
		('ST0048','502','Construction'),
		('ST0747','503','Protective services'),
		('ST0709','504','Health and science'),
		('ST0829','505','Health and science'),
		('ST0518','506','Health and science'),
		('ST0631','507','Health and science'),
		('ST0767','508','Agriculture, environmental and animal care'),
		('ST0655','509','Engineering and manufacturing'),
		('ST0527','510','Care services'),
		('ST0044','511','Construction'),
		('ST0744','512','Engineering and manufacturing'),
		('ST0743','513','Construction'),
		('ST0846','514','Engineering and manufacturing'),
		('ST0793','515','Engineering and manufacturing'),
		('ST0174','516','Creative and design'),
		('ST0471','517','Transport and logistics'),
		('ST0270','518','Construction'),
		('ST0581','519','Engineering and manufacturing'),
		('ST0697','520','Health and science'),
		('ST0639','521','Engineering and manufacturing'),
		('ST0621','522','Transport and logistics'),
		('ST0841','523','Engineering and manufacturing'),
		('ST0464','524','Construction'),
		('ST0656','525','Engineering and manufacturing'),
		('ST0476','526','Creative and design'),
		('ST0765','527','Transport and logistics'),
		('ST0525','528','Creative and design'),
		('ST0096','529','Construction'),
		('ST0746','530','Protective services'),
		('ST0796','531','Legal, finance and accounting'),
		('ST0843','532','Health and science'),
		('ST0447','533','Creative and design'),
		('ST0378','534','Creative and design'),
		('ST0207','535','Agriculture, environmental and animal care'),
		('ST0590','536','Creative and design'),
		('ST0008','537','Care services'),
		('ST0489','538','Creative and design'),
		('ST0802','539','Construction'),
		('ST0762','540','Business and administration'),
		('ST0470','541','Digital'),
		('ST0625','542','Digital'),
		('ST0408','543','Agriculture, environmental and animal care'),
		('ST0629','544','Construction'),
		('ST0214','545','Hair and beauty'),
		('ST0864','546','Catering and hospitality'),
		('ST0425','547','Creative and design'),
		('ST0825','548','Digital'),
		('ST0251','549','Engineering and manufacturing'),
		('ST0888','550','Education and childcare'),
		('ST0007','551','Care services'),
		('ST0766','552','Legal, finance and accounting'),
		('ST0208','553','Agriculture, environmental and animal care'),
		('ST0782','554','Creative and design'),
		('ST0809','555','Business and administration'),
		('ST0787','556','Business and administration'),
		('ST0832','557','Construction'),
		('ST0488','558','Creative and design'),
		('ST0865','559','Digital'),
		('ST0833','560','Engineering and manufacturing'),
		('ST0763','561','Digital'),
		('ST0817','562','Engineering and manufacturing'),
		('ST0211','563','Hair and beauty'),
		('ST0748','564','Agriculture, environmental and animal care'),
		('ST0741','565','Construction'),
		('ST0831','566','Creative and design'),
		('ST0538','567','Agriculture, environmental and animal care'),
		('ST0898','568','Engineering and manufacturing'),
		('ST0815','569','Business and administration'),
		('ST0512','570','Protective services'),
		('ST0412','571','Agriculture, environmental and animal care'),
		('ST0761','572','Agriculture, environmental and animal care'),
		('ST0900','573','Creative and design'),
		('ST0925','574','Creative and design'),
		('ST0736','575','Construction'),
		('ST0795','576','Digital'),
		('ST0823','577','Engineering and manufacturing'),
		('ST0641','578','Engineering and manufacturing'),
		('ST0387','579','Engineering and manufacturing'),
		('ST0830','580','Health and science'),
		('ST0543','581','Health and science'),
		('ST0887','582','Sales, marketing and procurement'),
		('ST0834','583','Engineering and manufacturing'),
		('ST0873','584','Health and science'),
		('ST0000','TBC','Engineering and manufacturing'),
		('ST0079','TBC','Engineering and manufacturing'),
		('ST0081','TBC','Engineering and manufacturing'),
		('ST0083','TBC','Engineering and manufacturing'),
		('ST0084','TBC','Engineering and manufacturing'),
		('ST0086','TBC','Engineering and manufacturing'),
		('ST0206','TBC','Engineering and manufacturing'),
		('ST0286','TBC','Creative and design'),
		('ST0308','TBC','Transport and logistics'),
		('ST0439','TBC','Creative and design'),
		('ST0442','TBC','Construction'),
		('ST0462','TBC','Construction'),
		('ST0468','TBC','Creative and design'),
		('ST0469','TBC','Creative and design'),
		('ST0522','TBC','Care services'),
		('ST0544','TBC','Transport and logistics'),
		('ST0546','TBC','Agriculture, environmental and animal care'),
		('ST0551','TBC','Education and childcare'),
		('ST0552','TBC','Education and childcare'),
		('ST0560','TBC','Construction'),
		('ST0565','TBC','Engineering and manufacturing'),
		('ST0573','TBC','Construction'),
		('ST0576','TBC','Agriculture, environmental and animal care'),
		('ST0578','TBC','Construction'),
		('ST0579','TBC','Construction'),
		('ST0606','TBC','Engineering and manufacturing'),
		('ST0614','TBC','Construction'),
		('ST0634','TBC','Engineering and manufacturing'),
		('ST0640','TBC','Engineering and manufacturing'),
		('ST0646','TBC','Transport and logistics'),
		('ST0647','TBC','Transport and logistics'),
		('ST0651','TBC','Construction'),
		('ST0653','TBC','Engineering and manufacturing'),
		('ST0657','TBC','Engineering and manufacturing'),
		('ST0658','TBC','Engineering and manufacturing'),
		('ST0660','TBC','Engineering and manufacturing'),
		('ST0661','TBC','Engineering and manufacturing'),
		('ST0666','TBC','Education and childcare'),
		('ST0667','TBC','Education and childcare'),
		('ST0670','TBC','Construction'),
		('ST0671','TBC','Engineering and manufacturing'),
		('ST0672','TBC','Engineering and manufacturing'),
		('ST0674','TBC','Engineering and manufacturing'),
		('ST0676','TBC','Engineering and manufacturing'),
		('ST0680','TBC','Engineering and manufacturing'),
		('ST0682','TBC','Digital'),
		('ST0685','TBC','Hair and beauty'),
		('ST0701','TBC','Health and science'),
		('ST0702','TBC','Health and science'),
		('ST0742','TBC','Construction'),
		('ST0745','TBC','Engineering and manufacturing'),
		('ST0750','TBC','Construction'),
		('ST0753','TBC','Transport and logistics'),
		('ST0754','TBC','Agriculture, environmental and animal care'),
		('ST0755','TBC','Construction'),
		('ST0757','TBC','Digital'),
		('ST0758','TBC','Health and science'),
		('ST0764','TBC','Protective services'),
		('ST0768','TBC','Health and science'),
		('ST0770','TBC','Health and science'),
		('ST0773','TBC','Health and science'),
		('ST0774','TBC','Health and science'),
		('ST0775','TBC','Engineering and manufacturing'),
		('ST0777','TBC','Catering and hospitality'),
		('ST0780','TBC','Protective services'),
		('ST0783','TBC','Creative and design'),
		('ST0784','TBC','Engineering and manufacturing'),
		('ST0785','TBC','Engineering and manufacturing'),
		('ST0790','TBC','Engineering and manufacturing'),
		('ST0792','TBC','Creative and design'),
		('ST0797','TBC','Catering and hospitality'),
		('ST0798','TBC','Health and science'),
		('ST0799','TBC','Health and science'),
		('ST0805','TBC','Engineering and manufacturing'),
		('ST0808','TBC','Engineering and manufacturing'),
		('ST0810','TBC','Sales, marketing and procurement'),
		('ST0811','TBC','Sales, marketing and procurement'),
		('ST0813','TBC','Business and administration'),
		('ST0816','TBC','Business and administration'),
		('ST0819','TBC','Construction'),
		('ST0820','TBC','Health and science'),
		('ST0821','TBC','Construction'),
		('ST0824','TBC','Engineering and manufacturing'),
		('ST0828','TBC','Health and science'),
		('ST0838','TBC','Health and science'),
		('ST0839','TBC','Health and science'),
		('ST0840','TBC','Construction'),
		('ST0842','TBC','Transport and logistics'),
		('ST0845','TBC','Engineering and manufacturing'),
		('ST0847','TBC','Engineering and manufacturing'),
		('ST0850','TBC','Health and science'),
		('ST0853','TBC','Business and administration'),
		('ST0854','TBC','Business and administration'),
		('ST0855','TBC','Engineering and manufacturing'),
		('ST0856','TBC','Engineering and manufacturing'),
		('ST0857','TBC','Engineering and manufacturing'),
		('ST0858','TBC','Health and science'),
		('ST0859','TBC','Construction'),
		('ST0860','TBC','Business and administration'),
		('ST0861','TBC','Business and administration'),
		('ST0862','TBC','Care services'),
		('ST0863','TBC','Digital'),
		('ST0866','TBC','Legal, finance and accounting'),
		('ST0867','TBC','Education and childcare'),
		('ST0868','TBC','Care services'),
		('ST0869','TBC','Legal, finance and accounting'),
		('ST0870','TBC','Business and administration'),
		('ST0871','TBC','Engineering and manufacturing'),
		('ST0872','TBC','Engineering and manufacturing'),
		('ST0874','TBC','Health and science'),
		('ST0875','TBC','Engineering and manufacturing'),
		('ST0876','TBC','Engineering and manufacturing'),
		('ST0877','TBC','Construction'),
		('ST0878','TBC','Protective services'),
		('ST0880','TBC','Legal, finance and accounting'),
		('ST0881','TBC','Engineering and manufacturing'),
		('ST0883','TBC','Sales, marketing and procurement'),
		('ST0884','TBC','Business and administration'),
		('ST0890','TBC','Health and science'),
		('ST0891','TBC','Health and science'),
		('ST0892','TBC','Health and science'),
		('ST0893','TBC','Health and science'),
		('ST0895','TBC','Health and science'),
		('ST0897','TBC','Engineering and manufacturing'),
		('ST0899','TBC','Engineering and manufacturing'),
		('ST0901','TBC','Creative and design'),
		('ST0902','TBC','Creative and design'),
		('ST0903','TBC','Creative and design'),
		('ST0904','TBC','Creative and design'),
		('ST0905','TBC','Care services'),
		('ST0906','TBC','Care services'),
		('ST0907','TBC','Transport and logistics'),
		('ST0908','TBC','Transport and logistics'),
		('ST0910','TBC','Engineering and manufacturing'),
		('ST0912','TBC','Creative and design'),
		('ST0917','TBC','Creative and design'),
		('ST0921','TBC','Agriculture, environmental and animal care'),
		('ST0922','TBC','Agriculture, environmental and animal care'),
		('ST0923','TBC','Agriculture, environmental and animal care'),
		('ST0924','TBC','Agriculture, environmental and animal care'),
		('ST0926','TBC','Agriculture, environmental and animal care'),
		('ST0930','TBC','Protective services'),
		('ST0933','TBC','Creative and design'),
		('ST0934','TBC','Business and administration'),
		('ST0936','TBC','Construction'),
		('ST0937','TBC','Agriculture, environmental and animal care'),
		('ST0938','TBC','Agriculture, environmental and animal care'),
		('ST0940','TBC','Creative and design'),
		('ST0944','TBC','Creative and design'),
		('ST0945','TBC','Health and science'),
		('ST0946','TBC','Agriculture, environmental and animal care'),
		('ST0948','TBC','Health and science'),
		('ST0949','TBC','Digital'),
		('ST0952','TBC','Agriculture, environmental and animal care'),
		('ST0953','TBC','Digital'),
		('ST0954','TBC','Transport and logistics'),
		('ST0957','TBC','Digital'),
		('ST0961','TBC','Education and childcare');
End]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute].[Reference]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute].[LARSCode]" />
				</Entry>
				<Entry>
					<References Name="[AsData_PL].[ApprenticeshipStdRoute].[Route]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[UpdateApprenticeshipStdRoute].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="35195" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[UpdateApprenticeshipStdRoute]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[UpdateCalendarMonth]">
			<Property Name="BodyScript">
				<Value><![CDATA[

-- ==================================================
-- Author:      Himabindu Uddaraju
-- Create Date: 24/09/2019
-- Description: Update Calendar Data 
-- ==================================================

BEGIN TRY

    SET NOCOUNT ON

 DECLARE @LogID int

/* Start Logging Execution */

  INSERT INTO Mgmt.Log_Execution_Results
	  (
	    RunId
	   ,StepNo
	   ,StoredProcedureName
	   ,StartDateTime
	   ,Execution_Status
	  )
  SELECT 
        @RunId
	   ,'Step-3'
	   ,'UpdateCalendarMonth'
	   ,getdate()
	   ,0

   SELECT @LogID=MAX(LogId) FROM Mgmt.Log_Execution_Results
   WHERE StoredProcedureName='UpdateCalendarMonth'
     AND RunId=@RunID


--Insert Date into Table
DECLARE @IntNumberOfYears INT = 50
--DECLARE @IntYearsInPast INT = 10 --Default to 10
DECLARE @IntNumberofMonths INT
DECLARE @DateFirstMonth DATE
DECLARE @DateLastMonth DATE
SET @DateFirstMonth = DATEFROMPARTS(2000,1,1)
SET @DateLastMonth = DATEADD(m,(12*@IntNumberOfYears),DATEFROMPARTS(YEAR(GETDATE()),MONTH(GETDATE()),1))
SET @IntNumberofMonths = DATEDIFF(m,@DateFirstMonth,@DateLastMonth) +1

DECLARE @i INT = 1
--Temp Table
DECLARE @CalendarMonth TABLE
(
    CalendarMonthID INT NOT NULL PRIMARY KEY
    , CalendarDate DATE NOT NULL
    , CalendarMonthNumber INT NOT NULL
    , CalendarMonthName VARCHAR(20) NOT NULL
    , CalendarMonthShortName VARCHAR(20) NOT NULL
    , CalendarYear INT NOT NULL
    , CalendarMonthNameYear VARCHAR(20) NOT NULL
    , CalendarMonthShortNameYear VARCHAR(20) NOT NULL
    , TaxMonthNumber VARCHAR(20) NOT NULL
    , TaxYear VARCHAR(20) NOT NULL
    , AcademicMonthNumber INT NOT NULL
    , AcademicYear VARCHAR(20) NOT NULL
    , CalendarYearMonth_SortOrder INT NOT NULL
)
DECLARE @LoopDate DATE

SET @i = 1

WHILE @i <= @IntNumberofMonths
      BEGIN
		  SET @LoopDate =DATEADD(M,@i-1,@DateFirstMonth)
		  INSERT INTO @CalendarMonth
		  (
			 CalendarMonthID 
			 , CalendarDate 
			 , CalendarMonthNumber 
			 , CalendarMonthName 
			 , CalendarMonthShortName
			 , CalendarYear
			 , CalendarMonthNameYear
			 , CalendarMonthShortNameYear
			 , TaxMonthNumber
			 , TaxYear
			 , AcademicMonthNumber 
			 , AcademicYear 
                , CalendarYearMonth_SortOrder
		  )
		  SELECT 
			 CAST((CAST(YEAR(@LoopDate) AS VARCHAR(10)) + CAST(MONTH(@LoopDate) AS VARCHAR(2)) ) AS INT) AS CalendarMonthID 
			 , @LoopDate AS CalendarDate 
			 , MONTH(@LoopDate) AS CalendarMonthNumber 
			 , DATENAME(MONTH,@LoopDate) AS CalendarMonthName
			 , LEFT(DATENAME(MONTH,@LoopDate),3) AS CalendarMonthShortName 
			 , YEAR(@LoopDate) AS CalendarYear
			 , DATENAME(MONTH,@LoopDate) +' - '+ CAST(YEAR(@LoopDate) AS VARCHAR(20)) AS CalendarMonthNameYear
			 , LEFT(DATENAME(MONTH,@LoopDate),3) +' - '+ CAST(YEAR(@LoopDate) AS VARCHAR(20)) AS CalendarMonthShortNameYear
			 -- Tax Year
			 , CASE WHEN MONTH(@LoopDate) >= 4 THEN MONTH(@LoopDate) - 3
				  ELSE MONTH(@LoopDate) + 9 END TaxMonthNumber
			 , CASE WHEN MONTH(@LoopDate) >= 4 THEN CAST(RIGHT(YEAR(@LoopDate),2) AS VARCHAR(10)) + '-' + CAST(RIGHT(YEAR(@LoopDate)+1,2) AS VARCHAR(10)) 
				ELSE CAST(RIGHT(YEAR(@LoopDate)-1,2) AS VARCHAR(10)) + '-' + CAST(RIGHT(YEAR(@LoopDate),2) AS VARCHAR(10)) END  AS TaxYear --16-17
			 -- Academic Year
			 , CASE WHEN MONTH(@LoopDate) >= 8 THEN MONTH(@LoopDate) - 7
				  ELSE MONTH(@LoopDate) + 5 END AS AcademicMonthNumber 
			 , CASE WHEN MONTH(@LoopDate) >= 8 THEN CAST(YEAR(@LoopDate) AS VARCHAR(10)) + '/' + CAST(RIGHT(YEAR(@LoopDate)+1,2) AS VARCHAR(10)) 
				ELSE CAST(YEAR(@LoopDate)-1 AS VARCHAR(10)) + '/' + CAST(RIGHT(YEAR(@LoopDate),2) AS VARCHAR(10)) END AS AcademicYear 
                , CAST(YEAR(@LoopDate) AS VARCHAR(255)) +  CASE WHEN MONTH(@LoopDate) < 10 THEN '0' +  CAST(MONTH(@LoopDate) AS VARCHAR(255))  ELSE  CAST(MONTH(@LoopDate) AS VARCHAR(255)) END AS CalendarYearMonth_SortOrder

            SET @i = @i + 1

      END


-- Update rows

UPDATE CM
SET         [CalendarDate] = T_CM.[CalendarDate]
           ,[CalendarMonthNumber] = T_CM.[CalendarMonthNumber]
           ,[CalendarMonthName] = T_CM.[CalendarMonthName]
           ,[CalendarMonthShortName] = T_CM.[CalendarMonthShortName]
           ,[CalendarYear] = T_CM.[CalendarYear]
           ,[CalendarMonthNameYear] = T_CM.[CalendarMonthNameYear]
           ,[CalendarMonthShortNameYear] = T_CM.[CalendarMonthShortNameYear]
           ,[TaxMonthNumber] = T_CM.[TaxMonthNumber]
           ,[TaxYear] = T_CM.[TaxYear]
           ,[AcademicMonthNumber] = T_CM.[AcademicMonthNumber]
           ,[AcademicYear] = T_CM.[AcademicYear]
           ,[CalendarYearMonth_SortOrder] = T_CM.[CalendarYearMonth_SortOrder]
FROM dbo.DASCalendarMonth AS CM
INNER JOIN  @CalendarMonth AS T_CM ON CM.[CalendarMonthID] = T_CM.[CalendarMonthID]

-- Insert rows

INSERT INTO dbo.DASCalendarMonth
([CalendarMonthID]
           ,[CalendarDate]
           ,[CalendarMonthNumber]
           ,[CalendarMonthName]
           ,[CalendarMonthShortName]
           ,[CalendarYear]
           ,[CalendarMonthNameYear]
           ,[CalendarMonthShortNameYear]
           ,[TaxMonthNumber]
           ,[TaxYear]
           ,[AcademicMonthNumber]
           ,[AcademicYear]
           ,[CalendarYearMonth_SortOrder])
SELECT [CalendarMonthID]
           ,[CalendarDate]
           ,[CalendarMonthNumber]
           ,[CalendarMonthName]
           ,[CalendarMonthShortName]
           ,[CalendarYear]
           ,[CalendarMonthNameYear]
           ,[CalendarMonthShortNameYear]
           ,[TaxMonthNumber]
           ,[TaxYear]
           ,[AcademicMonthNumber]
           ,[AcademicYear]
           ,[CalendarYearMonth_SortOrder]
FROM @CalendarMonth
WHERE CalendarMonthID NOT IN (SELECT DISTINCT CalendarMonthID
						        FROM dbo.[DASCalendarMonth])

/* Update Log Execution Results as Success if the query ran succesfully*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=1
      ,EndDateTime=getdate()
	  ,FullJobStatus='Pending'
 WHERE LogId=@LogID
   AND RunID=@RunId

 
END TRY

BEGIN CATCH
    IF @@TRANCOUNT>0
	ROLLBACK TRANSACTION

    DECLARE @ErrorId int

  INSERT INTO Mgmt.Log_Error_Details
	  (UserName
	  ,ErrorNumber
	  ,ErrorState
	  ,ErrorSeverity
	  ,ErrorLine
	  ,ErrorProcedure
	  ,ErrorMessage
	  ,ErrorDateTime
	  ,RunId
	  )
  SELECT 
        SUSER_SNAME(),
	    ERROR_NUMBER(),
	    ERROR_STATE(),
	    ERROR_SEVERITY(),
	    ERROR_LINE(),
	    'UpdateCalendarMonth',
	    ERROR_MESSAGE(),
	    GETDATE(),
		@RunId as RunId; 

  SELECT @ErrorId=MAX(ErrorId) FROM Mgmt.Log_Error_Details

/* Update Log Execution Results as Fail if there is an Error*/

UPDATE Mgmt.Log_Execution_Results
   SET Execution_Status=0
      ,EndDateTime=getdate()
	  ,ErrorId=@ErrorId
 WHERE LogId=@LogID
   AND RunID=@RunId

  END CATCH]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StepNo]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthShortName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthShortNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[TaxMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[TaxYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[AcademicMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[AcademicYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarYearMonth_SortOrder]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarDate]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthShortName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthShortName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthShortNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthShortNameYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[TaxMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[TaxMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[TaxYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[TaxYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[AcademicMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[AcademicMonthNumber]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[AcademicYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[AcademicYear]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarYearMonth_SortOrder]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarYearMonth_SortOrder]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthID]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[DASCalendarMonth].[CalendarMonthID]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorNumber]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorState]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorLine]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthID]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarDate]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[date]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthNumber]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthName]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthShortName]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarYear]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthNameYear]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarMonthShortNameYear]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[TaxMonthNumber]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[TaxYear]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[AcademicMonthNumber]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[AcademicYear]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="20" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[UpdateCalendarMonth].[@CalendarMonth].[CalendarYearMonth_SortOrder]">
									<Property Name="IsNullable" Value="False" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[UpdateCalendarMonth].[@RunId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="6999" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [dbo].[UpdateCalendarMonth]&#xD;&#xA;(&#xD;&#xA;   @RunId int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlSchema" Name="[EAUser]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Fin]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Mgmt]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[Mgmt].[FK_LED_RunId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[Mgmt].[Log_RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="122" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[Mgmt].[FK_LER_ErrorID]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="123" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[Mgmt].[FK_LER_RunID]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[Mgmt].[Log_RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="124" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[Mgmt].[FK_LRC_LogId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[LogId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="125" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[Mgmt].[FK_LRC_RunId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[RunId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[Mgmt].[Log_RunId]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="126" />
		</Element>
		<Element Type="SqlScalarFunction" Name="[Mgmt].[fn_ExtractPostCodeUKFromAddress]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[fn_ExtractPostCodeUKFromAddress].[@Address]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
BEGIN
--function to extract a postcode from an address string

DECLARE @DefaultPostcode VARCHAR(8) = 'ZZ99 9ZZ'
       RETURN case
				    --Odd postcodes
				    --GIRO Bank
				    when patindex('%GIR 0AA%', @Address) > 0
					   then substring(@Address, patindex('%GIR 0AA%',@Address),7)
				    --SANTA 
				    when patindex('%SAN TA1%', @Address) > 0
					   then substring(@Address, patindex('%SAN TA1%',@Address),7)
				    --Anguilla 
				    when patindex('%AI-2640%', @Address) > 0
					   then substring(@Address, patindex('%AI-2640%',@Address),7)
				    --Ascension Island
				    when patindex('%ASCN 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%ASCN 1ZZ%',@Address),8)
				    --Saint Helena
				    when patindex('%STHL 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%STHL 1ZZ%',@Address),8)
				    --Tristan da Cunha 
				    when patindex('%TDCU 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%TDCU 1ZZ%',@Address),8)
				    --British Indian Ocean Territory 
				    when patindex('%BBND 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%BBND 1ZZ%',@Address),8)
				    --British Antarctic Territory 
				    when patindex('%BIQQ 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%BIQQ 1ZZ%',@Address),8)
				    --Falkland Islands
				    when patindex('%FIQQ 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%FIQQ 1ZZ%',@Address),8)
				    --Gibraltar
				    when patindex('%GX11 1AA%', @Address) > 0
					   then substring(@Address, patindex('%GX11 1AA%',@Address),8)
				    --Pitcairn Islands 
				    when patindex('%PCRN 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%PCRN 1ZZ%',@Address),8)
				    --South Georgia and the South Sandwich Islands
				    when patindex('%SIQQ 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%SIQQ 1ZZ%',@Address),8)
				    --Turks and Caicos Islands
				    when patindex('%TKCA 1ZZ%', @Address) > 0
					   then substring(@Address, patindex('%TKCA 1ZZ%',@Address),8)
				    --Standard Postcodes
				    when patindex('%[A-Z][A-Z][0-9][0-9] [0-9][A-Z][A-Z]%', @Address) > 0
					   then substring(@Address, patindex('%[A-Z][A-Z][0-9][0-9] [0-9][A-Z][A-Z]%',@Address),8)
				    when patindex('%[A-Z][0-9][0-9] [0-9][A-Z][A-Z]%', @Address) > 0
					   then substring(@Address, patindex('%[A-Z][0-9][0-9] [0-9][A-Z][A-Z]%',@Address),7)
				    when patindex('%[A-Z][A-Z][0-9] [0-9][A-Z][A-Z]%', @Address) > 0
					   then substring(@Address, patindex('%[A-Z][A-Z][0-9] [0-9][A-Z][A-Z]%',@Address),7)
				    when patindex('%[A-Z][0-9] [0-9][A-Z][A-Z]%', @Address) > 0
					   then substring(@Address, patindex('%[A-Z][0-9] [0-9][A-Z][A-Z]%',@Address),6)
				    when patindex('%[A-Z][A-Z][0-9][A-Z] [0-9][A-Z][A-Z]%', @Address) > 0
					   then substring(@Address, patindex('%[A-Z][A-Z][0-9][A-Z] [0-9][A-Z][A-Z]%',@Address),8)
				    when patindex('%[A-Z][0-9][A-Z] [0-9][A-Z][A-Z]%', @Address) > 0
					   then substring(@Address, patindex('%[A-Z][0-9][A-Z] [0-9][A-Z][A-Z]%',@Address),7) 
                        ELSE @DefaultPostcode  
                END
END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="3337" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [Mgmt].[fn_ExtractPostCodeUKFromAddress]&#xD;&#xA;(&#xD;&#xA;       @Address VARCHAR(MAX)&#xD;&#xA;)&#xD;&#xA;RETURNS VARCHAR(8)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[Mgmt].[fn_ExtractPostCodeUKFromAddress].[@Address]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mgmt]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Length" Value="8" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlView" Name="[Mgmt].[LoadStatus]">
			<Property Name="QueryScript">
				<Value><![CDATA[
SELECT LR.RunId
	  ,LER.LogId
	  ,LER.StoredProcedureName
	  ,LER.Execution_Status
	  ,LER.Execution_Status_Desc
	--  ,LER.FullJobStatus
	  ,LER.StartDateTime
	  ,LER.EndDateTime
	  ,LED.ErrorMessage as ErrorMessage
	  ,ISNULL(LRC.SourceTableName,'N/A') as SourceTableName
	  ,ISNULL(LRC.TargetTableName,'N/A') as TargetTableName
	  ,LRC.SourceRecordCount as SourceRecordCount
	  ,LRC.TargetRecordCount as TargetRecordCount
	--  ,LRC.InvalidRecordCount as InvalidRecordCount
  FROM Mgmt.Log_RunId LR
  LEFT
  JOIN Mgmt.Log_Execution_Results LER
    ON LER.RunId=LR.RunId
  LEFT
  JOIN Mgmt.Log_Error_Details LED
    ON LED.ErrorId=LER.ErrorId
  LEFT
  JOIN Mgmt.Log_Record_Counts LRC
    ON LRC.LogId=LER.LogId
   AND LRC.RunId=LR.RunId]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[RunId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_RunId].[RunId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[LogId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[StoredProcedureName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[Execution_Status]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[Execution_Status_Desc]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status_Desc]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[StartDateTime]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[EndDateTime]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[ErrorMessage]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[SourceTableName]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[TargetTableName]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[SourceRecordCount]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Record_Counts].[SourceRecordCount]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[LoadStatus].[TargetRecordCount]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Record_Counts].[TargetRecordCount]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[Mgmt].[Log_RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[ErrorId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_RunId].[RunId]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status_Desc]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[StartDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results].[EndDateTime]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[SourceTableName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[TargetTableName]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[SourceRecordCount]" />
				</Entry>
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts].[TargetRecordCount]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mgmt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="797" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE VIEW [Mgmt].[LoadStatus]&#xD;&#xA;as" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[Mgmt].[Log_Error_Details]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[RunId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="26" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[UserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorSeverity]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorState]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorLine]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorProcedure]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorADFTaskType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorMessage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Error_Details].[ErrorDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mgmt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="127" />
			<AttachedAnnotation Disambiguator="122" />
		</Element>
		<Element Type="SqlTable" Name="[Mgmt].[Log_Execution_Results]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[LogId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[RunId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="25" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[ErrorId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[StepNo]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[StoredProcedureName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[Execution_Status]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[Mgmt].[Log_Execution_Results].[Execution_Status_Desc]">
						<Property Name="ExpressionScript">
							<Value><![CDATA[(case when [Execution_Status]=(1) then 'Success' else 'Fail' end)]]></Value>
						</Property>
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[Execution_Status]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[ADFTaskType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[StartDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[EndDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Execution_Results].[FullJobStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mgmt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="128" />
			<AttachedAnnotation Disambiguator="123" />
			<AttachedAnnotation Disambiguator="124" />
		</Element>
		<Element Type="SqlTable" Name="[Mgmt].[Log_Record_Counts]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[LRC_Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[LogId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[RunId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="24" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[SourceTableName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[TargetTableName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[SourceRecordCount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[TargetRecordCount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_Record_Counts].[InvalidRecordCount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mgmt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="129" />
			<AttachedAnnotation Disambiguator="125" />
			<AttachedAnnotation Disambiguator="126" />
		</Element>
		<Element Type="SqlTable" Name="[Mgmt].[Log_RunId]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_RunId].[RunId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_RunId].[StartDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mgmt].[Log_RunId].[EndDateTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mgmt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="130" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[Mgmt].[PK_LED_ErrorID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Mgmt].[Log_Error_Details].[ErrorId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Error_Details]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="127" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[Mgmt].[PK_LER_LogID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Mgmt].[Log_Execution_Results].[LogId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Execution_Results]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="128" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[Mgmt].[PK_LogRunId_RunId]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Mgmt].[Log_RunId].[RunId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_RunId]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="130" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[Mgmt].[PK_LRC_LRCID]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Mgmt].[Log_Record_Counts].[LRC_Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mgmt].[Log_Record_Counts]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="129" />
		</Element>
		<Element Type="SqlSchema" Name="[Mtd]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[Mtd].[PK_SourceConfigForImport_SCFIId]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[Mtd].[SourceConfigForImport].[SCFI_Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[Mtd].[SourceConfigForImport]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="131" />
		</Element>
		<Element Type="SqlTable" Name="[Mtd].[SourceConfigForImport]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[SCFI_Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[SourceDatabaseName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[SourceTableName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[SourceSchemaName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[ColumnNamesToInclude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[ColumnNamesToExclude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[IsEnabled]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="37" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[AddedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="38" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Mtd].[SourceConfigForImport].[UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Mtd]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="131" />
		</Element>
		<Element Type="SqlSchema" Name="[Pmts]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Resv]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Stg]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[Avms_CandidateDetails]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[Avms_CandidateDetails].[SourceSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="82" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[Avms_CandidateDetails].[CandidateId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[Avms_CandidateDetails].[EID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[Avms_CandidateDetails].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[CandidateConfig]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CandidateConfig].[CCId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="81" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CandidateConfig].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CandidateConfig].[Category]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CandidateConfig].[ShortCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CandidateConfig].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[CopyActivity]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CopyActivity].[CAId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="98" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CopyActivity].[NID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="73" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CopyActivity].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CopyActivity].[Category]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[CopyActivity].[SourceDb]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[FAA_CandidateDetails]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[FAA_CandidateDetails].[SourceSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="97" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[FAA_CandidateDetails].[CandidateId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[FAA_CandidateDetails].[LegacyCandidateId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[FAA_CandidateDetails].[EID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[FAA_CandidateDetails].[RunID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ApplicationReviews]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[TypeCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[CandidateId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[CandidateIdType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[VacancyReference]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicationStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[CreatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[SubmittedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantVacancyReference]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicationDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantAddressLine1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantAddressLine2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantAddressLine3]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantAddressLine4]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantPostCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantBirthDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantDisabilityStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantEducationFromYear]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantEducationInstitution]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantEducationToYear]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantPhone]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantFirstName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantLastName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantHobbiesAndInterests]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantImprovements]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantQualifications]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantSkills]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantStrengths]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantSupport]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantTrainingCourses]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantWorkExperiences]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantFromDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[ApplicantToDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[StatusUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[StatusUpdatedByUserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[StatusUpdatedByName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[StatusUpdatedByEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[CandidateFeedback]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[IsWithDrawn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="58" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="59" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ApplicationReviews].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="60" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ProgrammeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[LastUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[ApprenticeshipType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[Title]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[EffectiveFrom]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[Duration]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[IsActive]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[EducationLevelNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="46" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="47" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataApprenticeshipProgrammes].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="48" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ReferenceDataBankHolidays]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[LastUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[NortherIrelandEvents]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[ScotlandEvents]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[EnglandAndWalesEvents]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="49" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="50" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBankHolidays].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="51" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ReferenceDataBannedPhrases]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[LastUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[BannedPhrases]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="43" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="44" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataBannedPhrases].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="45" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ReferenceDataCandidateSkills]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[CandidateSkillsId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[CandidateSkillsLastUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[Skills]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="55" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="56" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataCandidateSkills].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="57" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ReferenceDataProfanities]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[LastUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[Profanities]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[ProfanityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="40" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="41" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataProfanities].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="42" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_ReferenceDataQualificationTypes]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[LastUpdatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[QualificationTypes]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="52" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="53" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_ReferenceDataQualificationTypes].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="54" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_Users]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[TypeCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[IdamUserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[UserType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[UserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[UserEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[UserCreatedTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[LastSignedInTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[EmployerAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[Ukprn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="67" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="68" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Users].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="69" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[Stg].[RAA_Vacancies]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SourseSK]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[BinaryId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TypeCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[VacancyReference]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[VacancyStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[OwnerType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SourceOrigin]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SourceType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ClosedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[CreatedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[CreatedByUserID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[CreatedByUserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[CreatedByUserEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SubmittedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SubmittedByUserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SubmittedByUserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[SubmittedByUserEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ApprovedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LiveDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LastUpdatedTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LastUpdatedByUserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LastUpdatedByUserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LastUpdatedByUserEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[IsDeleted]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ApplicationIstructions]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ApplicationMethod]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="512" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ApplicationUrl]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ClosingDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[VacancyDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[DisabilityConfident]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerAddressLine1]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerAddressLine2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerAddressLine3]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerAddressLine4]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerPostCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerLatitude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerLongitude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerNameOption]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LegalEntityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerWebsiteUrl]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[GeoCodeMethod]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[LegalEntityId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[AccountLegalEntityPublicHashedId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[NumberOfPositions]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[OutcomeDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ProgrammeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[Qualifications]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ShortDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[Skills]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[StartDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ThingsToConsider]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[VacancyTitle]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TrainingDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TrainingProviderUkprn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TrainingProviderName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TrainingProviderAddressLine3]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TrainingProviderAddressLine4]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[TrainingProviderPostcode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[WageDuration]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[WageDurationUnit]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[WorkingWeekDescription]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[WeeklyHours]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[WageType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[FixedWageYearlyAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[WageAdditionalInformation]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[ClosureReason]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[DeletedDateTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[DeletedByUserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[DeletedByUserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[DeletedByUserEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerContactName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerContactEmail]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[EmployerContactPhone]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="256" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[RunId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="61" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[AsDm_CreatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="62" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[Stg].[RAA_Vacancies].[AsDm_UpdatedDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="63" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[Stg]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[StgPmts]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[Apprenticeship]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[AccountId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[AgreementId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[char]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[AgreedOnDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[Uln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[EstimatedStartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[EstimatedEndDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[Priority]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[StandardCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[ProgrammeType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[FrameworkCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[PathwayCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[LegalEntityName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[TransferSendingEmployerAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[StopDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[Status]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[IsLevyPayer]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Apprenticeship].[ApprenticeshipEmployerType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[ApprenticeshipPause]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPause].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPause].[ApprenticeshipId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPause].[PauseDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPause].[ResumeDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[ApprenticeshipPriceEpisode]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[ApprenticeshipId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[StartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[EndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[Cost]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[Removed]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipPriceEpisode].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[ApprenticeshipStatus]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipStatus].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ApprenticeshipStatus].[Description]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataLockEvent]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[EventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[ContractType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningAimFundingLineType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[AgreementId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[IsPayable]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[DataLockSourceId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[EventTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEvent].[DuplicateNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataLockEventNonPayablePeriod]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[DataLockEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[DataLockEventNonPayablePeriodId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[PriceEpisodeIdentifier]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[SfaContributionPercentage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriod].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataLockEventNonPayablePeriodFailures]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriodFailures].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriodFailures].[DataLockEventNonPayablePeriodId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriodFailures].[DataLockFailureId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriodFailures].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventNonPayablePeriodFailures].[ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataLockEventPayablePeriod]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[DataLockEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[PriceEpisodeIdentifier]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[SfaContributionPercentage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[ApprenticeshipPriceEpisodeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPayablePeriod].[ApprenticeshipEmployerType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataLockEventPriceEpisode]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[DataLockEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[PriceEpisodeIdentifier]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[SfaContributionPercentage]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[TotalNegotiatedPrice1]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[TotalNegotiatedPrice2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[TotalNegotiatedPrice3]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[TotalNegotiatedPrice4]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[StartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[EffectiveTotalNegotiatedPriceStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[PlannedEndDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[ActualEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[NumberOfInstalments]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[InstalmentAmount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[CompletionAmount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[Completed]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[EmployerContribution]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[CompletionHoldBackExemptionCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockEventPriceEpisode].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataLockFailure]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[DataLockEventId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[EarningPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataLockFailure].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[DataMatchReport]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[CollectionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[DataLockFailureId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[LearningAimSequenceNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[DataLockSourceId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[IsPayable]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[DataMatchReport].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[EarningEvent]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[EventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[ContractType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimFundingLineType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[AgreementId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[EventTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[LearningAimSequenceNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[SfaContributionPercentage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[IlrFileName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="400" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEvent].[EventType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="4000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[EarningEventPeriod]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[PriceEpisodeIdentifier]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[SfaContributionPercentage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPeriod].[CensusDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[EarningEventPriceEpisode]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[PriceEpisodeIdentifier]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[SfaContributionPercentage]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[TotalNegotiatedPrice1]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[TotalNegotiatedPrice2]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[TotalNegotiatedPrice3]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[TotalNegotiatedPrice4]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[StartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[EffectiveTotalNegotiatedPriceStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[PlannedEndDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[ActualEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[NumberOfInstalments]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[InstalmentAmount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[CompletionAmount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[Completed]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[EmployerContribution]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[CompletionHoldBackExemptionCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[AgreedPrice]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EarningEventPriceEpisode].[CourseStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[EmployerProviderPriority]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EmployerProviderPriority].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EmployerProviderPriority].[EmployerAccountId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EmployerProviderPriority].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[EmployerProviderPriority].[Order]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Filegroup">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[PRIMARY]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[FundingSourceEvent]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[RequiredPaymentEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[PriceEpisodeIdentifier]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[ContractType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[FundingSourceType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[SfaContributionPercentage]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningAimFundingLineType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[AgreementId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EventTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[AccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[TransferSenderAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsStartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsPlannedEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsActualEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsCompletionStatus]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsCompletionAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsInstalmentAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[EarningsNumberOfInstalments]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[ApprenticeshipPriceEpisodeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[ApprenticeshipEmployerType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[FundingSourceEvent].[NonPaymentReason]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[Job]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[JobType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[StartTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[EndTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[Status]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[DCJobId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[Ukprn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[IlrSubmissionTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[LearnerCount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[DataLocksCompletionTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[DCJobSucceeded]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Job].[DCJobEndTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[JobEvent]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[JobEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[EventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[ParentEventId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[Status]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[StartTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[EndTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[MessageName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="250" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEvent].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[JobEventStatus]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEventStatus].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobEventStatus].[Description]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[JobProviderEarnings]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobProviderEarnings].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobProviderEarnings].[DCJobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobProviderEarnings].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobProviderEarnings].[IlrSubmissionTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobProviderEarnings].[CollectionYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="4" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobProviderEarnings].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[JobStatus]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobStatus].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobStatus].[Description]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[JobType]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobType].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[JobType].[Description]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[LevyAccount]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[LevyAccount].[AccountId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[LevyAccount].[AccountName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[LevyAccount].[Balance]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="4" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[LevyAccount].[IsLevyPayer]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[LevyAccount].[TransferAllowance]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="4" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[Payment]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[FundingSourceEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EventTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[PriceEpisodeIdentifier]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningAimFundingLineType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[ContractType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[FundingSource]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[SfaContributionPercentage]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[AgreementId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[AccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[TransferSenderAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsStartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsPlannedEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsActualEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsCompletionStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsCompletionAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsInstalmentAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[EarningsNumberOfInstalments]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[ApprenticeshipPriceEpisodeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[ApprenticeshipEmployerType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[ReportingAimFundingLineType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="120" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[NonPaymentReason]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[Payment].[DuplicateNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[ProviderAdjustmentPayments]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[SubmissionId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[SubmissionCollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[SubmissionAcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[PaymentType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[PaymentTypeName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="250" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[CollectionPeriodName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[CollectionPeriodMonth]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[ProviderAdjustmentPayments].[CollectionPeriodYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[RequiredPaymentEvent]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningEventId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[uniqueidentifier]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[PriceEpisodeIdentifier]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[ContractType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[TransactionType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[SfaContributionPercentage]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[Amount]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[DeliveryPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearnerUln]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningAimFundingLineType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[AgreementId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EventTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[AccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[TransferSenderAccountId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsStartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsPlannedEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsActualEndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsCompletionStatus]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsCompletionAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsInstalmentAmount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="5" />
									<Property Name="Precision" Value="15" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EarningsNumberOfInstalments]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[LearningStartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[ApprenticeshipId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[ApprenticeshipPriceEpisodeId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[ApprenticeshipEmployerType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[NonPaymentReason]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[EventType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="4000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[RequiredPaymentEvent].[DuplicateNumber]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[StgPmts].[SubmittedLearnerAim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[Ukprn]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearnerReferenceNumber]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="12" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearningAimFrameworkCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearningAimPathwayCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearningAimProgrammeType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearningAimStandardCode]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearningAimReference]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[CollectionPeriod]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[AcademicYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smallint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[IlrSubmissionDateTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime2]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[CreationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="7" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[LearnerUln]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[JobId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[StgPmts].[SubmittedLearnerAim].[ContractType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[tinyint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[StgPmts]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[Swap]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
	</Model>
</DataSchemaModel>